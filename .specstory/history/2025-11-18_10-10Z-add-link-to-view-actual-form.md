<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- cursor Session 1528c2d0-fd37-4cc2-810a-d032940c6e6d (2025-11-18 10:10Z) -->

# Add link to view actual form (2025-11-18 10:10Z)

_**User (2025-11-17 23:03Z)**_

In the Configurations, Form Definitions, add a link to view the actual form as well

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Preparing task approach**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Inspect Configurations Form Definitions UI to understand current layout
- [ ] Add link to view actual form in Form Definitions
- [ ] Test the new link and update documentation if needed

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Listing repository contents**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_directory** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Locating Configurations Form Definitions**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Locating form routes**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_directory** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Checking slug path and page file**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/app/forms/(by-config)/[formSlug]/page.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Searching for admin route path**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "form-definitions-panel" in "/Users/sahilmehta/supplier-onboarding-simple" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `./app/dashboard/admin/forms/page.tsx` | `import \{ FormDefinitionsPanel \} from "@/components/admin/form-definitions-panel";` | L3 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/app/dashboard/admin/forms/page.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Adding a form view link in admin panel**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;components/admin/form-definitions-panel.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;720ed565-747b-4e38-b80f-e44f781b538e&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n  import { useEffect, useState, useTransition } from \&quot;react\&quot;;\n+ import Link from \&quot;next/link\&quot;;\n  import { useRouter } from \&quot;next/navigation\&quot;;\n  import {&quot;,
        &quot;oldStart&quot;: 2,
        &quot;newStart&quot;: 2,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                  &lt;/p&gt;\n                &lt;/div&gt;\n-               &lt;DropdownMenu&gt;\n-                 &lt;DropdownMenuTrigger asChild&gt;\n-                   &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n-                     &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n-                   &lt;/Button&gt;\n-                 &lt;/DropdownMenuTrigger&gt;\n-                 &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n-                   &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n-                     Edit config\n-                   &lt;/DropdownMenuItem&gt;\n-                   &lt;DropdownMenuItem\n-                     className=\&quot;text-red-600\&quot;\n-                     onClick={() =&gt; setDeletingForm(form)}\n-                   &gt;\n-                     Delete config\n-                   &lt;/DropdownMenuItem&gt;\n-                 &lt;/DropdownMenuContent&gt;\n-               &lt;/DropdownMenu&gt;\n+               &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n+                 &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n+                   &lt;Link\n+                     href={&#96;/forms/${form.id}&#96;}\n+                     target=\&quot;_blank\&quot;\n+                     rel=\&quot;noreferrer\&quot;\n+                   &gt;\n+                     View form\n+                   &lt;/Link&gt;\n+                 &lt;/Button&gt;\n+                 &lt;DropdownMenu&gt;\n+                   &lt;DropdownMenuTrigger asChild&gt;\n+                     &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n+                       &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n+                     &lt;/Button&gt;\n+                   &lt;/DropdownMenuTrigger&gt;\n+                   &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n+                     &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n+                       Edit config\n+                     &lt;/DropdownMenuItem&gt;\n+                     &lt;DropdownMenuItem\n+                       className=\&quot;text-red-600\&quot;\n+                       onClick={() =&gt; setDeletingForm(form)}\n+                     &gt;\n+                       Delete config\n+                     &lt;/DropdownMenuItem&gt;\n+                   &lt;/DropdownMenuContent&gt;\n+                 &lt;/DropdownMenu&gt;\n+               &lt;/div&gt;\n              &lt;/div&gt;\n  &quot;,
        &quot;oldStart&quot;: 195,
        &quot;newStart&quot;: 196,
        &quot;oldLines&quot;: 22,
        &quot;newLines&quot;: 33,
        &quot;linesRemoved&quot;: 18,
        &quot;linesAdded&quot;: 29
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM components/admin/form-definitions-panel.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useEffect, useState, useTransition } from \&quot;react\&quot;;\nimport Link from \&quot;next/link\&quot;;\nimport { useRouter } from \&quot;next/navigation\&quot;;\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \&quot;@/components/ui/dialog\&quot;;\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \&quot;@/components/ui/dropdown-menu\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \&quot;@/components/ui/table\&quot;;\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \&quot;@/components/ui/select\&quot;;\nimport { Input } from \&quot;@/components/ui/input\&quot;;\nimport {\n  Layers,\n  ListTree,\n  MoreHorizontal,\n  Plus,\n  Trash2,\n} from \&quot;lucide-react\&quot;;\n\nimport { jsonRequest } from \&quot;@/lib/admin-api\&quot;;\n\ninterface EntitySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface GeographySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface FormFieldSummary {\n  id: string;\n  key: string;\n  label: string;\n  type: string;\n  required: boolean;\n  order: number;\n  placeholder: string | null;\n  helpText: string | null;\n  options: unknown;\n}\n\ninterface FormSectionSummary {\n  id: string;\n  key: string;\n  label: string;\n  order: number;\n  formConfigId: string;\n  fields: FormFieldSummary[];\n}\n\ninterface FormDefinitionSummary {\n  id: string;\n  entity: EntitySummary;\n  geography: GeographySummary;\n  version: number;\n  title: string | null;\n  description: string | null;\n  isActive: boolean;\n  createdAt: string | Date;\n  updatedAt: string | Date;\n  sections: FormSectionSummary[];\n}\n\ninterface FormDefinitionsPanelProps {\n  forms: FormDefinitionSummary[];\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n}\n\ninterface SectionDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n}\n\ninterface FieldDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n}\n\nexport function FormDefinitionsPanel({\n  forms,\n  entities,\n  geographies,\n}: FormDefinitionsPanelProps) {\n  const router = useRouter();\n  const [createOpen, setCreateOpen] = useState(false);\n  const [editingForm, setEditingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [deletingForm, setDeletingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [sectionDialog, setSectionDialog] = useState&lt;SectionDialogState | null&gt;(\n    null\n  );\n  const [sectionDelete, setSectionDelete] =\n    useState&lt;SectionDialogState | null&gt;(null);\n  const [fieldDialog, setFieldDialog] = useState&lt;FieldDialogState | null&gt;(null);\n  const [fieldDelete, setFieldDelete] = useState&lt;FieldDialogState | null&gt;(null);\n\n  const refresh = () =&gt; router.refresh();\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-4\&quot;&gt;\n        &lt;div className=\&quot;flex items-center gap-2 text-slate-500\&quot;&gt;\n          &lt;Layers className=\&quot;h-4 w-4\&quot; /&gt;\n          &lt;span&gt;\n            {forms.length}{\&quot; \&quot;}\n            {forms.length === 1 ? \&quot;form definition\&quot; : \&quot;form definitions\&quot;}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;Dialog open={createOpen} onOpenChange={setCreateOpen}&gt;\n          &lt;DialogTrigger asChild&gt;\n            &lt;Button className=\&quot;gap-2\&quot;&gt;\n              &lt;Plus className=\&quot;h-4 w-4\&quot; /&gt;\n              New form config\n            &lt;/Button&gt;\n          &lt;/DialogTrigger&gt;\n          &lt;FormConfigDialog\n            mode=\&quot;create\&quot;\n            entities={entities}\n            geographies={geographies}\n            open={createOpen}\n            onOpenChange={setCreateOpen}\n            onSuccess={() =&gt; {\n              setCreateOpen(false);\n              refresh();\n            }}\n          /&gt;\n        &lt;/Dialog&gt;\n      &lt;/div&gt;\n\n      {forms.length === 0 &amp;&amp; (\n        &lt;div className=\&quot;rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center text-slate-500\&quot;&gt;\n          &lt;p&gt;No form definitions yet. Create one to start mapping schema versions.&lt;/p&gt;\n        &lt;/div&gt;\n      )}\n\n      &lt;div className=\&quot;space-y-4\&quot;&gt;\n        {forms.map((form) =&gt; (\n          &lt;div\n            key={form.id}\n            className=\&quot;rounded-2xl border border-slate-200 bg-white p-5 shadow-sm\&quot;\n          &gt;\n            &lt;div className=\&quot;flex flex-wrap items-start justify-between gap-4\&quot;&gt;\n              &lt;div&gt;\n                &lt;div className=\&quot;flex flex-wrap items-center gap-3\&quot;&gt;\n                  &lt;h3 className=\&quot;text-lg font-semibold text-slate-900\&quot;&gt;\n                    {form.entity.name} • {form.geography.code.toUpperCase()} • v\n                    {form.version}\n                  &lt;/h3&gt;\n                  &lt;Badge variant={form.isActive ? \&quot;default\&quot; : \&quot;secondary\&quot;}&gt;\n                    {form.isActive ? \&quot;Active\&quot; : \&quot;Inactive\&quot;}\n                  &lt;/Badge&gt;\n                &lt;/div&gt;\n                {form.title &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-600\&quot;&gt;{form.title}&lt;/p&gt;\n                )}\n                {form.description &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;{form.description}&lt;/p&gt;\n                )}\n                &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n                  Updated {new Date(form.updatedAt).toLocaleString()}\n                &lt;/p&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n                  &lt;Link\n                    href={&#96;/forms/${form.id}&#96;}\n                    target=\&quot;_blank\&quot;\n                    rel=\&quot;noreferrer\&quot;\n                  &gt;\n                    View form\n                  &lt;/Link&gt;\n                &lt;/Button&gt;\n                &lt;DropdownMenu&gt;\n                  &lt;DropdownMenuTrigger asChild&gt;\n                    &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n                      &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n                    &lt;/Button&gt;\n                  &lt;/DropdownMenuTrigger&gt;\n                  &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                    &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n                      Edit config\n                    &lt;/DropdownMenuItem&gt;\n                    &lt;DropdownMenuItem\n                      className=\&quot;text-red-600\&quot;\n                      onClick={() =&gt; setDeletingForm(form)}\n                    &gt;\n                      Delete config\n                    &lt;/DropdownMenuItem&gt;\n                  &lt;/DropdownMenuContent&gt;\n                &lt;/DropdownMenu&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-6 space-y-4\&quot;&gt;\n              {form.sections.length === 0 &amp;&amp; (\n                &lt;div className=\&quot;rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500\&quot;&gt;\n                  No sections configured for this form.\n                &lt;/div&gt;\n              )}\n\n              {form.sections.map((section) =&gt; (\n                &lt;div\n                  key={section.id}\n                  className=\&quot;rounded-xl border border-slate-200 bg-slate-50 p-4\&quot;\n                &gt;\n                  &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-3\&quot;&gt;\n                    &lt;div&gt;\n                      &lt;div className=\&quot;flex items-center gap-2 text-slate-700\&quot;&gt;\n                        &lt;ListTree className=\&quot;h-4 w-4 text-slate-400\&quot; /&gt;\n                        &lt;h4 className=\&quot;text-base font-semibold\&quot;&gt;\n                          {section.label}\n                        &lt;/h4&gt;\n                      &lt;/div&gt;\n                      &lt;p className=\&quot;text-xs font-mono uppercase tracking-wide text-slate-400\&quot;&gt;\n                        {section.key} • order {section.order}\n                      &lt;/p&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex flex-wrap items-center gap-2\&quot;&gt;\n                      &lt;Button\n                        variant=\&quot;outline\&quot;\n                        size=\&quot;sm\&quot;\n                        onClick={() =&gt;\n                          setFieldDialog({\n                            form,\n                            section,\n                            field: null,\n                          })\n                        }\n                      &gt;\n                        &lt;Plus className=\&quot;mr-2 h-3.5 w-3.5\&quot; /&gt;\n                        Field\n                      &lt;/Button&gt;\n                      &lt;DropdownMenu&gt;\n                        &lt;DropdownMenuTrigger asChild&gt;\n                          &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                            &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                          &lt;/Button&gt;\n                        &lt;/DropdownMenuTrigger&gt;\n                        &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                          &lt;DropdownMenuItem\n                            onClick={() =&gt;\n                              setSectionDialog({ form, section })\n                            }\n                          &gt;\n                            Edit section\n                          &lt;/DropdownMenuItem&gt;\n                          &lt;DropdownMenuItem\n                            className=\&quot;text-red-600\&quot;\n                            onClick={() =&gt;\n                              setSectionDelete({ form, section })\n                            }\n                          &gt;\n                            Delete section\n                          &lt;/DropdownMenuItem&gt;\n                        &lt;/DropdownMenuContent&gt;\n                      &lt;/DropdownMenu&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n\n                  &lt;div className=\&quot;mt-3 overflow-hidden rounded-lg border border-slate-200 bg-white\&quot;&gt;\n                    &lt;Table&gt;\n                      &lt;TableHeader className=\&quot;bg-slate-100\&quot;&gt;\n                        &lt;TableRow&gt;\n                          &lt;TableHead&gt;Label&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Key&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Type&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Required\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Order\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-16 text-right\&quot;&gt;\n                            Actions\n                          &lt;/TableHead&gt;\n                        &lt;/TableRow&gt;\n                      &lt;/TableHeader&gt;\n                      &lt;TableBody&gt;\n                        {section.fields.length === 0 &amp;&amp; (\n                          &lt;TableRow&gt;\n                            &lt;TableCell\n                              colSpan={6}\n                              className=\&quot;text-center text-sm text-slate-500\&quot;\n                            &gt;\n                              No fields yet. Add the first field.\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        )}\n                        {section.fields.map((field) =&gt; (\n                          &lt;TableRow key={field.id}&gt;\n                            &lt;TableCell className=\&quot;font-medium text-slate-900\&quot;&gt;\n                              {field.label}\n                              {field.helpText &amp;&amp; (\n                                &lt;p className=\&quot;text-xs text-slate-500\&quot;&gt;\n                                  {field.helpText}\n                                &lt;/p&gt;\n                              )}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;font-mono text-xs uppercase text-slate-500\&quot;&gt;\n                              {field.key}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell&gt;\n                              &lt;Badge variant=\&quot;secondary\&quot;&gt;{field.type}&lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              &lt;Badge\n                                variant={field.required ? \&quot;default\&quot; : \&quot;outline\&quot;}\n                              &gt;\n                                {field.required ? \&quot;Yes\&quot; : \&quot;No\&quot;}\n                              &lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              {field.order}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-right\&quot;&gt;\n                              &lt;DropdownMenu&gt;\n                                &lt;DropdownMenuTrigger asChild&gt;\n                                  &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                                    &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                                  &lt;/Button&gt;\n                                &lt;/DropdownMenuTrigger&gt;\n                                &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                                  &lt;DropdownMenuItem\n                                    onClick={() =&gt;\n                                      setFieldDialog({ form, section, field })\n                                    }\n                                  &gt;\n                                    Edit\n                                  &lt;/DropdownMenuItem&gt;\n                                  &lt;DropdownMenuItem\n                                    className=\&quot;text-red-600\&quot;\n                                    onClick={() =&gt;\n                                      setFieldDelete({ form, section, field })\n                                    }\n                                  &gt;\n                                    Delete\n                                  &lt;/DropdownMenuItem&gt;\n                                &lt;/DropdownMenuContent&gt;\n                              &lt;/DropdownMenu&gt;\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        ))}\n                      &lt;/TableBody&gt;\n                    &lt;/Table&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-4\&quot;&gt;\n              &lt;Button\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={() =&gt; setSectionDialog({ form, section: null })}\n              &gt;\n                &lt;Plus className=\&quot;mr-2 h-4 w-4\&quot; /&gt;\n                Add section\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ))}\n      &lt;/div&gt;\n\n      &lt;FormConfigDialog\n        mode=\&quot;edit\&quot;\n        form={editingForm}\n        entities={entities}\n        geographies={geographies}\n        open={Boolean(editingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setEditingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setEditingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      &lt;DeleteFormDialog\n        form={deletingForm}\n        open={Boolean(deletingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setDeletingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setDeletingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      {sectionDialog?.form &amp;&amp; (\n        &lt;SectionDialog\n          mode={sectionDialog.section ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={sectionDialog.form}\n          section={sectionDialog.section}\n          open={Boolean(sectionDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {sectionDelete?.form &amp;&amp; sectionDelete.section &amp;&amp; (\n        &lt;DeleteSectionDialog\n          form={sectionDelete.form}\n          section={sectionDelete.section}\n          open={Boolean(sectionDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDialog?.form &amp;&amp; (\n        &lt;FieldDialog\n          mode={fieldDialog.field ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={fieldDialog.form}\n          section={fieldDialog.section}\n          field={fieldDialog.field}\n          open={Boolean(fieldDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDelete?.form &amp;&amp; fieldDelete.field &amp;&amp; (\n        &lt;DeleteFieldDialog\n          form={fieldDelete.form}\n          section={fieldDelete.section}\n          field={fieldDelete.field}\n          open={Boolean(fieldDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\ninterface FormConfigDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form?: FormDefinitionSummary | null;\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction FormConfigDialog({\n  mode,\n  form,\n  entities,\n  geographies,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FormConfigDialogProps) {\n  const [entityId, setEntityId] = useState(\&quot;\&quot;);\n  const [geographyId, setGeographyId] = useState(\&quot;\&quot;);\n  const [version, setVersion] = useState(\&quot;1\&quot;);\n  const [title, setTitle] = useState(\&quot;\&quot;);\n  const [description, setDescription] = useState(\&quot;\&quot;);\n  const [isActive, setIsActive] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setEntityId(form?.entity.id ?? entities[0]?.id ?? \&quot;\&quot;);\n      setGeographyId(form?.geography.id ?? geographies[0]?.id ?? \&quot;\&quot;);\n      setVersion(String(form?.version ?? 1));\n      setTitle(form?.title ?? \&quot;\&quot;);\n      setDescription(form?.description ?? \&quot;\&quot;);\n      setIsActive(form?.isActive ?? true);\n      setError(null);\n    }\n  }, [open, form, entities, geographies]);\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          entityId,\n          geographyId,\n          version: Number(version),\n          title: title.trim() || null,\n          description: description.trim() || null,\n          isActive,\n        };\n        if (!payload.entityId || !payload.geographyId) {\n          setError(\&quot;Entity and geography are required\&quot;);\n          return;\n        }\n        if (payload.version &lt; 1 || Number.isNaN(payload.version)) {\n          setError(\&quot;Version must be a positive number\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(\&quot;/api/configuration/forms\&quot;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (form) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const titleText =\n    mode === \&quot;create\&quot; ? \&quot;Create form configuration\&quot; : \&quot;Edit form configuration\&quot;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{titleText}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Entity\n              &lt;Select\n                value={entityId}\n                onValueChange={setEntityId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select entity\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {entities.map((entity) =&gt; (\n                    &lt;SelectItem key={entity.id} value={entity.id}&gt;\n                      {entity.name} ({entity.code})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Geography\n              &lt;Select\n                value={geographyId}\n                onValueChange={setGeographyId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select geography\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {geographies.map((geo) =&gt; (\n                    &lt;SelectItem key={geo.id} value={geo.id}&gt;\n                      {geo.name} ({geo.code.toUpperCase()})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Version\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                min={1}\n                value={version}\n                onChange={(event) =&gt; setVersion(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Title\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={title}\n                onChange={(event) =&gt; setTitle(event.target.value)}\n                placeholder=\&quot;Optional display title\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Description\n              &lt;textarea\n                className=\&quot;mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm\&quot;\n                rows={3}\n                value={description}\n                onChange={(event) =&gt; setDescription(event.target.value)}\n                placeholder=\&quot;Optional description\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input\n                type=\&quot;checkbox\&quot;\n                className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n                checked={isActive}\n                onChange={(event) =&gt; setIsActive(event.target.checked)}\n              /&gt;\n              Active\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending ? \&quot;Saving...\&quot; : mode === \&quot;create\&quot; ? \&quot;Create\&quot; : \&quot;Save\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFormDialogProps {\n  form: FormDefinitionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFormDialog({\n  form,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFormDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n          method: \&quot;DELETE\&quot;,\n        });\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete form configuration?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes the {form.entity.name} • {form.geography.code.toUpperCase()}\n          {\&quot; \&quot;}v{form.version} form. Applications referencing this config will no\n          longer load new drafts.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n            className=\&quot;gap-2\&quot;\n          &gt;\n            &lt;Trash2 className=\&quot;h-4 w-4\&quot; /&gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface SectionDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction SectionDialog({\n  mode,\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: SectionDialogProps) {\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setKeyValue(section?.key ?? \&quot;\&quot;);\n      setLabel(section?.label ?? \&quot;\&quot;);\n      setOrder(String(section?.order ?? 0));\n      setError(null);\n    }\n  }, [open, section]);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          key: keyValue.trim(),\n          label: label.trim(),\n          order: Number(order),\n        };\n        if (!payload.key || !payload.label) {\n          setError(\&quot;Key and label are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}/sections&#96;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (section) {\n          await jsonRequest(\n            &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n            {\n              method: \&quot;PATCH\&quot;,\n              body: JSON.stringify(payload),\n            }\n          );\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? \&quot;Add section\&quot;\n      : &#96;Edit section (${section?.label ?? \&quot;Section\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-lg\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                placeholder=\&quot;company_profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                placeholder=\&quot;Company profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create section\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteSectionDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteSectionDialog({\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteSectionDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n          {\n            method: \&quot;DELETE\&quot;,\n          }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete section?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Removing &lt;span className=\&quot;font-medium\&quot;&gt;{section.label}&lt;/span&gt; deletes\n          {section.fields.length &gt; 0 ? \&quot; its fields as well.\&quot; : \&quot; it immediately.\&quot;}\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface FieldDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nconst FIELD_TYPES = [\n  { value: \&quot;text\&quot;, label: \&quot;Text\&quot; },\n  { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n  { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n  { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n  { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n  { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n];\n\nfunction getOptionValues(options: unknown): string[] {\n  if (\n    options &amp;&amp;\n    typeof options === \&quot;object\&quot; &amp;&amp;\n    Array.isArray((options as { values?: unknown[] }).values)\n  ) {\n    const { values } = options as { values?: unknown[] };\n    return (values ?? [])\n      .map((value) =&gt; &#96;${value}&#96;.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction FieldDialog({\n  mode,\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FieldDialogProps) {\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [type, setType] = useState(FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [required, setRequired] = useState(false);\n  const [placeholder, setPlaceholder] = useState(\&quot;\&quot;);\n  const [helpText, setHelpText] = useState(\&quot;\&quot;);\n  const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setLabel(field?.label ?? \&quot;\&quot;);\n      setKeyValue(field?.key ?? \&quot;\&quot;);\n      setType(field?.type ?? FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n      setOrder(String(field?.order ?? 0));\n      setRequired(field?.required ?? false);\n      setPlaceholder(field?.placeholder ?? \&quot;\&quot;);\n      setHelpText(field?.helpText ?? \&quot;\&quot;);\n      const existingOptions = getOptionValues(field?.options ?? null);\n      setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n      setError(null);\n    }\n  }, [open, field]);\n\n  if (!section || !form) return null;\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const options =\n          type === \&quot;select\&quot;\n            ? optionsInput\n                .split(\&quot;,\&quot;)\n                .map((value) =&gt; value.trim())\n                .filter(Boolean)\n            : null;\n        const payload = {\n          label: label.trim(),\n          key: keyValue.trim(),\n          type,\n          order: Number(order),\n          required,\n          placeholder: placeholder.trim() || null,\n          helpText: helpText.trim() || null,\n          options,\n        };\n        if (!payload.label || !payload.key) {\n          setError(\&quot;Label and key are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        const baseUrl = &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields&#96;;\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(baseUrl, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (field) {\n          await jsonRequest(&#96;${baseUrl}/${field.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? &#96;Add field to ${section.label}&#96;\n      : &#96;Edit field (${field?.label ?? \&quot;Field\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-2xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Field type\n              &lt;Select value={type} onValueChange={setType}&gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {FIELD_TYPES.map((option) =&gt; (\n                    &lt;SelectItem key={option.value} value={option.value}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Placeholder\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={placeholder}\n                onChange={(event) =&gt; setPlaceholder(event.target.value)}\n                placeholder=\&quot;Optional placeholder text\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Help text\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={helpText}\n                onChange={(event) =&gt; setHelpText(event.target.value)}\n                placeholder=\&quot;Guidance displayed under the input\&quot;\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {type === \&quot;select\&quot; &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Options (comma separated)\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={optionsInput}\n                onChange={(event) =&gt; setOptionsInput(event.target.value)}\n                placeholder=\&quot;Option A, Option B, Option C\&quot;\n              /&gt;\n            &lt;/label&gt;\n          )}\n          &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n            &lt;input\n              type=\&quot;checkbox\&quot;\n              className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n              checked={required}\n              onChange={(event) =&gt; setRequired(event.target.checked)}\n            /&gt;\n            Required field\n          &lt;/label&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create field\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFieldDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFieldDialog({\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFieldDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields/${field.id}&#96;,\n          { method: \&quot;DELETE\&quot; }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete field?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes &lt;span className=\&quot;font-medium\&quot;&gt;{field.label}&lt;/span&gt; from{\&quot; \&quot;}\n          {section.label}. Existing drafts may lose captured data in this key.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating TODO list statuses**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Inspect Configurations Form Definitions UI to understand current layout
- [x] Add link to view actual form in Form Definitions
- [ ] Test the new link and update documentation if needed

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Deciding on testing and linting**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Summarizing final response with code references**

I'll put together a clear summary highlighting the new Link usage and button, note that Task 3 remains pending without testing, and include a code snippet referencing lines in `components/admin/form-definitions-panel.tsx`. I'll mention the lack of test runs and suggest next steps while reflecting the current TODO status thoughtfully.</details></think>

---

### Form Preview Link Added
- Added a dedicated `View form` button beside each config’s action menu, routing admins to `/forms/{form.id}` in a new tab so they can inspect the rendered wizard without leaving the dashboard.
- Ensured accessibility and clarity by keeping the existing action dropdown and adding an `aria-label` to its trigger for screen-reader context.

```176:214:components/admin/form-definitions-panel.tsx
                <Button variant="outline" size="sm" asChild>
                  <Link
                    href={`/forms/${form.id}`}
                    target="_blank"
                    rel="noreferrer"
                  >
                    View form
                  </Link>
                </Button>
                <DropdownMenu>
                  <DropdownMenuTrigger asChild>
                    <Button variant="ghost" size="icon" aria-label="Form actions">
                      <MoreHorizontal className="h-5 w-5" />
```

### Testing
- Not run (UI-only change; no automated tests executed). Consider verifying in the dashboard by clicking the new button to confirm it opens the expected form.

Let me know if you’d like me to exercise the UI manually or cover additional cases.

---

_**User (2025-11-17 23:03Z)**_

## Error Type

Recoverable Error



## Error Message

Hydration failed because the server rendered text didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:



- A server/client branch `if (typeof window !== 'undefined')`.

- Variable input such as `Date.now()` or `Math.random()` which changes each time it's called.

- Date formatting in a user's locale which doesn't match the server.

- External changing data without sending a snapshot of it along with the HTML.

- Invalid HTML tag nesting.



It can also happen if the client has a browser extension installed which messes with the HTML before React loaded.



https://react.dev/link/hydration-mismatch



  ...

    <HTTPAccessFallbackBoundary notFound={undefined} forbidden={undefined} unauthorized={undefined}>

      <RedirectBoundary>

        <RedirectErrorBoundary router={{...}}>

          <InnerLayoutRouter url="/dashboard..." tree={[...]} params={{}} cacheNode={{lazyData:null, ...}} ...>

            <SegmentViewNode type="page" pagePath="dashboard/...">

              <SegmentTrieNode>

              <FormDefinitionsPage>

                <div className="space-y-6">

                  <div>

                  <FormDefinitionsPanel forms={[...]} entities={[...]} geographies={[...]}>

                    <div className="space-y-6">

                      <div>

                      <div className="space-y-4">

                        <div className="rounded-2x...">

                          <div className="flex flex-...">

                            <div>

                              <div>

                              <p>

                              <p>

                              <p className="text-xs te...">

+                               18/11/2025, 14:26:38

-                               11/18/2025, 2:26:38 PM

                            ...

                          ...

                        ...

                      ...

            ...

          ...







    at <unknown> (+                               18/11/2025, 14:26:38)

    at p (<anonymous>:null:null)

    at <unknown> (components/admin/form-definitions-panel.tsx:194:17)

    at Array.map (<anonymous>:null:null)

    at FormDefinitionsPanel (components/admin/form-definitions-panel.tsx:172:16)

    at FormDefinitionsPage (app/dashboard/admin/forms/page.tsx:36:7)



## Code Frame

  192 |                   <p className="text-sm text-slate-500">{form.description}</p>

  193 |                 )}

> 194 |                 <p className="text-xs text-slate-400">

      |                 ^

  195 |                   Updated {new Date(form.updatedAt).toLocaleString()}

  196 |                 </p>

  197 |               </div>



Next.js version: 16.0.3 (Turbopack)



---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Resolving hydration mismatch from date formatting**

I'm focusing on fixing hydration mismatches caused by differences in locale and timezone between server and client date rendering. To ensure consistent formatting, I'll use `Intl.DateTimeFormat` with a fixed locale `"en-US"` and timezone `"UTC"` so dates render identically on both sides. I'll create a helper formatter at module scope to avoid recreating it each render, then update the relevant components to use this for displaying dates. This should smooth out inconsistent date displays due to locale or timezone discrepancies during hydration without needing heavy test changes.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;17f64393-0673-4e97-a1b8-da809544699b&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    sections: FormSectionSummary[];\n  }\n+ \n+ const UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n+   dateStyle: \&quot;medium\&quot;,\n+   timeStyle: \&quot;short\&quot;,\n+   timeZone: \&quot;UTC\&quot;,\n+ });\n  \n  interface FormDefinitionsPanelProps {&quot;,
        &quot;oldStart&quot;: 91,
        &quot;newStart&quot;: 91,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 10,
        &quot;linesAdded&quot;: 6
      },
      {
        &quot;diffString&quot;: &quot;                  )}\n                  &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n-                   Updated {new Date(form.updatedAt).toLocaleString()}\n+                   Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))}\n+                   {\&quot; \&quot;}\n+                   UTC\n                  &lt;/p&gt;\n                &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 193,
        &quot;newStart&quot;: 199,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 7,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 3
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useEffect, useState, useTransition } from \&quot;react\&quot;;\nimport Link from \&quot;next/link\&quot;;\nimport { useRouter } from \&quot;next/navigation\&quot;;\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \&quot;@/components/ui/dialog\&quot;;\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \&quot;@/components/ui/dropdown-menu\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \&quot;@/components/ui/table\&quot;;\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \&quot;@/components/ui/select\&quot;;\nimport { Input } from \&quot;@/components/ui/input\&quot;;\nimport {\n  Layers,\n  ListTree,\n  MoreHorizontal,\n  Plus,\n  Trash2,\n} from \&quot;lucide-react\&quot;;\n\nimport { jsonRequest } from \&quot;@/lib/admin-api\&quot;;\n\ninterface EntitySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface GeographySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface FormFieldSummary {\n  id: string;\n  key: string;\n  label: string;\n  type: string;\n  required: boolean;\n  order: number;\n  placeholder: string | null;\n  helpText: string | null;\n  options: unknown;\n}\n\ninterface FormSectionSummary {\n  id: string;\n  key: string;\n  label: string;\n  order: number;\n  formConfigId: string;\n  fields: FormFieldSummary[];\n}\n\ninterface FormDefinitionSummary {\n  id: string;\n  entity: EntitySummary;\n  geography: GeographySummary;\n  version: number;\n  title: string | null;\n  description: string | null;\n  isActive: boolean;\n  createdAt: string | Date;\n  updatedAt: string | Date;\n  sections: FormSectionSummary[];\n}\n\nconst UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n  dateStyle: \&quot;medium\&quot;,\n  timeStyle: \&quot;short\&quot;,\n  timeZone: \&quot;UTC\&quot;,\n});\n\ninterface FormDefinitionsPanelProps {\n  forms: FormDefinitionSummary[];\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n}\n\ninterface SectionDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n}\n\ninterface FieldDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n}\n\nexport function FormDefinitionsPanel({\n  forms,\n  entities,\n  geographies,\n}: FormDefinitionsPanelProps) {\n  const router = useRouter();\n  const [createOpen, setCreateOpen] = useState(false);\n  const [editingForm, setEditingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [deletingForm, setDeletingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [sectionDialog, setSectionDialog] = useState&lt;SectionDialogState | null&gt;(\n    null\n  );\n  const [sectionDelete, setSectionDelete] =\n    useState&lt;SectionDialogState | null&gt;(null);\n  const [fieldDialog, setFieldDialog] = useState&lt;FieldDialogState | null&gt;(null);\n  const [fieldDelete, setFieldDelete] = useState&lt;FieldDialogState | null&gt;(null);\n\n  const refresh = () =&gt; router.refresh();\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-4\&quot;&gt;\n        &lt;div className=\&quot;flex items-center gap-2 text-slate-500\&quot;&gt;\n          &lt;Layers className=\&quot;h-4 w-4\&quot; /&gt;\n          &lt;span&gt;\n            {forms.length}{\&quot; \&quot;}\n            {forms.length === 1 ? \&quot;form definition\&quot; : \&quot;form definitions\&quot;}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;Dialog open={createOpen} onOpenChange={setCreateOpen}&gt;\n          &lt;DialogTrigger asChild&gt;\n            &lt;Button className=\&quot;gap-2\&quot;&gt;\n              &lt;Plus className=\&quot;h-4 w-4\&quot; /&gt;\n              New form config\n            &lt;/Button&gt;\n          &lt;/DialogTrigger&gt;\n          &lt;FormConfigDialog\n            mode=\&quot;create\&quot;\n            entities={entities}\n            geographies={geographies}\n            open={createOpen}\n            onOpenChange={setCreateOpen}\n            onSuccess={() =&gt; {\n              setCreateOpen(false);\n              refresh();\n            }}\n          /&gt;\n        &lt;/Dialog&gt;\n      &lt;/div&gt;\n\n      {forms.length === 0 &amp;&amp; (\n        &lt;div className=\&quot;rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center text-slate-500\&quot;&gt;\n          &lt;p&gt;No form definitions yet. Create one to start mapping schema versions.&lt;/p&gt;\n        &lt;/div&gt;\n      )}\n\n      &lt;div className=\&quot;space-y-4\&quot;&gt;\n        {forms.map((form) =&gt; (\n          &lt;div\n            key={form.id}\n            className=\&quot;rounded-2xl border border-slate-200 bg-white p-5 shadow-sm\&quot;\n          &gt;\n            &lt;div className=\&quot;flex flex-wrap items-start justify-between gap-4\&quot;&gt;\n              &lt;div&gt;\n                &lt;div className=\&quot;flex flex-wrap items-center gap-3\&quot;&gt;\n                  &lt;h3 className=\&quot;text-lg font-semibold text-slate-900\&quot;&gt;\n                    {form.entity.name} • {form.geography.code.toUpperCase()} • v\n                    {form.version}\n                  &lt;/h3&gt;\n                  &lt;Badge variant={form.isActive ? \&quot;default\&quot; : \&quot;secondary\&quot;}&gt;\n                    {form.isActive ? \&quot;Active\&quot; : \&quot;Inactive\&quot;}\n                  &lt;/Badge&gt;\n                &lt;/div&gt;\n                {form.title &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-600\&quot;&gt;{form.title}&lt;/p&gt;\n                )}\n                {form.description &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;{form.description}&lt;/p&gt;\n                )}\n                &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n                  Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))}\n                  {\&quot; \&quot;}\n                  UTC\n                &lt;/p&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n                  &lt;Link\n                    href={&#96;/forms/${form.id}&#96;}\n                    target=\&quot;_blank\&quot;\n                    rel=\&quot;noreferrer\&quot;\n                  &gt;\n                    View form\n                  &lt;/Link&gt;\n                &lt;/Button&gt;\n                &lt;DropdownMenu&gt;\n                  &lt;DropdownMenuTrigger asChild&gt;\n                    &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n                      &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n                    &lt;/Button&gt;\n                  &lt;/DropdownMenuTrigger&gt;\n                  &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                    &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n                      Edit config\n                    &lt;/DropdownMenuItem&gt;\n                    &lt;DropdownMenuItem\n                      className=\&quot;text-red-600\&quot;\n                      onClick={() =&gt; setDeletingForm(form)}\n                    &gt;\n                      Delete config\n                    &lt;/DropdownMenuItem&gt;\n                  &lt;/DropdownMenuContent&gt;\n                &lt;/DropdownMenu&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-6 space-y-4\&quot;&gt;\n              {form.sections.length === 0 &amp;&amp; (\n                &lt;div className=\&quot;rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500\&quot;&gt;\n                  No sections configured for this form.\n                &lt;/div&gt;\n              )}\n\n              {form.sections.map((section) =&gt; (\n                &lt;div\n                  key={section.id}\n                  className=\&quot;rounded-xl border border-slate-200 bg-slate-50 p-4\&quot;\n                &gt;\n                  &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-3\&quot;&gt;\n                    &lt;div&gt;\n                      &lt;div className=\&quot;flex items-center gap-2 text-slate-700\&quot;&gt;\n                        &lt;ListTree className=\&quot;h-4 w-4 text-slate-400\&quot; /&gt;\n                        &lt;h4 className=\&quot;text-base font-semibold\&quot;&gt;\n                          {section.label}\n                        &lt;/h4&gt;\n                      &lt;/div&gt;\n                      &lt;p className=\&quot;text-xs font-mono uppercase tracking-wide text-slate-400\&quot;&gt;\n                        {section.key} • order {section.order}\n                      &lt;/p&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex flex-wrap items-center gap-2\&quot;&gt;\n                      &lt;Button\n                        variant=\&quot;outline\&quot;\n                        size=\&quot;sm\&quot;\n                        onClick={() =&gt;\n                          setFieldDialog({\n                            form,\n                            section,\n                            field: null,\n                          })\n                        }\n                      &gt;\n                        &lt;Plus className=\&quot;mr-2 h-3.5 w-3.5\&quot; /&gt;\n                        Field\n                      &lt;/Button&gt;\n                      &lt;DropdownMenu&gt;\n                        &lt;DropdownMenuTrigger asChild&gt;\n                          &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                            &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                          &lt;/Button&gt;\n                        &lt;/DropdownMenuTrigger&gt;\n                        &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                          &lt;DropdownMenuItem\n                            onClick={() =&gt;\n                              setSectionDialog({ form, section })\n                            }\n                          &gt;\n                            Edit section\n                          &lt;/DropdownMenuItem&gt;\n                          &lt;DropdownMenuItem\n                            className=\&quot;text-red-600\&quot;\n                            onClick={() =&gt;\n                              setSectionDelete({ form, section })\n                            }\n                          &gt;\n                            Delete section\n                          &lt;/DropdownMenuItem&gt;\n                        &lt;/DropdownMenuContent&gt;\n                      &lt;/DropdownMenu&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n\n                  &lt;div className=\&quot;mt-3 overflow-hidden rounded-lg border border-slate-200 bg-white\&quot;&gt;\n                    &lt;Table&gt;\n                      &lt;TableHeader className=\&quot;bg-slate-100\&quot;&gt;\n                        &lt;TableRow&gt;\n                          &lt;TableHead&gt;Label&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Key&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Type&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Required\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Order\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-16 text-right\&quot;&gt;\n                            Actions\n                          &lt;/TableHead&gt;\n                        &lt;/TableRow&gt;\n                      &lt;/TableHeader&gt;\n                      &lt;TableBody&gt;\n                        {section.fields.length === 0 &amp;&amp; (\n                          &lt;TableRow&gt;\n                            &lt;TableCell\n                              colSpan={6}\n                              className=\&quot;text-center text-sm text-slate-500\&quot;\n                            &gt;\n                              No fields yet. Add the first field.\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        )}\n                        {section.fields.map((field) =&gt; (\n                          &lt;TableRow key={field.id}&gt;\n                            &lt;TableCell className=\&quot;font-medium text-slate-900\&quot;&gt;\n                              {field.label}\n                              {field.helpText &amp;&amp; (\n                                &lt;p className=\&quot;text-xs text-slate-500\&quot;&gt;\n                                  {field.helpText}\n                                &lt;/p&gt;\n                              )}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;font-mono text-xs uppercase text-slate-500\&quot;&gt;\n                              {field.key}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell&gt;\n                              &lt;Badge variant=\&quot;secondary\&quot;&gt;{field.type}&lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              &lt;Badge\n                                variant={field.required ? \&quot;default\&quot; : \&quot;outline\&quot;}\n                              &gt;\n                                {field.required ? \&quot;Yes\&quot; : \&quot;No\&quot;}\n                              &lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              {field.order}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-right\&quot;&gt;\n                              &lt;DropdownMenu&gt;\n                                &lt;DropdownMenuTrigger asChild&gt;\n                                  &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                                    &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                                  &lt;/Button&gt;\n                                &lt;/DropdownMenuTrigger&gt;\n                                &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                                  &lt;DropdownMenuItem\n                                    onClick={() =&gt;\n                                      setFieldDialog({ form, section, field })\n                                    }\n                                  &gt;\n                                    Edit\n                                  &lt;/DropdownMenuItem&gt;\n                                  &lt;DropdownMenuItem\n                                    className=\&quot;text-red-600\&quot;\n                                    onClick={() =&gt;\n                                      setFieldDelete({ form, section, field })\n                                    }\n                                  &gt;\n                                    Delete\n                                  &lt;/DropdownMenuItem&gt;\n                                &lt;/DropdownMenuContent&gt;\n                              &lt;/DropdownMenu&gt;\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        ))}\n                      &lt;/TableBody&gt;\n                    &lt;/Table&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-4\&quot;&gt;\n              &lt;Button\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={() =&gt; setSectionDialog({ form, section: null })}\n              &gt;\n                &lt;Plus className=\&quot;mr-2 h-4 w-4\&quot; /&gt;\n                Add section\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ))}\n      &lt;/div&gt;\n\n      &lt;FormConfigDialog\n        mode=\&quot;edit\&quot;\n        form={editingForm}\n        entities={entities}\n        geographies={geographies}\n        open={Boolean(editingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setEditingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setEditingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      &lt;DeleteFormDialog\n        form={deletingForm}\n        open={Boolean(deletingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setDeletingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setDeletingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      {sectionDialog?.form &amp;&amp; (\n        &lt;SectionDialog\n          mode={sectionDialog.section ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={sectionDialog.form}\n          section={sectionDialog.section}\n          open={Boolean(sectionDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {sectionDelete?.form &amp;&amp; sectionDelete.section &amp;&amp; (\n        &lt;DeleteSectionDialog\n          form={sectionDelete.form}\n          section={sectionDelete.section}\n          open={Boolean(sectionDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDialog?.form &amp;&amp; (\n        &lt;FieldDialog\n          mode={fieldDialog.field ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={fieldDialog.form}\n          section={fieldDialog.section}\n          field={fieldDialog.field}\n          open={Boolean(fieldDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDelete?.form &amp;&amp; fieldDelete.field &amp;&amp; (\n        &lt;DeleteFieldDialog\n          form={fieldDelete.form}\n          section={fieldDelete.section}\n          field={fieldDelete.field}\n          open={Boolean(fieldDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\ninterface FormConfigDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form?: FormDefinitionSummary | null;\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction FormConfigDialog({\n  mode,\n  form,\n  entities,\n  geographies,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FormConfigDialogProps) {\n  const [entityId, setEntityId] = useState(\&quot;\&quot;);\n  const [geographyId, setGeographyId] = useState(\&quot;\&quot;);\n  const [version, setVersion] = useState(\&quot;1\&quot;);\n  const [title, setTitle] = useState(\&quot;\&quot;);\n  const [description, setDescription] = useState(\&quot;\&quot;);\n  const [isActive, setIsActive] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setEntityId(form?.entity.id ?? entities[0]?.id ?? \&quot;\&quot;);\n      setGeographyId(form?.geography.id ?? geographies[0]?.id ?? \&quot;\&quot;);\n      setVersion(String(form?.version ?? 1));\n      setTitle(form?.title ?? \&quot;\&quot;);\n      setDescription(form?.description ?? \&quot;\&quot;);\n      setIsActive(form?.isActive ?? true);\n      setError(null);\n    }\n  }, [open, form, entities, geographies]);\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          entityId,\n          geographyId,\n          version: Number(version),\n          title: title.trim() || null,\n          description: description.trim() || null,\n          isActive,\n        };\n        if (!payload.entityId || !payload.geographyId) {\n          setError(\&quot;Entity and geography are required\&quot;);\n          return;\n        }\n        if (payload.version &lt; 1 || Number.isNaN(payload.version)) {\n          setError(\&quot;Version must be a positive number\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(\&quot;/api/configuration/forms\&quot;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (form) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const titleText =\n    mode === \&quot;create\&quot; ? \&quot;Create form configuration\&quot; : \&quot;Edit form configuration\&quot;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{titleText}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Entity\n              &lt;Select\n                value={entityId}\n                onValueChange={setEntityId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select entity\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {entities.map((entity) =&gt; (\n                    &lt;SelectItem key={entity.id} value={entity.id}&gt;\n                      {entity.name} ({entity.code})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Geography\n              &lt;Select\n                value={geographyId}\n                onValueChange={setGeographyId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select geography\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {geographies.map((geo) =&gt; (\n                    &lt;SelectItem key={geo.id} value={geo.id}&gt;\n                      {geo.name} ({geo.code.toUpperCase()})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Version\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                min={1}\n                value={version}\n                onChange={(event) =&gt; setVersion(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Title\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={title}\n                onChange={(event) =&gt; setTitle(event.target.value)}\n                placeholder=\&quot;Optional display title\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Description\n              &lt;textarea\n                className=\&quot;mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm\&quot;\n                rows={3}\n                value={description}\n                onChange={(event) =&gt; setDescription(event.target.value)}\n                placeholder=\&quot;Optional description\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input\n                type=\&quot;checkbox\&quot;\n                className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n                checked={isActive}\n                onChange={(event) =&gt; setIsActive(event.target.checked)}\n              /&gt;\n              Active\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending ? \&quot;Saving...\&quot; : mode === \&quot;create\&quot; ? \&quot;Create\&quot; : \&quot;Save\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFormDialogProps {\n  form: FormDefinitionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFormDialog({\n  form,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFormDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n          method: \&quot;DELETE\&quot;,\n        });\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete form configuration?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes the {form.entity.name} • {form.geography.code.toUpperCase()}\n          {\&quot; \&quot;}v{form.version} form. Applications referencing this config will no\n          longer load new drafts.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n            className=\&quot;gap-2\&quot;\n          &gt;\n            &lt;Trash2 className=\&quot;h-4 w-4\&quot; /&gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface SectionDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction SectionDialog({\n  mode,\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: SectionDialogProps) {\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setKeyValue(section?.key ?? \&quot;\&quot;);\n      setLabel(section?.label ?? \&quot;\&quot;);\n      setOrder(String(section?.order ?? 0));\n      setError(null);\n    }\n  }, [open, section]);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          key: keyValue.trim(),\n          label: label.trim(),\n          order: Number(order),\n        };\n        if (!payload.key || !payload.label) {\n          setError(\&quot;Key and label are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}/sections&#96;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (section) {\n          await jsonRequest(\n            &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n            {\n              method: \&quot;PATCH\&quot;,\n              body: JSON.stringify(payload),\n            }\n          );\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? \&quot;Add section\&quot;\n      : &#96;Edit section (${section?.label ?? \&quot;Section\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-lg\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                placeholder=\&quot;company_profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                placeholder=\&quot;Company profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create section\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteSectionDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteSectionDialog({\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteSectionDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n          {\n            method: \&quot;DELETE\&quot;,\n          }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete section?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Removing &lt;span className=\&quot;font-medium\&quot;&gt;{section.label}&lt;/span&gt; deletes\n          {section.fields.length &gt; 0 ? \&quot; its fields as well.\&quot; : \&quot; it immediately.\&quot;}\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface FieldDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nconst FIELD_TYPES = [\n  { value: \&quot;text\&quot;, label: \&quot;Text\&quot; },\n  { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n  { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n  { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n  { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n  { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n];\n\nfunction getOptionValues(options: unknown): string[] {\n  if (\n    options &amp;&amp;\n    typeof options === \&quot;object\&quot; &amp;&amp;\n    Array.isArray((options as { values?: unknown[] }).values)\n  ) {\n    const { values } = options as { values?: unknown[] };\n    return (values ?? [])\n      .map((value) =&gt; &#96;${value}&#96;.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction FieldDialog({\n  mode,\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FieldDialogProps) {\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [type, setType] = useState(FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [required, setRequired] = useState(false);\n  const [placeholder, setPlaceholder] = useState(\&quot;\&quot;);\n  const [helpText, setHelpText] = useState(\&quot;\&quot;);\n  const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setLabel(field?.label ?? \&quot;\&quot;);\n      setKeyValue(field?.key ?? \&quot;\&quot;);\n      setType(field?.type ?? FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n      setOrder(String(field?.order ?? 0));\n      setRequired(field?.required ?? false);\n      setPlaceholder(field?.placeholder ?? \&quot;\&quot;);\n      setHelpText(field?.helpText ?? \&quot;\&quot;);\n      const existingOptions = getOptionValues(field?.options ?? null);\n      setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n      setError(null);\n    }\n  }, [open, field]);\n\n  if (!section || !form) return null;\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const options =\n          type === \&quot;select\&quot;\n            ? optionsInput\n                .split(\&quot;,\&quot;)\n                .map((value) =&gt; value.trim())\n                .filter(Boolean)\n            : null;\n        const payload = {\n          label: label.trim(),\n          key: keyValue.trim(),\n          type,\n          order: Number(order),\n          required,\n          placeholder: placeholder.trim() || null,\n          helpText: helpText.trim() || null,\n          options,\n        };\n        if (!payload.label || !payload.key) {\n          setError(\&quot;Label and key are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        const baseUrl = &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields&#96;;\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(baseUrl, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (field) {\n          await jsonRequest(&#96;${baseUrl}/${field.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? &#96;Add field to ${section.label}&#96;\n      : &#96;Edit field (${field?.label ?? \&quot;Field\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-2xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Field type\n              &lt;Select value={type} onValueChange={setType}&gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {FIELD_TYPES.map((option) =&gt; (\n                    &lt;SelectItem key={option.value} value={option.value}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Placeholder\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={placeholder}\n                onChange={(event) =&gt; setPlaceholder(event.target.value)}\n                placeholder=\&quot;Optional placeholder text\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Help text\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={helpText}\n                onChange={(event) =&gt; setHelpText(event.target.value)}\n                placeholder=\&quot;Guidance displayed under the input\&quot;\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {type === \&quot;select\&quot; &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Options (comma separated)\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={optionsInput}\n                onChange={(event) =&gt; setOptionsInput(event.target.value)}\n                placeholder=\&quot;Option A, Option B, Option C\&quot;\n              /&gt;\n            &lt;/label&gt;\n          )}\n          &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n            &lt;input\n              type=\&quot;checkbox\&quot;\n              className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n              checked={required}\n              onChange={(event) =&gt; setRequired(event.target.checked)}\n            /&gt;\n            Required field\n          &lt;/label&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create field\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFieldDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFieldDialog({\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFieldDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields/${field.id}&#96;,\n          { method: \&quot;DELETE\&quot; }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete field?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes &lt;span className=\&quot;font-medium\&quot;&gt;{field.label}&lt;/span&gt; from{\&quot; \&quot;}\n          {section.label}. Existing drafts may lose captured data in this key.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Running lint checks**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Deciding on task updates**</details></think>

---

### Hydration Fix
- Replaced `toLocaleString()` with a deterministic `Intl.DateTimeFormat` configured for `en-US` and `UTC`, ensuring the server and client render identical timestamps and preventing hydration mismatches.
- Added a trailing `UTC` label so admins know the reference timezone.

```187:196:components/admin/form-definitions-panel.tsx
const UPDATED_AT_FORMATTER = new Intl.DateTimeFormat("en-US", {
  dateStyle: "medium",
  timeStyle: "short",
  timeZone: "UTC",
});
…
<p className="text-xs text-slate-400">
  Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))} UTC
</p>
```

### Testing
- Not run (UI-only formatting fix). Please refresh `/dashboard/admin/forms` to confirm no hydration warnings remain.

---

_**User (2025-11-17 23:03Z)**_

I don't see a field type for Document Upload. What fields do we support today and which ones are we not supporting? 

---

_**Agent (model default, mode Ask)**_

<think><details><summary>Thought Process</summary>
**Reviewing supported form field types**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-field-renderer.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Explaining supported form field types**</details></think>

---

### Current Support
- `components/admin/form-definitions-panel.tsx` limits new fields to `text`, `textarea`, `number`, `select`, `boolean`, `date` via the `FIELD_TYPES` picker.  
```962:968:components/admin/form-definitions-panel.tsx
const FIELD_TYPES = [
  { value: "text", label: "Text" },
  { value: "textarea", label: "Textarea" },
  { value: "number", label: "Number" },
  { value: "select", label: "Select" },
  { value: "boolean", label: "Boolean" },
  { value: "date", label: "Date" },
];
```
- The runtime renderer in `components/forms/form-field-renderer.tsx` can display a few more primitives (email, tel, multi-select, checkbox/radio aliases) but still only covers textual, numeric, choice, and date inputs.  
```45:185:components/forms/form-field-renderer.tsx
switch (field.type) {
  case "text": …;
  case "email": …;
  case "number": …;
  case "tel": …;
  case "textarea": …;
  case "select": …;
  case "multi-select": …;
  case "checkbox":
  case "boolean": …;
  case "radio": …;
  case "date": …;
  default:
    console.warn(`Unknown field type: ${field.type}`);
    return <div>Unknown field type: {field.type}</div>;
}
```

### Not Supported
- There is no field type for document or file uploads anywhere in the schema, admin UI, or renderer, so admins cannot configure a document upload today.
- Other input classes—currency, rich text, signatures, etc.—also lack handling, but “Document Upload” is the primary gap you noted.

If you’d like to add document upload support, we’d need to extend both the admin `FIELD_TYPES` options and the renderer (plus create a dedicated input component that integrates with the supplier document storage flow).

---

_**User (2025-11-17 23:03Z)**_

1. add document upload support, we’d need to extend both the admin FIELD_TYPES options and the renderer (plus create a dedicated input component that integrates with the supplier document storage flow).



2. Add all the other fields types that we can render to the backend form definition panel. 

---

_**Agent (model default, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Creating a task list**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] Review form field rendering and existing field components
- [ ] Extend backend form definitions to support all renderer field types
- [ ] Add document upload field: component, renderer, admin UI
- [ ] Validate changes with lint/tests if applicable

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Searching for document upload components**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "DocumentUpload" in "/Users/sahilmehta/supplier-onboarding-simple" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `./app/supplier/onboarding/[id]/page.tsx` | `import \{ DocumentUploader \} from "@/components/supplier/document-uploader";` | L7 |
| `./app/supplier/onboarding/[id]/page.tsx` | `<DocumentUploader applicationId=\{application.id\} />` | L120 |
| `./components/supplier/document-uploader.tsx` | `interface DocumentUploaderProps \{` | L5 |
| `./components/supplier/document-uploader.tsx` | `export function DocumentUploader(\{ applicationId \}: DocumentUploaderProps) \{` | L9 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/supplier/document-uploader.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Planning document upload integration**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-wizard-client.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Investigating applicationId access in form fields**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/dynamic-form-wizard.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Investigating applicationId propagation**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-step.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Investigating missing applicationId usage**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "<FormStep" in "/Users/sahilmehta/supplier-onboarding-simple/components/forms/dynamic-form-wizard.tsx" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `components/forms/dynamic-form-wizard.tsx` | `<FormStep` | L423 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/dynamic-form-wizard.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing form component props**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_directory** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/app/api/documents/sign/route.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Locating storage requirements and API route**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/app/api/documents/route.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Designing document upload field integration**

I'm planning to add document upload support by expanding the form field types and creating a new `FieldDocumentUpload` component. I need to align the field types with those supported by the renderer, handle application ID requirements for uploads, and mimic existing document upload flows where the upload sign URL is fetched but actual storage integration is incomplete. I'll verify API interaction patterns for signing and registering documents to fit the supplier document storage flow.</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "documents/sign" in "/Users/sahilmehta/supplier-onboarding-simple" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `./components/supplier/document-uploader.tsx` | `await fetch("/api/documents/sign", \{` | L20 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Designing document upload integration**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "documentType" in "/Users/sahilmehta/supplier-onboarding-simple" • 68 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `./app/dev/wizard-preview/page.tsx` | `documentTypeId: "doc-w9",` | L170 |
| `./app/dev/wizard-preview/page.tsx` | `documentType: \{` | L173 |
| `./app/dashboard/procurement/[id]/page.tsx` | `include: \{ documentType: true \},` | L26 |
| `./app/dashboard/procurement/[id]/page.tsx` | `\{doc.documentType?.label ?? doc.documentTypeId\}` | L115 |
| `./app/dashboard/admin/documents/page.tsx` | `const documents = await prisma.documentType.findMany(\{` | L6 |
| `./app/api/documents/route.ts` | `const \{ applicationId, documentTypeKey, fileId, fileName, mimeType, fileSize \} = body;` | L12 |
| `./app/api/documents/route.ts` | `if (!applicationId \|\| !fileId \|\| !documentTypeKey \|\| !fileName) \{` | L14 |
| `./app/api/documents/route.ts` | `const documentType = await prisma.documentType.findUnique(\{` | L31 |
| `./app/api/documents/route.ts` | `where: \{ key: documentTypeKey \},` | L32 |
| `./app/api/documents/route.ts` | `if (!documentType) \{` | L35 |
| `./app/api/documents/route.ts` | `documentTypeId: documentType.id,` | L42 |
| `./app/api/configuration/requirements/route.ts` | `\{ documentType: \{ label: "asc" \} \},` | L25 |
| `./app/api/configuration/requirements/route.ts` | `documentType: true,` | L34 |
| `./app/api/configuration/requirements/route.ts` | `const documentTypeId = body?.documentTypeId?.trim();` | L48 |
| `./app/api/configuration/requirements/route.ts` | `if (!documentTypeId) \{` | L56 |
| `./app/api/configuration/requirements/route.ts` | `return badRequest("documentTypeId is required");` | L57 |
| `./app/api/configuration/requirements/route.ts` | `formConfigId_documentTypeId: \{` | L62 |
| `./app/api/configuration/requirements/route.ts` | `documentTypeId,` | L64 |
| `./app/api/configuration/requirements/route.ts` | `documentTypeId,` | L73 |
| `./app/api/configuration/requirements/route.ts` | `documentType: true,` | L81 |
| `./app/api/configuration/requirements/route.ts` | `documentTypeId,` | L91 |
| `./app/api/configuration/documents/route.ts` | `const documents = await prisma.documentType.findMany(\{` | L20 |
| `./app/api/configuration/documents/route.ts` | `const documentType = await prisma.documentType.create(\{` | L48 |
| `./app/api/configuration/documents/route.ts` | `details: \{ documentTypeId: documentType.id, key, label, category \},` | L60 |
| `./app/api/configuration/documents/route.ts` | `return NextResponse.json(\{ documentType \}, \{ status: 201 \});` | L64 |
| `./app/api/configuration/forms/route.ts` | `documentType: true,` | L30 |
| `./app/api/configuration/documents/[id]/route.ts` | `const documentType = await prisma.documentType.update(\{` | L65 |
| `./app/api/configuration/documents/[id]/route.ts` | `details: \{ documentTypeId: documentType.id, data \},` | L73 |
| `./app/api/configuration/documents/[id]/route.ts` | `return NextResponse.json(\{ documentType \});` | L77 |
| `./app/api/configuration/documents/[id]/route.ts` | `await prisma.documentType.delete(\{` | L90 |
| `./app/api/configuration/documents/[id]/route.ts` | `details: \{ documentTypeId: id \},` | L97 |
| `./lib/forms/types.ts` | `documentRules: (FormDocumentRequirement & \{ documentType: DocumentType \})[];` | L21 |
| `./lib/forms/form-config-fetcher.ts` | `documentType: true,` | L39 |
| `./lib/forms/form-config-fetcher.ts` | `documentType: true,` | L78 |
| `./app/dashboard/admin/requirements/page.tsx` | `\{ documentType: \{ label: "asc" \} \},` | L12 |
| `./app/dashboard/admin/requirements/page.tsx` | `documentType: true,` | L21 |
| `./app/dashboard/admin/requirements/page.tsx` | `prisma.documentType.findMany(\{` | L31 |
| `./components/admin/document-requirements-panel.tsx` | `documentType: \{` | L51 |
| `./components/admin/document-requirements-panel.tsx` | `<Badge variant="secondary">\{req.documentType.category\}</Badge>` | L149 |
| `./components/admin/document-requirements-panel.tsx` | `<span>\{req.documentType.label\}</span>` | L150 |
| `./components/admin/document-requirements-panel.tsx` | `\{req.documentType.key\}` | L153 |
| `./components/admin/document-requirements-panel.tsx` | `const [documentTypeId, setDocumentTypeId] = useState("");` | L243 |
| `./components/admin/document-requirements-panel.tsx` | `requirement?.documentType.id ?? documents[0]?.id ?? ""` | L255 |
| `./components/admin/document-requirements-panel.tsx` | `documentTypeId,` | L290 |
| `./components/admin/document-requirements-panel.tsx` | `value=\{documentTypeId\}` | L335 |
| `./components/admin/document-requirements-panel.tsx` | `This disconnects \{requirement?.documentType.label\} from\{" "\}` | L438 |
| `./supplier_capabilities/tests/configuration-api.test.ts` | `documentTypeId: "doc-1",` | L104 |
| `./supplier_capabilities/tests/configuration-api.test.ts` | `documentType: \{` | L113 |
| `./supplier_capabilities/tests/configuration-api.test.ts` | `documentTypeId: "doc-1",` | L126 |
| `./supplier_capabilities/tests/configuration-api.test.ts` | `formConfigId_documentTypeId: \{` | L138 |
| `./supplier_capabilities/tests/configuration-api.test.ts` | `documentTypeId: "doc-1",` | L140 |
| `./supplier_capabilities/tests/configuration-api.test.ts` | `documentTypeId: "doc-1",` | L149 |
| `./supplier_capabilities/tests/configuration-api.test.ts` | `documentType: true,` | L155 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `"documentTypeId" TEXT NOT NULL,` | L142 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `CREATE UNIQUE INDEX IF NOT EXISTS "FormDocumentRequirement_formConfigId_documentTypeId_key"` | L148 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `ON "FormDocumentRequirement"("formConfigId", "documentTypeId");` | L149 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `"documentTypeId" TEXT NOT NULL,` | L180 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `ADD CONSTRAINT "FormDocumentRequirement_documentTypeId_fkey"` | L244 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `FOREIGN KEY ("documentTypeId") REFERENCES "DocumentType"("id") ON DELETE CASCADE ON UPDATE CASCADE;` | L245 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `ADD CONSTRAINT "ApplicationDocument_documentTypeId_fkey"` | L264 |
| `./prisma/migrations/20251117125500_sync_schema_core_tables/migration.sql` | `FOREIGN KEY ("documentTypeId") REFERENCES "DocumentType"("id") ON DELETE CASCADE ON UPDATE CASCADE,` | L265 |
| `./prisma/schema.prisma` | `documentTypeId String` | L208 |
| `./prisma/schema.prisma` | `documentType  DocumentType @relation(fields: [documentTypeId], references: [id], onDelete: Cascade)` | L212 |
| `./prisma/schema.prisma` | `@@unique([formConfigId, documentTypeId])` | L214 |
| `./prisma/schema.prisma` | `documentTypeId  String` | L254 |
| `./prisma/schema.prisma` | `documentType    DocumentType  @relation(fields: [documentTypeId], references: [id], onDelete: Cascade)` | L262 |
| `./prisma/seed.ts` | `const documentType = await prisma.documentType.upsert(\{` | L152 |
| `./prisma/seed.ts` | `documentTypeId: documentType.id,` | L166 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Planning document upload field addition**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/prisma/schema.prisma</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Inspecting form field types**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/lib/forms/types.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Planning new document field type**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/field-input-text.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Inspecting FieldWrapper styles**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/field-wrapper.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Extending form for document upload**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/lib/form-schema.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Checking schema for multi-select usage**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "multi-select" in "/Users/sahilmehta/supplier-onboarding-simple" • 12 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `./docs/features.md` | `- Supports all field types: text, email, number, select, multi-select, checkbox, radio, date, textarea, file` | L206 |
| `./docs/features.md` | `- Field types: text, email, number, select, multi-select, checkbox, radio, date, textarea, file` | L430 |
| `./docs/ui-implementation-summary.md` | `- `FormFieldRenderer` delegates to specialized controls (text, email, number, select, multi-select, checkbox, radio, date, textarea, file).` | L32 |
| `./components/forms/form-field-renderer.tsx` | `import \{ FieldInputMultiSelect \} from "./field-input-multi-select";` | L11 |
| `./components/forms/form-field-renderer.tsx` | `case "multi-select":` | L125 |
| `./components/forms/form-step.tsx` | `const shouldSpanFullWidth = ["textarea", "multi-select", "checkbox", "radio"].includes(field.type);` | L56 |
| `./components/forms/index.ts` | `export \{ FieldInputMultiSelect \} from "./field-input-multi-select";` | L16 |
| `./components/forms/field-input-multi-select.tsx` | `* For production, consider using a dedicated multi-select component like Combobox.` | L28 |
| `./docs/streams-1-4-verification-report.md` | `- ✅ `components/forms/field-input-multi-select.tsx` - Exists` | L54 |
| `./docs/dynamic-form-rendering-prd.md` | `- Support all field types: text, number, email, select, multi-select, checkbox, radio, date, textarea, file` | L32 |
| `./docs/dynamic-form-rendering-prd.md` | `- `multi-select` → Multi-select component (Shadcn Combobox)` | L208 |
| `./docs/prd.txt` | `* Field type (text, number, select, multi-select, date, file, boolean)` | L258 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Verifying multi-select field data type**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/field-input-multi-select.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Checking useFormState handling of multi-select arrays**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/hooks/use-form-state.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Checking form-validator capabilities**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/lib/forms/form-validator.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Analyzing document field schema update**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/admin/document-requirements-panel.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Designing document field enhancements**

I’m mapping out how to let admins pick Document Types for document fields by fetching document type data in the form admin page and passing it down to the field editor. I need to extend the field dialog UI to handle document-specific options, restructure option storage for various field types, and build a new FieldDocumentUpload component to manage uploads with API integration, error handling, and state. I’m also planning updates to schema validation, form rendering, and prop passing to smoothly incorporate this new document field type throughout the form system.
**Extending form field handling for documents**

I’m planning detailed updates to manage document fields end-to-end: enhancing FieldDialog to handle document type keys with validation and defaults, refining option parsing and types, updating form schema with proper validation for multi-select and document types, and modifying form rendering to include the new FieldDocumentUpload component with full upload flow and UI states. This also involves passing applicationId through form steps so document uploads integrate smoothly and ensuring backward compatibility with existing field types.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/app/dashboard/admin/forms/page.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;58c63b49-c71c-4f19-bbc4-2ba56c95ae4e&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  \n  export default async function FormDefinitionsPage() {\n-   const [forms, entities, geographies] = await Promise.all([\n+   const [forms, entities, geographies, documentTypes] = await Promise.all([\n      prisma.formConfig.findMany({\n        orderBy: [{ updatedAt: \&quot;desc\&quot; }],&quot;,
        &quot;oldStart&quot;: 4,
        &quot;newStart&quot;: 4,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;      prisma.entity.findMany({ orderBy: { name: \&quot;asc\&quot; } }),\n      prisma.geography.findMany({ orderBy: { name: \&quot;asc\&quot; } }),\n+     prisma.documentType.findMany({ orderBy: { label: \&quot;asc\&quot; } }),\n    ]);\n  &quot;,
        &quot;oldStart&quot;: 22,
        &quot;newStart&quot;: 22,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;          entities={entities}\n          geographies={geographies}\n+         documentTypes={documentTypes}\n        /&gt;\n      &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 38,
        &quot;newStart&quot;: 39,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/app/dashboard/admin/forms/page.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { prisma } from \&quot;@/lib/prisma\&quot;;\n\nimport { FormDefinitionsPanel } from \&quot;@/components/admin/form-definitions-panel\&quot;;\n\nexport default async function FormDefinitionsPage() {\n  const [forms, entities, geographies, documentTypes] = await Promise.all([\n    prisma.formConfig.findMany({\n      orderBy: [{ updatedAt: \&quot;desc\&quot; }],\n      include: {\n        entity: true,\n        geography: true,\n        sections: {\n          orderBy: [{ order: \&quot;asc\&quot; }],\n          include: {\n            fields: {\n              orderBy: [{ order: \&quot;asc\&quot; }],\n            },\n          },\n        },\n      },\n    }),\n    prisma.entity.findMany({ orderBy: { name: \&quot;asc\&quot; } }),\n    prisma.geography.findMany({ orderBy: { name: \&quot;asc\&quot; } }),\n    prisma.documentType.findMany({ orderBy: { label: \&quot;asc\&quot; } }),\n  ]);\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div&gt;\n        &lt;h2 className=\&quot;text-xl font-semibold text-slate-900\&quot;&gt;\n          Form definitions\n        &lt;/h2&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Control entity + geography specific onboarding schema versions.\n        &lt;/p&gt;\n      &lt;/div&gt;\n      &lt;FormDefinitionsPanel\n        forms={forms}\n        entities={entities}\n        geographies={geographies}\n        documentTypes={documentTypes}\n      /&gt;\n    &lt;/div&gt;\n  );\n}\n\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing to update FormDefinitionsPanel**</details></think>

---

The model made no changes to the file.

---

<think><details><summary>Thought Process</summary>
**Reviewing code sections carefully**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Adding DocumentType interface**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;d0282787-6ea7-4e88-a2af-a9f8c8ab19f6&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    sections: FormSectionSummary[];\n  }\n+ \n+ interface DocumentTypeSummary {\n+   id: string;\n+   key: string;\n+   label: string;\n+   category: string;\n+ }\n  \n  const UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {&quot;,
        &quot;oldStart&quot;: 91,
        &quot;newStart&quot;: 91,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 11,
        &quot;linesAdded&quot;: 7
      },
      {
        &quot;diffString&quot;: &quot;    entities: EntitySummary[];\n    geographies: GeographySummary[];\n+   documentTypes: DocumentTypeSummary[];\n  }\n  &quot;,
        &quot;oldStart&quot;: 102,
        &quot;newStart&quot;: 109,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;    entities,\n    geographies,\n+   documentTypes,\n  }: FormDefinitionsPanelProps) {\n    const router = useRouter();&quot;,
        &quot;oldStart&quot;: 119,
        &quot;newStart&quot;: 127,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;            field={fieldDialog.field}\n            open={Boolean(fieldDialog)}\n+           documentTypes={documentTypes}\n            onOpenChange={(open) =&gt; {\n              if (!open) setFieldDialog(null);&quot;,
        &quot;oldStart&quot;: 470,
        &quot;newStart&quot;: 479,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useEffect, useState, useTransition } from \&quot;react\&quot;;\nimport Link from \&quot;next/link\&quot;;\nimport { useRouter } from \&quot;next/navigation\&quot;;\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \&quot;@/components/ui/dialog\&quot;;\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \&quot;@/components/ui/dropdown-menu\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \&quot;@/components/ui/table\&quot;;\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \&quot;@/components/ui/select\&quot;;\nimport { Input } from \&quot;@/components/ui/input\&quot;;\nimport {\n  Layers,\n  ListTree,\n  MoreHorizontal,\n  Plus,\n  Trash2,\n} from \&quot;lucide-react\&quot;;\n\nimport { jsonRequest } from \&quot;@/lib/admin-api\&quot;;\n\ninterface EntitySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface GeographySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface FormFieldSummary {\n  id: string;\n  key: string;\n  label: string;\n  type: string;\n  required: boolean;\n  order: number;\n  placeholder: string | null;\n  helpText: string | null;\n  options: unknown;\n}\n\ninterface FormSectionSummary {\n  id: string;\n  key: string;\n  label: string;\n  order: number;\n  formConfigId: string;\n  fields: FormFieldSummary[];\n}\n\ninterface FormDefinitionSummary {\n  id: string;\n  entity: EntitySummary;\n  geography: GeographySummary;\n  version: number;\n  title: string | null;\n  description: string | null;\n  isActive: boolean;\n  createdAt: string | Date;\n  updatedAt: string | Date;\n  sections: FormSectionSummary[];\n}\n\ninterface DocumentTypeSummary {\n  id: string;\n  key: string;\n  label: string;\n  category: string;\n}\n\nconst UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n  dateStyle: \&quot;medium\&quot;,\n  timeStyle: \&quot;short\&quot;,\n  timeZone: \&quot;UTC\&quot;,\n});\n\ninterface FormDefinitionsPanelProps {\n  forms: FormDefinitionSummary[];\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  documentTypes: DocumentTypeSummary[];\n}\n\ninterface SectionDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n}\n\ninterface FieldDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n}\n\nexport function FormDefinitionsPanel({\n  forms,\n  entities,\n  geographies,\n  documentTypes,\n}: FormDefinitionsPanelProps) {\n  const router = useRouter();\n  const [createOpen, setCreateOpen] = useState(false);\n  const [editingForm, setEditingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [deletingForm, setDeletingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [sectionDialog, setSectionDialog] = useState&lt;SectionDialogState | null&gt;(\n    null\n  );\n  const [sectionDelete, setSectionDelete] =\n    useState&lt;SectionDialogState | null&gt;(null);\n  const [fieldDialog, setFieldDialog] = useState&lt;FieldDialogState | null&gt;(null);\n  const [fieldDelete, setFieldDelete] = useState&lt;FieldDialogState | null&gt;(null);\n\n  const refresh = () =&gt; router.refresh();\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-4\&quot;&gt;\n        &lt;div className=\&quot;flex items-center gap-2 text-slate-500\&quot;&gt;\n          &lt;Layers className=\&quot;h-4 w-4\&quot; /&gt;\n          &lt;span&gt;\n            {forms.length}{\&quot; \&quot;}\n            {forms.length === 1 ? \&quot;form definition\&quot; : \&quot;form definitions\&quot;}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;Dialog open={createOpen} onOpenChange={setCreateOpen}&gt;\n          &lt;DialogTrigger asChild&gt;\n            &lt;Button className=\&quot;gap-2\&quot;&gt;\n              &lt;Plus className=\&quot;h-4 w-4\&quot; /&gt;\n              New form config\n            &lt;/Button&gt;\n          &lt;/DialogTrigger&gt;\n          &lt;FormConfigDialog\n            mode=\&quot;create\&quot;\n            entities={entities}\n            geographies={geographies}\n            open={createOpen}\n            onOpenChange={setCreateOpen}\n            onSuccess={() =&gt; {\n              setCreateOpen(false);\n              refresh();\n            }}\n          /&gt;\n        &lt;/Dialog&gt;\n      &lt;/div&gt;\n\n      {forms.length === 0 &amp;&amp; (\n        &lt;div className=\&quot;rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center text-slate-500\&quot;&gt;\n          &lt;p&gt;No form definitions yet. Create one to start mapping schema versions.&lt;/p&gt;\n        &lt;/div&gt;\n      )}\n\n      &lt;div className=\&quot;space-y-4\&quot;&gt;\n        {forms.map((form) =&gt; (\n          &lt;div\n            key={form.id}\n            className=\&quot;rounded-2xl border border-slate-200 bg-white p-5 shadow-sm\&quot;\n          &gt;\n            &lt;div className=\&quot;flex flex-wrap items-start justify-between gap-4\&quot;&gt;\n              &lt;div&gt;\n                &lt;div className=\&quot;flex flex-wrap items-center gap-3\&quot;&gt;\n                  &lt;h3 className=\&quot;text-lg font-semibold text-slate-900\&quot;&gt;\n                    {form.entity.name} • {form.geography.code.toUpperCase()} • v\n                    {form.version}\n                  &lt;/h3&gt;\n                  &lt;Badge variant={form.isActive ? \&quot;default\&quot; : \&quot;secondary\&quot;}&gt;\n                    {form.isActive ? \&quot;Active\&quot; : \&quot;Inactive\&quot;}\n                  &lt;/Badge&gt;\n                &lt;/div&gt;\n                {form.title &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-600\&quot;&gt;{form.title}&lt;/p&gt;\n                )}\n                {form.description &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;{form.description}&lt;/p&gt;\n                )}\n                &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n                  Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))}\n                  {\&quot; \&quot;}\n                  UTC\n                &lt;/p&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n                  &lt;Link\n                    href={&#96;/forms/${form.id}&#96;}\n                    target=\&quot;_blank\&quot;\n                    rel=\&quot;noreferrer\&quot;\n                  &gt;\n                    View form\n                  &lt;/Link&gt;\n                &lt;/Button&gt;\n                &lt;DropdownMenu&gt;\n                  &lt;DropdownMenuTrigger asChild&gt;\n                    &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n                      &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n                    &lt;/Button&gt;\n                  &lt;/DropdownMenuTrigger&gt;\n                  &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                    &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n                      Edit config\n                    &lt;/DropdownMenuItem&gt;\n                    &lt;DropdownMenuItem\n                      className=\&quot;text-red-600\&quot;\n                      onClick={() =&gt; setDeletingForm(form)}\n                    &gt;\n                      Delete config\n                    &lt;/DropdownMenuItem&gt;\n                  &lt;/DropdownMenuContent&gt;\n                &lt;/DropdownMenu&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-6 space-y-4\&quot;&gt;\n              {form.sections.length === 0 &amp;&amp; (\n                &lt;div className=\&quot;rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500\&quot;&gt;\n                  No sections configured for this form.\n                &lt;/div&gt;\n              )}\n\n              {form.sections.map((section) =&gt; (\n                &lt;div\n                  key={section.id}\n                  className=\&quot;rounded-xl border border-slate-200 bg-slate-50 p-4\&quot;\n                &gt;\n                  &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-3\&quot;&gt;\n                    &lt;div&gt;\n                      &lt;div className=\&quot;flex items-center gap-2 text-slate-700\&quot;&gt;\n                        &lt;ListTree className=\&quot;h-4 w-4 text-slate-400\&quot; /&gt;\n                        &lt;h4 className=\&quot;text-base font-semibold\&quot;&gt;\n                          {section.label}\n                        &lt;/h4&gt;\n                      &lt;/div&gt;\n                      &lt;p className=\&quot;text-xs font-mono uppercase tracking-wide text-slate-400\&quot;&gt;\n                        {section.key} • order {section.order}\n                      &lt;/p&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex flex-wrap items-center gap-2\&quot;&gt;\n                      &lt;Button\n                        variant=\&quot;outline\&quot;\n                        size=\&quot;sm\&quot;\n                        onClick={() =&gt;\n                          setFieldDialog({\n                            form,\n                            section,\n                            field: null,\n                          })\n                        }\n                      &gt;\n                        &lt;Plus className=\&quot;mr-2 h-3.5 w-3.5\&quot; /&gt;\n                        Field\n                      &lt;/Button&gt;\n                      &lt;DropdownMenu&gt;\n                        &lt;DropdownMenuTrigger asChild&gt;\n                          &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                            &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                          &lt;/Button&gt;\n                        &lt;/DropdownMenuTrigger&gt;\n                        &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                          &lt;DropdownMenuItem\n                            onClick={() =&gt;\n                              setSectionDialog({ form, section })\n                            }\n                          &gt;\n                            Edit section\n                          &lt;/DropdownMenuItem&gt;\n                          &lt;DropdownMenuItem\n                            className=\&quot;text-red-600\&quot;\n                            onClick={() =&gt;\n                              setSectionDelete({ form, section })\n                            }\n                          &gt;\n                            Delete section\n                          &lt;/DropdownMenuItem&gt;\n                        &lt;/DropdownMenuContent&gt;\n                      &lt;/DropdownMenu&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n\n                  &lt;div className=\&quot;mt-3 overflow-hidden rounded-lg border border-slate-200 bg-white\&quot;&gt;\n                    &lt;Table&gt;\n                      &lt;TableHeader className=\&quot;bg-slate-100\&quot;&gt;\n                        &lt;TableRow&gt;\n                          &lt;TableHead&gt;Label&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Key&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Type&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Required\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Order\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-16 text-right\&quot;&gt;\n                            Actions\n                          &lt;/TableHead&gt;\n                        &lt;/TableRow&gt;\n                      &lt;/TableHeader&gt;\n                      &lt;TableBody&gt;\n                        {section.fields.length === 0 &amp;&amp; (\n                          &lt;TableRow&gt;\n                            &lt;TableCell\n                              colSpan={6}\n                              className=\&quot;text-center text-sm text-slate-500\&quot;\n                            &gt;\n                              No fields yet. Add the first field.\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        )}\n                        {section.fields.map((field) =&gt; (\n                          &lt;TableRow key={field.id}&gt;\n                            &lt;TableCell className=\&quot;font-medium text-slate-900\&quot;&gt;\n                              {field.label}\n                              {field.helpText &amp;&amp; (\n                                &lt;p className=\&quot;text-xs text-slate-500\&quot;&gt;\n                                  {field.helpText}\n                                &lt;/p&gt;\n                              )}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;font-mono text-xs uppercase text-slate-500\&quot;&gt;\n                              {field.key}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell&gt;\n                              &lt;Badge variant=\&quot;secondary\&quot;&gt;{field.type}&lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              &lt;Badge\n                                variant={field.required ? \&quot;default\&quot; : \&quot;outline\&quot;}\n                              &gt;\n                                {field.required ? \&quot;Yes\&quot; : \&quot;No\&quot;}\n                              &lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              {field.order}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-right\&quot;&gt;\n                              &lt;DropdownMenu&gt;\n                                &lt;DropdownMenuTrigger asChild&gt;\n                                  &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                                    &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                                  &lt;/Button&gt;\n                                &lt;/DropdownMenuTrigger&gt;\n                                &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                                  &lt;DropdownMenuItem\n                                    onClick={() =&gt;\n                                      setFieldDialog({ form, section, field })\n                                    }\n                                  &gt;\n                                    Edit\n                                  &lt;/DropdownMenuItem&gt;\n                                  &lt;DropdownMenuItem\n                                    className=\&quot;text-red-600\&quot;\n                                    onClick={() =&gt;\n                                      setFieldDelete({ form, section, field })\n                                    }\n                                  &gt;\n                                    Delete\n                                  &lt;/DropdownMenuItem&gt;\n                                &lt;/DropdownMenuContent&gt;\n                              &lt;/DropdownMenu&gt;\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        ))}\n                      &lt;/TableBody&gt;\n                    &lt;/Table&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-4\&quot;&gt;\n              &lt;Button\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={() =&gt; setSectionDialog({ form, section: null })}\n              &gt;\n                &lt;Plus className=\&quot;mr-2 h-4 w-4\&quot; /&gt;\n                Add section\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ))}\n      &lt;/div&gt;\n\n      &lt;FormConfigDialog\n        mode=\&quot;edit\&quot;\n        form={editingForm}\n        entities={entities}\n        geographies={geographies}\n        open={Boolean(editingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setEditingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setEditingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      &lt;DeleteFormDialog\n        form={deletingForm}\n        open={Boolean(deletingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setDeletingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setDeletingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      {sectionDialog?.form &amp;&amp; (\n        &lt;SectionDialog\n          mode={sectionDialog.section ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={sectionDialog.form}\n          section={sectionDialog.section}\n          open={Boolean(sectionDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {sectionDelete?.form &amp;&amp; sectionDelete.section &amp;&amp; (\n        &lt;DeleteSectionDialog\n          form={sectionDelete.form}\n          section={sectionDelete.section}\n          open={Boolean(sectionDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDialog?.form &amp;&amp; (\n        &lt;FieldDialog\n          mode={fieldDialog.field ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={fieldDialog.form}\n          section={fieldDialog.section}\n          field={fieldDialog.field}\n          open={Boolean(fieldDialog)}\n          documentTypes={documentTypes}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDelete?.form &amp;&amp; fieldDelete.field &amp;&amp; (\n        &lt;DeleteFieldDialog\n          form={fieldDelete.form}\n          section={fieldDelete.section}\n          field={fieldDelete.field}\n          open={Boolean(fieldDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\ninterface FormConfigDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form?: FormDefinitionSummary | null;\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction FormConfigDialog({\n  mode,\n  form,\n  entities,\n  geographies,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FormConfigDialogProps) {\n  const [entityId, setEntityId] = useState(\&quot;\&quot;);\n  const [geographyId, setGeographyId] = useState(\&quot;\&quot;);\n  const [version, setVersion] = useState(\&quot;1\&quot;);\n  const [title, setTitle] = useState(\&quot;\&quot;);\n  const [description, setDescription] = useState(\&quot;\&quot;);\n  const [isActive, setIsActive] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setEntityId(form?.entity.id ?? entities[0]?.id ?? \&quot;\&quot;);\n      setGeographyId(form?.geography.id ?? geographies[0]?.id ?? \&quot;\&quot;);\n      setVersion(String(form?.version ?? 1));\n      setTitle(form?.title ?? \&quot;\&quot;);\n      setDescription(form?.description ?? \&quot;\&quot;);\n      setIsActive(form?.isActive ?? true);\n      setError(null);\n    }\n  }, [open, form, entities, geographies]);\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          entityId,\n          geographyId,\n          version: Number(version),\n          title: title.trim() || null,\n          description: description.trim() || null,\n          isActive,\n        };\n        if (!payload.entityId || !payload.geographyId) {\n          setError(\&quot;Entity and geography are required\&quot;);\n          return;\n        }\n        if (payload.version &lt; 1 || Number.isNaN(payload.version)) {\n          setError(\&quot;Version must be a positive number\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(\&quot;/api/configuration/forms\&quot;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (form) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const titleText =\n    mode === \&quot;create\&quot; ? \&quot;Create form configuration\&quot; : \&quot;Edit form configuration\&quot;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{titleText}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Entity\n              &lt;Select\n                value={entityId}\n                onValueChange={setEntityId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select entity\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {entities.map((entity) =&gt; (\n                    &lt;SelectItem key={entity.id} value={entity.id}&gt;\n                      {entity.name} ({entity.code})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Geography\n              &lt;Select\n                value={geographyId}\n                onValueChange={setGeographyId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select geography\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {geographies.map((geo) =&gt; (\n                    &lt;SelectItem key={geo.id} value={geo.id}&gt;\n                      {geo.name} ({geo.code.toUpperCase()})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Version\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                min={1}\n                value={version}\n                onChange={(event) =&gt; setVersion(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Title\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={title}\n                onChange={(event) =&gt; setTitle(event.target.value)}\n                placeholder=\&quot;Optional display title\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Description\n              &lt;textarea\n                className=\&quot;mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm\&quot;\n                rows={3}\n                value={description}\n                onChange={(event) =&gt; setDescription(event.target.value)}\n                placeholder=\&quot;Optional description\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input\n                type=\&quot;checkbox\&quot;\n                className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n                checked={isActive}\n                onChange={(event) =&gt; setIsActive(event.target.checked)}\n              /&gt;\n              Active\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending ? \&quot;Saving...\&quot; : mode === \&quot;create\&quot; ? \&quot;Create\&quot; : \&quot;Save\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFormDialogProps {\n  form: FormDefinitionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFormDialog({\n  form,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFormDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n          method: \&quot;DELETE\&quot;,\n        });\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete form configuration?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes the {form.entity.name} • {form.geography.code.toUpperCase()}\n          {\&quot; \&quot;}v{form.version} form. Applications referencing this config will no\n          longer load new drafts.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n            className=\&quot;gap-2\&quot;\n          &gt;\n            &lt;Trash2 className=\&quot;h-4 w-4\&quot; /&gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface SectionDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction SectionDialog({\n  mode,\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: SectionDialogProps) {\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setKeyValue(section?.key ?? \&quot;\&quot;);\n      setLabel(section?.label ?? \&quot;\&quot;);\n      setOrder(String(section?.order ?? 0));\n      setError(null);\n    }\n  }, [open, section]);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          key: keyValue.trim(),\n          label: label.trim(),\n          order: Number(order),\n        };\n        if (!payload.key || !payload.label) {\n          setError(\&quot;Key and label are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}/sections&#96;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (section) {\n          await jsonRequest(\n            &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n            {\n              method: \&quot;PATCH\&quot;,\n              body: JSON.stringify(payload),\n            }\n          );\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? \&quot;Add section\&quot;\n      : &#96;Edit section (${section?.label ?? \&quot;Section\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-lg\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                placeholder=\&quot;company_profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                placeholder=\&quot;Company profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create section\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteSectionDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteSectionDialog({\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteSectionDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n          {\n            method: \&quot;DELETE\&quot;,\n          }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete section?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Removing &lt;span className=\&quot;font-medium\&quot;&gt;{section.label}&lt;/span&gt; deletes\n          {section.fields.length &gt; 0 ? \&quot; its fields as well.\&quot; : \&quot; it immediately.\&quot;}\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface FieldDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nconst FIELD_TYPES = [\n  { value: \&quot;text\&quot;, label: \&quot;Text\&quot; },\n  { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n  { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n  { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n  { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n  { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n];\n\nfunction getOptionValues(options: unknown): string[] {\n  if (\n    options &amp;&amp;\n    typeof options === \&quot;object\&quot; &amp;&amp;\n    Array.isArray((options as { values?: unknown[] }).values)\n  ) {\n    const { values } = options as { values?: unknown[] };\n    return (values ?? [])\n      .map((value) =&gt; &#96;${value}&#96;.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction FieldDialog({\n  mode,\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FieldDialogProps) {\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [type, setType] = useState(FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [required, setRequired] = useState(false);\n  const [placeholder, setPlaceholder] = useState(\&quot;\&quot;);\n  const [helpText, setHelpText] = useState(\&quot;\&quot;);\n  const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setLabel(field?.label ?? \&quot;\&quot;);\n      setKeyValue(field?.key ?? \&quot;\&quot;);\n      setType(field?.type ?? FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n      setOrder(String(field?.order ?? 0));\n      setRequired(field?.required ?? false);\n      setPlaceholder(field?.placeholder ?? \&quot;\&quot;);\n      setHelpText(field?.helpText ?? \&quot;\&quot;);\n      const existingOptions = getOptionValues(field?.options ?? null);\n      setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n      setError(null);\n    }\n  }, [open, field]);\n\n  if (!section || !form) return null;\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const options =\n          type === \&quot;select\&quot;\n            ? optionsInput\n                .split(\&quot;,\&quot;)\n                .map((value) =&gt; value.trim())\n                .filter(Boolean)\n            : null;\n        const payload = {\n          label: label.trim(),\n          key: keyValue.trim(),\n          type,\n          order: Number(order),\n          required,\n          placeholder: placeholder.trim() || null,\n          helpText: helpText.trim() || null,\n          options,\n        };\n        if (!payload.label || !payload.key) {\n          setError(\&quot;Label and key are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        const baseUrl = &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields&#96;;\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(baseUrl, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (field) {\n          await jsonRequest(&#96;${baseUrl}/${field.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? &#96;Add field to ${section.label}&#96;\n      : &#96;Edit field (${field?.label ?? \&quot;Field\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-2xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Field type\n              &lt;Select value={type} onValueChange={setType}&gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {FIELD_TYPES.map((option) =&gt; (\n                    &lt;SelectItem key={option.value} value={option.value}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Placeholder\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={placeholder}\n                onChange={(event) =&gt; setPlaceholder(event.target.value)}\n                placeholder=\&quot;Optional placeholder text\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Help text\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={helpText}\n                onChange={(event) =&gt; setHelpText(event.target.value)}\n                placeholder=\&quot;Guidance displayed under the input\&quot;\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {type === \&quot;select\&quot; &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Options (comma separated)\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={optionsInput}\n                onChange={(event) =&gt; setOptionsInput(event.target.value)}\n                placeholder=\&quot;Option A, Option B, Option C\&quot;\n              /&gt;\n            &lt;/label&gt;\n          )}\n          &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n            &lt;input\n              type=\&quot;checkbox\&quot;\n              className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n              checked={required}\n              onChange={(event) =&gt; setRequired(event.target.checked)}\n            /&gt;\n            Required field\n          &lt;/label&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create field\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFieldDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFieldDialog({\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFieldDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields/${field.id}&#96;,\n          { method: \&quot;DELETE\&quot; }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete field?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes &lt;span className=\&quot;font-medium\&quot;&gt;{field.label}&lt;/span&gt; from{\&quot; \&quot;}\n          {section.label}. Existing drafts may lose captured data in this key.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating FieldDialog component signature**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "interface FieldDialogProps" in "/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx" • 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `components/admin/form-definitions-panel.tsx` | `interface FieldDialogProps \{` | L981 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Planning targeted file reading**</details></think>

---

<tool-use data-tool-type="grep" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "FIELD_TYPES" in "/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx" • 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `components/admin/form-definitions-panel.tsx` | `const FIELD_TYPES = [` | L992 |
| `components/admin/form-definitions-panel.tsx` | `const [type, setType] = useState(FIELD_TYPES[0]?.value ?? "text");` | L1033 |
| `components/admin/form-definitions-panel.tsx` | `setType(field?.type ?? FIELD_TYPES[0]?.value ?? "text");` | L1062 |
| `components/admin/form-definitions-panel.tsx` | `\{FIELD_TYPES.map((option) => (` | L1183 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Considering file reading strategy**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Extending FieldDialog with document types**</details></think>

---

The model made no changes to the file.

---

<think><details><summary>Thought Process</summary>
**Refining patch for exact matches**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;859d799e-eb10-46a9-b8c3-c9154634a8d4&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    field: FormFieldSummary | null;\n    open: boolean;\n+   documentTypes: DocumentTypeSummary[];\n    onOpenChange: (open: boolean) =&gt; void;\n    onSuccess: () =&gt; void;&quot;,
        &quot;oldStart&quot;: 985,
        &quot;newStart&quot;: 985,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;    { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n    { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n+   { value: \&quot;email\&quot;, label: \&quot;Email\&quot; },\n+   { value: \&quot;tel\&quot;, label: \&quot;Phone\&quot; },\n    { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n+   { value: \&quot;multi-select\&quot;, label: \&quot;Multi select\&quot; },\n+   { value: \&quot;radio\&quot;, label: \&quot;Radio group\&quot; },\n+   { value: \&quot;checkbox\&quot;, label: \&quot;Checkbox\&quot; },\n    { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n    { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n+   { value: \&quot;document\&quot;, label: \&quot;Document upload\&quot; },\n  ];\n  &quot;,
        &quot;oldStart&quot;: 993,
        &quot;newStart&quot;: 994,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 13,
        &quot;linesAdded&quot;: 6
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useEffect, useState, useTransition } from \&quot;react\&quot;;\nimport Link from \&quot;next/link\&quot;;\nimport { useRouter } from \&quot;next/navigation\&quot;;\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \&quot;@/components/ui/dialog\&quot;;\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \&quot;@/components/ui/dropdown-menu\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \&quot;@/components/ui/table\&quot;;\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \&quot;@/components/ui/select\&quot;;\nimport { Input } from \&quot;@/components/ui/input\&quot;;\nimport {\n  Layers,\n  ListTree,\n  MoreHorizontal,\n  Plus,\n  Trash2,\n} from \&quot;lucide-react\&quot;;\n\nimport { jsonRequest } from \&quot;@/lib/admin-api\&quot;;\n\ninterface EntitySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface GeographySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface FormFieldSummary {\n  id: string;\n  key: string;\n  label: string;\n  type: string;\n  required: boolean;\n  order: number;\n  placeholder: string | null;\n  helpText: string | null;\n  options: unknown;\n}\n\ninterface FormSectionSummary {\n  id: string;\n  key: string;\n  label: string;\n  order: number;\n  formConfigId: string;\n  fields: FormFieldSummary[];\n}\n\ninterface FormDefinitionSummary {\n  id: string;\n  entity: EntitySummary;\n  geography: GeographySummary;\n  version: number;\n  title: string | null;\n  description: string | null;\n  isActive: boolean;\n  createdAt: string | Date;\n  updatedAt: string | Date;\n  sections: FormSectionSummary[];\n}\n\ninterface DocumentTypeSummary {\n  id: string;\n  key: string;\n  label: string;\n  category: string;\n}\n\nconst UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n  dateStyle: \&quot;medium\&quot;,\n  timeStyle: \&quot;short\&quot;,\n  timeZone: \&quot;UTC\&quot;,\n});\n\ninterface FormDefinitionsPanelProps {\n  forms: FormDefinitionSummary[];\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  documentTypes: DocumentTypeSummary[];\n}\n\ninterface SectionDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n}\n\ninterface FieldDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n}\n\nexport function FormDefinitionsPanel({\n  forms,\n  entities,\n  geographies,\n  documentTypes,\n}: FormDefinitionsPanelProps) {\n  const router = useRouter();\n  const [createOpen, setCreateOpen] = useState(false);\n  const [editingForm, setEditingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [deletingForm, setDeletingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [sectionDialog, setSectionDialog] = useState&lt;SectionDialogState | null&gt;(\n    null\n  );\n  const [sectionDelete, setSectionDelete] =\n    useState&lt;SectionDialogState | null&gt;(null);\n  const [fieldDialog, setFieldDialog] = useState&lt;FieldDialogState | null&gt;(null);\n  const [fieldDelete, setFieldDelete] = useState&lt;FieldDialogState | null&gt;(null);\n\n  const refresh = () =&gt; router.refresh();\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-4\&quot;&gt;\n        &lt;div className=\&quot;flex items-center gap-2 text-slate-500\&quot;&gt;\n          &lt;Layers className=\&quot;h-4 w-4\&quot; /&gt;\n          &lt;span&gt;\n            {forms.length}{\&quot; \&quot;}\n            {forms.length === 1 ? \&quot;form definition\&quot; : \&quot;form definitions\&quot;}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;Dialog open={createOpen} onOpenChange={setCreateOpen}&gt;\n          &lt;DialogTrigger asChild&gt;\n            &lt;Button className=\&quot;gap-2\&quot;&gt;\n              &lt;Plus className=\&quot;h-4 w-4\&quot; /&gt;\n              New form config\n            &lt;/Button&gt;\n          &lt;/DialogTrigger&gt;\n          &lt;FormConfigDialog\n            mode=\&quot;create\&quot;\n            entities={entities}\n            geographies={geographies}\n            open={createOpen}\n            onOpenChange={setCreateOpen}\n            onSuccess={() =&gt; {\n              setCreateOpen(false);\n              refresh();\n            }}\n          /&gt;\n        &lt;/Dialog&gt;\n      &lt;/div&gt;\n\n      {forms.length === 0 &amp;&amp; (\n        &lt;div className=\&quot;rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center text-slate-500\&quot;&gt;\n          &lt;p&gt;No form definitions yet. Create one to start mapping schema versions.&lt;/p&gt;\n        &lt;/div&gt;\n      )}\n\n      &lt;div className=\&quot;space-y-4\&quot;&gt;\n        {forms.map((form) =&gt; (\n          &lt;div\n            key={form.id}\n            className=\&quot;rounded-2xl border border-slate-200 bg-white p-5 shadow-sm\&quot;\n          &gt;\n            &lt;div className=\&quot;flex flex-wrap items-start justify-between gap-4\&quot;&gt;\n              &lt;div&gt;\n                &lt;div className=\&quot;flex flex-wrap items-center gap-3\&quot;&gt;\n                  &lt;h3 className=\&quot;text-lg font-semibold text-slate-900\&quot;&gt;\n                    {form.entity.name} • {form.geography.code.toUpperCase()} • v\n                    {form.version}\n                  &lt;/h3&gt;\n                  &lt;Badge variant={form.isActive ? \&quot;default\&quot; : \&quot;secondary\&quot;}&gt;\n                    {form.isActive ? \&quot;Active\&quot; : \&quot;Inactive\&quot;}\n                  &lt;/Badge&gt;\n                &lt;/div&gt;\n                {form.title &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-600\&quot;&gt;{form.title}&lt;/p&gt;\n                )}\n                {form.description &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;{form.description}&lt;/p&gt;\n                )}\n                &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n                  Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))}\n                  {\&quot; \&quot;}\n                  UTC\n                &lt;/p&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n                  &lt;Link\n                    href={&#96;/forms/${form.id}&#96;}\n                    target=\&quot;_blank\&quot;\n                    rel=\&quot;noreferrer\&quot;\n                  &gt;\n                    View form\n                  &lt;/Link&gt;\n                &lt;/Button&gt;\n                &lt;DropdownMenu&gt;\n                  &lt;DropdownMenuTrigger asChild&gt;\n                    &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n                      &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n                    &lt;/Button&gt;\n                  &lt;/DropdownMenuTrigger&gt;\n                  &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                    &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n                      Edit config\n                    &lt;/DropdownMenuItem&gt;\n                    &lt;DropdownMenuItem\n                      className=\&quot;text-red-600\&quot;\n                      onClick={() =&gt; setDeletingForm(form)}\n                    &gt;\n                      Delete config\n                    &lt;/DropdownMenuItem&gt;\n                  &lt;/DropdownMenuContent&gt;\n                &lt;/DropdownMenu&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-6 space-y-4\&quot;&gt;\n              {form.sections.length === 0 &amp;&amp; (\n                &lt;div className=\&quot;rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500\&quot;&gt;\n                  No sections configured for this form.\n                &lt;/div&gt;\n              )}\n\n              {form.sections.map((section) =&gt; (\n                &lt;div\n                  key={section.id}\n                  className=\&quot;rounded-xl border border-slate-200 bg-slate-50 p-4\&quot;\n                &gt;\n                  &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-3\&quot;&gt;\n                    &lt;div&gt;\n                      &lt;div className=\&quot;flex items-center gap-2 text-slate-700\&quot;&gt;\n                        &lt;ListTree className=\&quot;h-4 w-4 text-slate-400\&quot; /&gt;\n                        &lt;h4 className=\&quot;text-base font-semibold\&quot;&gt;\n                          {section.label}\n                        &lt;/h4&gt;\n                      &lt;/div&gt;\n                      &lt;p className=\&quot;text-xs font-mono uppercase tracking-wide text-slate-400\&quot;&gt;\n                        {section.key} • order {section.order}\n                      &lt;/p&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex flex-wrap items-center gap-2\&quot;&gt;\n                      &lt;Button\n                        variant=\&quot;outline\&quot;\n                        size=\&quot;sm\&quot;\n                        onClick={() =&gt;\n                          setFieldDialog({\n                            form,\n                            section,\n                            field: null,\n                          })\n                        }\n                      &gt;\n                        &lt;Plus className=\&quot;mr-2 h-3.5 w-3.5\&quot; /&gt;\n                        Field\n                      &lt;/Button&gt;\n                      &lt;DropdownMenu&gt;\n                        &lt;DropdownMenuTrigger asChild&gt;\n                          &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                            &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                          &lt;/Button&gt;\n                        &lt;/DropdownMenuTrigger&gt;\n                        &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                          &lt;DropdownMenuItem\n                            onClick={() =&gt;\n                              setSectionDialog({ form, section })\n                            }\n                          &gt;\n                            Edit section\n                          &lt;/DropdownMenuItem&gt;\n                          &lt;DropdownMenuItem\n                            className=\&quot;text-red-600\&quot;\n                            onClick={() =&gt;\n                              setSectionDelete({ form, section })\n                            }\n                          &gt;\n                            Delete section\n                          &lt;/DropdownMenuItem&gt;\n                        &lt;/DropdownMenuContent&gt;\n                      &lt;/DropdownMenu&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n\n                  &lt;div className=\&quot;mt-3 overflow-hidden rounded-lg border border-slate-200 bg-white\&quot;&gt;\n                    &lt;Table&gt;\n                      &lt;TableHeader className=\&quot;bg-slate-100\&quot;&gt;\n                        &lt;TableRow&gt;\n                          &lt;TableHead&gt;Label&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Key&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Type&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Required\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Order\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-16 text-right\&quot;&gt;\n                            Actions\n                          &lt;/TableHead&gt;\n                        &lt;/TableRow&gt;\n                      &lt;/TableHeader&gt;\n                      &lt;TableBody&gt;\n                        {section.fields.length === 0 &amp;&amp; (\n                          &lt;TableRow&gt;\n                            &lt;TableCell\n                              colSpan={6}\n                              className=\&quot;text-center text-sm text-slate-500\&quot;\n                            &gt;\n                              No fields yet. Add the first field.\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        )}\n                        {section.fields.map((field) =&gt; (\n                          &lt;TableRow key={field.id}&gt;\n                            &lt;TableCell className=\&quot;font-medium text-slate-900\&quot;&gt;\n                              {field.label}\n                              {field.helpText &amp;&amp; (\n                                &lt;p className=\&quot;text-xs text-slate-500\&quot;&gt;\n                                  {field.helpText}\n                                &lt;/p&gt;\n                              )}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;font-mono text-xs uppercase text-slate-500\&quot;&gt;\n                              {field.key}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell&gt;\n                              &lt;Badge variant=\&quot;secondary\&quot;&gt;{field.type}&lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              &lt;Badge\n                                variant={field.required ? \&quot;default\&quot; : \&quot;outline\&quot;}\n                              &gt;\n                                {field.required ? \&quot;Yes\&quot; : \&quot;No\&quot;}\n                              &lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              {field.order}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-right\&quot;&gt;\n                              &lt;DropdownMenu&gt;\n                                &lt;DropdownMenuTrigger asChild&gt;\n                                  &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                                    &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                                  &lt;/Button&gt;\n                                &lt;/DropdownMenuTrigger&gt;\n                                &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                                  &lt;DropdownMenuItem\n                                    onClick={() =&gt;\n                                      setFieldDialog({ form, section, field })\n                                    }\n                                  &gt;\n                                    Edit\n                                  &lt;/DropdownMenuItem&gt;\n                                  &lt;DropdownMenuItem\n                                    className=\&quot;text-red-600\&quot;\n                                    onClick={() =&gt;\n                                      setFieldDelete({ form, section, field })\n                                    }\n                                  &gt;\n                                    Delete\n                                  &lt;/DropdownMenuItem&gt;\n                                &lt;/DropdownMenuContent&gt;\n                              &lt;/DropdownMenu&gt;\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        ))}\n                      &lt;/TableBody&gt;\n                    &lt;/Table&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-4\&quot;&gt;\n              &lt;Button\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={() =&gt; setSectionDialog({ form, section: null })}\n              &gt;\n                &lt;Plus className=\&quot;mr-2 h-4 w-4\&quot; /&gt;\n                Add section\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ))}\n      &lt;/div&gt;\n\n      &lt;FormConfigDialog\n        mode=\&quot;edit\&quot;\n        form={editingForm}\n        entities={entities}\n        geographies={geographies}\n        open={Boolean(editingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setEditingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setEditingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      &lt;DeleteFormDialog\n        form={deletingForm}\n        open={Boolean(deletingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setDeletingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setDeletingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      {sectionDialog?.form &amp;&amp; (\n        &lt;SectionDialog\n          mode={sectionDialog.section ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={sectionDialog.form}\n          section={sectionDialog.section}\n          open={Boolean(sectionDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {sectionDelete?.form &amp;&amp; sectionDelete.section &amp;&amp; (\n        &lt;DeleteSectionDialog\n          form={sectionDelete.form}\n          section={sectionDelete.section}\n          open={Boolean(sectionDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDialog?.form &amp;&amp; (\n        &lt;FieldDialog\n          mode={fieldDialog.field ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={fieldDialog.form}\n          section={fieldDialog.section}\n          field={fieldDialog.field}\n          open={Boolean(fieldDialog)}\n          documentTypes={documentTypes}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDelete?.form &amp;&amp; fieldDelete.field &amp;&amp; (\n        &lt;DeleteFieldDialog\n          form={fieldDelete.form}\n          section={fieldDelete.section}\n          field={fieldDelete.field}\n          open={Boolean(fieldDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\ninterface FormConfigDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form?: FormDefinitionSummary | null;\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction FormConfigDialog({\n  mode,\n  form,\n  entities,\n  geographies,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FormConfigDialogProps) {\n  const [entityId, setEntityId] = useState(\&quot;\&quot;);\n  const [geographyId, setGeographyId] = useState(\&quot;\&quot;);\n  const [version, setVersion] = useState(\&quot;1\&quot;);\n  const [title, setTitle] = useState(\&quot;\&quot;);\n  const [description, setDescription] = useState(\&quot;\&quot;);\n  const [isActive, setIsActive] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setEntityId(form?.entity.id ?? entities[0]?.id ?? \&quot;\&quot;);\n      setGeographyId(form?.geography.id ?? geographies[0]?.id ?? \&quot;\&quot;);\n      setVersion(String(form?.version ?? 1));\n      setTitle(form?.title ?? \&quot;\&quot;);\n      setDescription(form?.description ?? \&quot;\&quot;);\n      setIsActive(form?.isActive ?? true);\n      setError(null);\n    }\n  }, [open, form, entities, geographies]);\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          entityId,\n          geographyId,\n          version: Number(version),\n          title: title.trim() || null,\n          description: description.trim() || null,\n          isActive,\n        };\n        if (!payload.entityId || !payload.geographyId) {\n          setError(\&quot;Entity and geography are required\&quot;);\n          return;\n        }\n        if (payload.version &lt; 1 || Number.isNaN(payload.version)) {\n          setError(\&quot;Version must be a positive number\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(\&quot;/api/configuration/forms\&quot;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (form) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const titleText =\n    mode === \&quot;create\&quot; ? \&quot;Create form configuration\&quot; : \&quot;Edit form configuration\&quot;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{titleText}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Entity\n              &lt;Select\n                value={entityId}\n                onValueChange={setEntityId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select entity\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {entities.map((entity) =&gt; (\n                    &lt;SelectItem key={entity.id} value={entity.id}&gt;\n                      {entity.name} ({entity.code})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Geography\n              &lt;Select\n                value={geographyId}\n                onValueChange={setGeographyId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select geography\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {geographies.map((geo) =&gt; (\n                    &lt;SelectItem key={geo.id} value={geo.id}&gt;\n                      {geo.name} ({geo.code.toUpperCase()})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Version\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                min={1}\n                value={version}\n                onChange={(event) =&gt; setVersion(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Title\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={title}\n                onChange={(event) =&gt; setTitle(event.target.value)}\n                placeholder=\&quot;Optional display title\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Description\n              &lt;textarea\n                className=\&quot;mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm\&quot;\n                rows={3}\n                value={description}\n                onChange={(event) =&gt; setDescription(event.target.value)}\n                placeholder=\&quot;Optional description\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input\n                type=\&quot;checkbox\&quot;\n                className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n                checked={isActive}\n                onChange={(event) =&gt; setIsActive(event.target.checked)}\n              /&gt;\n              Active\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending ? \&quot;Saving...\&quot; : mode === \&quot;create\&quot; ? \&quot;Create\&quot; : \&quot;Save\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFormDialogProps {\n  form: FormDefinitionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFormDialog({\n  form,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFormDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n          method: \&quot;DELETE\&quot;,\n        });\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete form configuration?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes the {form.entity.name} • {form.geography.code.toUpperCase()}\n          {\&quot; \&quot;}v{form.version} form. Applications referencing this config will no\n          longer load new drafts.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n            className=\&quot;gap-2\&quot;\n          &gt;\n            &lt;Trash2 className=\&quot;h-4 w-4\&quot; /&gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface SectionDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction SectionDialog({\n  mode,\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: SectionDialogProps) {\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setKeyValue(section?.key ?? \&quot;\&quot;);\n      setLabel(section?.label ?? \&quot;\&quot;);\n      setOrder(String(section?.order ?? 0));\n      setError(null);\n    }\n  }, [open, section]);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          key: keyValue.trim(),\n          label: label.trim(),\n          order: Number(order),\n        };\n        if (!payload.key || !payload.label) {\n          setError(\&quot;Key and label are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}/sections&#96;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (section) {\n          await jsonRequest(\n            &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n            {\n              method: \&quot;PATCH\&quot;,\n              body: JSON.stringify(payload),\n            }\n          );\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? \&quot;Add section\&quot;\n      : &#96;Edit section (${section?.label ?? \&quot;Section\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-lg\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                placeholder=\&quot;company_profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                placeholder=\&quot;Company profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create section\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteSectionDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteSectionDialog({\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteSectionDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n          {\n            method: \&quot;DELETE\&quot;,\n          }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete section?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Removing &lt;span className=\&quot;font-medium\&quot;&gt;{section.label}&lt;/span&gt; deletes\n          {section.fields.length &gt; 0 ? \&quot; its fields as well.\&quot; : \&quot; it immediately.\&quot;}\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface FieldDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n  open: boolean;\n  documentTypes: DocumentTypeSummary[];\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nconst FIELD_TYPES = [\n  { value: \&quot;text\&quot;, label: \&quot;Text\&quot; },\n  { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n  { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n  { value: \&quot;email\&quot;, label: \&quot;Email\&quot; },\n  { value: \&quot;tel\&quot;, label: \&quot;Phone\&quot; },\n  { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n  { value: \&quot;multi-select\&quot;, label: \&quot;Multi select\&quot; },\n  { value: \&quot;radio\&quot;, label: \&quot;Radio group\&quot; },\n  { value: \&quot;checkbox\&quot;, label: \&quot;Checkbox\&quot; },\n  { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n  { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n  { value: \&quot;document\&quot;, label: \&quot;Document upload\&quot; },\n];\n\nfunction getOptionValues(options: unknown): string[] {\n  if (\n    options &amp;&amp;\n    typeof options === \&quot;object\&quot; &amp;&amp;\n    Array.isArray((options as { values?: unknown[] }).values)\n  ) {\n    const { values } = options as { values?: unknown[] };\n    return (values ?? [])\n      .map((value) =&gt; &#96;${value}&#96;.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction FieldDialog({\n  mode,\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FieldDialogProps) {\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [type, setType] = useState(FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [required, setRequired] = useState(false);\n  const [placeholder, setPlaceholder] = useState(\&quot;\&quot;);\n  const [helpText, setHelpText] = useState(\&quot;\&quot;);\n  const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setLabel(field?.label ?? \&quot;\&quot;);\n      setKeyValue(field?.key ?? \&quot;\&quot;);\n      setType(field?.type ?? FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n      setOrder(String(field?.order ?? 0));\n      setRequired(field?.required ?? false);\n      setPlaceholder(field?.placeholder ?? \&quot;\&quot;);\n      setHelpText(field?.helpText ?? \&quot;\&quot;);\n      const existingOptions = getOptionValues(field?.options ?? null);\n      setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n      setError(null);\n    }\n  }, [open, field]);\n\n  if (!section || !form) return null;\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const options =\n          type === \&quot;select\&quot;\n            ? optionsInput\n                .split(\&quot;,\&quot;)\n                .map((value) =&gt; value.trim())\n                .filter(Boolean)\n            : null;\n        const payload = {\n          label: label.trim(),\n          key: keyValue.trim(),\n          type,\n          order: Number(order),\n          required,\n          placeholder: placeholder.trim() || null,\n          helpText: helpText.trim() || null,\n          options,\n        };\n        if (!payload.label || !payload.key) {\n          setError(\&quot;Label and key are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        const baseUrl = &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields&#96;;\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(baseUrl, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (field) {\n          await jsonRequest(&#96;${baseUrl}/${field.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? &#96;Add field to ${section.label}&#96;\n      : &#96;Edit field (${field?.label ?? \&quot;Field\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-2xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Field type\n              &lt;Select value={type} onValueChange={setType}&gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {FIELD_TYPES.map((option) =&gt; (\n                    &lt;SelectItem key={option.value} value={option.value}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Placeholder\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={placeholder}\n                onChange={(event) =&gt; setPlaceholder(event.target.value)}\n                placeholder=\&quot;Optional placeholder text\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Help text\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={helpText}\n                onChange={(event) =&gt; setHelpText(event.target.value)}\n                placeholder=\&quot;Guidance displayed under the input\&quot;\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {type === \&quot;select\&quot; &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Options (comma separated)\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={optionsInput}\n                onChange={(event) =&gt; setOptionsInput(event.target.value)}\n                placeholder=\&quot;Option A, Option B, Option C\&quot;\n              /&gt;\n            &lt;/label&gt;\n          )}\n          &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n            &lt;input\n              type=\&quot;checkbox\&quot;\n              className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n              checked={required}\n              onChange={(event) =&gt; setRequired(event.target.checked)}\n            /&gt;\n            Required field\n          &lt;/label&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create field\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFieldDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFieldDialog({\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFieldDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields/${field.id}&#96;,\n          { method: \&quot;DELETE\&quot; }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete field?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes &lt;span className=\&quot;font-medium\&quot;&gt;{field.label}&lt;/span&gt; from{\&quot; \&quot;}\n          {section.label}. Existing drafts may lose captured data in this key.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating FieldDialog component**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;46da01b3-8715-41c2-b677-d21b06238736&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    field,\n    open,\n+   documentTypes,\n    onOpenChange,\n    onSuccess,&quot;,
        &quot;oldStart&quot;: 1025,
        &quot;newStart&quot;: 1025,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;    const [helpText, setHelpText] = useState(\&quot;\&quot;);\n    const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n+   const [documentTypeKey, setDocumentTypeKey] = useState(\&quot;\&quot;);\n    const [error, setError] = useState&lt;string | null&gt;(null);\n    const [isPending, startTransition] = useTransition();\n+ \n+   const documentOptions = documentTypes.map((doc) =&gt; ({\n+     key: doc.key,\n+     label: &#96;${doc.label} (${doc.category})&#96;,\n+   }));\n+ \n+   const getDocumentTypeFromOptions = (options: unknown) =&gt; {\n+     if (options &amp;&amp; typeof options === \&quot;object\&quot;) {\n+       const maybeKey = (options as { documentTypeKey?: unknown }).documentTypeKey;\n+       if (typeof maybeKey === \&quot;string\&quot;) {\n+         return maybeKey;\n+       }\n+     }\n+     return \&quot;\&quot;;\n+   };\n  \n    useEffect(() =&gt; {&quot;,
        &quot;oldStart&quot;: 1036,
        &quot;newStart&quot;: 1037,
        &quot;oldLines&quot;: 6,
        &quot;newLines&quot;: 22,
        &quot;linesAdded&quot;: 16
      },
      {
        &quot;diffString&quot;: &quot;        const existingOptions = getOptionValues(field?.options ?? null);\n        setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n+       setDocumentTypeKey(\n+         getDocumentTypeFromOptions(field?.options ?? null) ||\n+           documentOptions[0]?.key ||\n+           \&quot;\&quot;\n+       );\n        setError(null);\n      }\n-   }, [open, field]);\n+   }, [open, field, documentOptions]);\n+ \n+   useEffect(() =&gt; {\n+     if (type === \&quot;document\&quot; &amp;&amp; !documentTypeKey) {\n+       setDocumentTypeKey(documentOptions[0]?.key ?? \&quot;\&quot;);\n+     }\n+     if (type !== \&quot;select\&quot; &amp;&amp; type !== \&quot;multi-select\&quot; &amp;&amp; type !== \&quot;radio\&quot;) {\n+       setOptionsInput(\&quot;\&quot;);\n+     }\n+   }, [type, documentOptions, documentTypeKey]);\n  \n    if (!section || !form) return null;&quot;,
        &quot;oldStart&quot;: 1050,
        &quot;newStart&quot;: 1067,
        &quot;oldLines&quot;: 7,
        &quot;newLines&quot;: 21,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 15
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useEffect, useState, useTransition } from \&quot;react\&quot;;\nimport Link from \&quot;next/link\&quot;;\nimport { useRouter } from \&quot;next/navigation\&quot;;\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \&quot;@/components/ui/dialog\&quot;;\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \&quot;@/components/ui/dropdown-menu\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \&quot;@/components/ui/table\&quot;;\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \&quot;@/components/ui/select\&quot;;\nimport { Input } from \&quot;@/components/ui/input\&quot;;\nimport {\n  Layers,\n  ListTree,\n  MoreHorizontal,\n  Plus,\n  Trash2,\n} from \&quot;lucide-react\&quot;;\n\nimport { jsonRequest } from \&quot;@/lib/admin-api\&quot;;\n\ninterface EntitySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface GeographySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface FormFieldSummary {\n  id: string;\n  key: string;\n  label: string;\n  type: string;\n  required: boolean;\n  order: number;\n  placeholder: string | null;\n  helpText: string | null;\n  options: unknown;\n}\n\ninterface FormSectionSummary {\n  id: string;\n  key: string;\n  label: string;\n  order: number;\n  formConfigId: string;\n  fields: FormFieldSummary[];\n}\n\ninterface FormDefinitionSummary {\n  id: string;\n  entity: EntitySummary;\n  geography: GeographySummary;\n  version: number;\n  title: string | null;\n  description: string | null;\n  isActive: boolean;\n  createdAt: string | Date;\n  updatedAt: string | Date;\n  sections: FormSectionSummary[];\n}\n\ninterface DocumentTypeSummary {\n  id: string;\n  key: string;\n  label: string;\n  category: string;\n}\n\nconst UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n  dateStyle: \&quot;medium\&quot;,\n  timeStyle: \&quot;short\&quot;,\n  timeZone: \&quot;UTC\&quot;,\n});\n\ninterface FormDefinitionsPanelProps {\n  forms: FormDefinitionSummary[];\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  documentTypes: DocumentTypeSummary[];\n}\n\ninterface SectionDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n}\n\ninterface FieldDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n}\n\nexport function FormDefinitionsPanel({\n  forms,\n  entities,\n  geographies,\n  documentTypes,\n}: FormDefinitionsPanelProps) {\n  const router = useRouter();\n  const [createOpen, setCreateOpen] = useState(false);\n  const [editingForm, setEditingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [deletingForm, setDeletingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [sectionDialog, setSectionDialog] = useState&lt;SectionDialogState | null&gt;(\n    null\n  );\n  const [sectionDelete, setSectionDelete] =\n    useState&lt;SectionDialogState | null&gt;(null);\n  const [fieldDialog, setFieldDialog] = useState&lt;FieldDialogState | null&gt;(null);\n  const [fieldDelete, setFieldDelete] = useState&lt;FieldDialogState | null&gt;(null);\n\n  const refresh = () =&gt; router.refresh();\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-4\&quot;&gt;\n        &lt;div className=\&quot;flex items-center gap-2 text-slate-500\&quot;&gt;\n          &lt;Layers className=\&quot;h-4 w-4\&quot; /&gt;\n          &lt;span&gt;\n            {forms.length}{\&quot; \&quot;}\n            {forms.length === 1 ? \&quot;form definition\&quot; : \&quot;form definitions\&quot;}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;Dialog open={createOpen} onOpenChange={setCreateOpen}&gt;\n          &lt;DialogTrigger asChild&gt;\n            &lt;Button className=\&quot;gap-2\&quot;&gt;\n              &lt;Plus className=\&quot;h-4 w-4\&quot; /&gt;\n              New form config\n            &lt;/Button&gt;\n          &lt;/DialogTrigger&gt;\n          &lt;FormConfigDialog\n            mode=\&quot;create\&quot;\n            entities={entities}\n            geographies={geographies}\n            open={createOpen}\n            onOpenChange={setCreateOpen}\n            onSuccess={() =&gt; {\n              setCreateOpen(false);\n              refresh();\n            }}\n          /&gt;\n        &lt;/Dialog&gt;\n      &lt;/div&gt;\n\n      {forms.length === 0 &amp;&amp; (\n        &lt;div className=\&quot;rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center text-slate-500\&quot;&gt;\n          &lt;p&gt;No form definitions yet. Create one to start mapping schema versions.&lt;/p&gt;\n        &lt;/div&gt;\n      )}\n\n      &lt;div className=\&quot;space-y-4\&quot;&gt;\n        {forms.map((form) =&gt; (\n          &lt;div\n            key={form.id}\n            className=\&quot;rounded-2xl border border-slate-200 bg-white p-5 shadow-sm\&quot;\n          &gt;\n            &lt;div className=\&quot;flex flex-wrap items-start justify-between gap-4\&quot;&gt;\n              &lt;div&gt;\n                &lt;div className=\&quot;flex flex-wrap items-center gap-3\&quot;&gt;\n                  &lt;h3 className=\&quot;text-lg font-semibold text-slate-900\&quot;&gt;\n                    {form.entity.name} • {form.geography.code.toUpperCase()} • v\n                    {form.version}\n                  &lt;/h3&gt;\n                  &lt;Badge variant={form.isActive ? \&quot;default\&quot; : \&quot;secondary\&quot;}&gt;\n                    {form.isActive ? \&quot;Active\&quot; : \&quot;Inactive\&quot;}\n                  &lt;/Badge&gt;\n                &lt;/div&gt;\n                {form.title &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-600\&quot;&gt;{form.title}&lt;/p&gt;\n                )}\n                {form.description &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;{form.description}&lt;/p&gt;\n                )}\n                &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n                  Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))}\n                  {\&quot; \&quot;}\n                  UTC\n                &lt;/p&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n                  &lt;Link\n                    href={&#96;/forms/${form.id}&#96;}\n                    target=\&quot;_blank\&quot;\n                    rel=\&quot;noreferrer\&quot;\n                  &gt;\n                    View form\n                  &lt;/Link&gt;\n                &lt;/Button&gt;\n                &lt;DropdownMenu&gt;\n                  &lt;DropdownMenuTrigger asChild&gt;\n                    &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n                      &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n                    &lt;/Button&gt;\n                  &lt;/DropdownMenuTrigger&gt;\n                  &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                    &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n                      Edit config\n                    &lt;/DropdownMenuItem&gt;\n                    &lt;DropdownMenuItem\n                      className=\&quot;text-red-600\&quot;\n                      onClick={() =&gt; setDeletingForm(form)}\n                    &gt;\n                      Delete config\n                    &lt;/DropdownMenuItem&gt;\n                  &lt;/DropdownMenuContent&gt;\n                &lt;/DropdownMenu&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-6 space-y-4\&quot;&gt;\n              {form.sections.length === 0 &amp;&amp; (\n                &lt;div className=\&quot;rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500\&quot;&gt;\n                  No sections configured for this form.\n                &lt;/div&gt;\n              )}\n\n              {form.sections.map((section) =&gt; (\n                &lt;div\n                  key={section.id}\n                  className=\&quot;rounded-xl border border-slate-200 bg-slate-50 p-4\&quot;\n                &gt;\n                  &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-3\&quot;&gt;\n                    &lt;div&gt;\n                      &lt;div className=\&quot;flex items-center gap-2 text-slate-700\&quot;&gt;\n                        &lt;ListTree className=\&quot;h-4 w-4 text-slate-400\&quot; /&gt;\n                        &lt;h4 className=\&quot;text-base font-semibold\&quot;&gt;\n                          {section.label}\n                        &lt;/h4&gt;\n                      &lt;/div&gt;\n                      &lt;p className=\&quot;text-xs font-mono uppercase tracking-wide text-slate-400\&quot;&gt;\n                        {section.key} • order {section.order}\n                      &lt;/p&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex flex-wrap items-center gap-2\&quot;&gt;\n                      &lt;Button\n                        variant=\&quot;outline\&quot;\n                        size=\&quot;sm\&quot;\n                        onClick={() =&gt;\n                          setFieldDialog({\n                            form,\n                            section,\n                            field: null,\n                          })\n                        }\n                      &gt;\n                        &lt;Plus className=\&quot;mr-2 h-3.5 w-3.5\&quot; /&gt;\n                        Field\n                      &lt;/Button&gt;\n                      &lt;DropdownMenu&gt;\n                        &lt;DropdownMenuTrigger asChild&gt;\n                          &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                            &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                          &lt;/Button&gt;\n                        &lt;/DropdownMenuTrigger&gt;\n                        &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                          &lt;DropdownMenuItem\n                            onClick={() =&gt;\n                              setSectionDialog({ form, section })\n                            }\n                          &gt;\n                            Edit section\n                          &lt;/DropdownMenuItem&gt;\n                          &lt;DropdownMenuItem\n                            className=\&quot;text-red-600\&quot;\n                            onClick={() =&gt;\n                              setSectionDelete({ form, section })\n                            }\n                          &gt;\n                            Delete section\n                          &lt;/DropdownMenuItem&gt;\n                        &lt;/DropdownMenuContent&gt;\n                      &lt;/DropdownMenu&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n\n                  &lt;div className=\&quot;mt-3 overflow-hidden rounded-lg border border-slate-200 bg-white\&quot;&gt;\n                    &lt;Table&gt;\n                      &lt;TableHeader className=\&quot;bg-slate-100\&quot;&gt;\n                        &lt;TableRow&gt;\n                          &lt;TableHead&gt;Label&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Key&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Type&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Required\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Order\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-16 text-right\&quot;&gt;\n                            Actions\n                          &lt;/TableHead&gt;\n                        &lt;/TableRow&gt;\n                      &lt;/TableHeader&gt;\n                      &lt;TableBody&gt;\n                        {section.fields.length === 0 &amp;&amp; (\n                          &lt;TableRow&gt;\n                            &lt;TableCell\n                              colSpan={6}\n                              className=\&quot;text-center text-sm text-slate-500\&quot;\n                            &gt;\n                              No fields yet. Add the first field.\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        )}\n                        {section.fields.map((field) =&gt; (\n                          &lt;TableRow key={field.id}&gt;\n                            &lt;TableCell className=\&quot;font-medium text-slate-900\&quot;&gt;\n                              {field.label}\n                              {field.helpText &amp;&amp; (\n                                &lt;p className=\&quot;text-xs text-slate-500\&quot;&gt;\n                                  {field.helpText}\n                                &lt;/p&gt;\n                              )}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;font-mono text-xs uppercase text-slate-500\&quot;&gt;\n                              {field.key}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell&gt;\n                              &lt;Badge variant=\&quot;secondary\&quot;&gt;{field.type}&lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              &lt;Badge\n                                variant={field.required ? \&quot;default\&quot; : \&quot;outline\&quot;}\n                              &gt;\n                                {field.required ? \&quot;Yes\&quot; : \&quot;No\&quot;}\n                              &lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              {field.order}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-right\&quot;&gt;\n                              &lt;DropdownMenu&gt;\n                                &lt;DropdownMenuTrigger asChild&gt;\n                                  &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                                    &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                                  &lt;/Button&gt;\n                                &lt;/DropdownMenuTrigger&gt;\n                                &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                                  &lt;DropdownMenuItem\n                                    onClick={() =&gt;\n                                      setFieldDialog({ form, section, field })\n                                    }\n                                  &gt;\n                                    Edit\n                                  &lt;/DropdownMenuItem&gt;\n                                  &lt;DropdownMenuItem\n                                    className=\&quot;text-red-600\&quot;\n                                    onClick={() =&gt;\n                                      setFieldDelete({ form, section, field })\n                                    }\n                                  &gt;\n                                    Delete\n                                  &lt;/DropdownMenuItem&gt;\n                                &lt;/DropdownMenuContent&gt;\n                              &lt;/DropdownMenu&gt;\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        ))}\n                      &lt;/TableBody&gt;\n                    &lt;/Table&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-4\&quot;&gt;\n              &lt;Button\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={() =&gt; setSectionDialog({ form, section: null })}\n              &gt;\n                &lt;Plus className=\&quot;mr-2 h-4 w-4\&quot; /&gt;\n                Add section\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ))}\n      &lt;/div&gt;\n\n      &lt;FormConfigDialog\n        mode=\&quot;edit\&quot;\n        form={editingForm}\n        entities={entities}\n        geographies={geographies}\n        open={Boolean(editingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setEditingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setEditingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      &lt;DeleteFormDialog\n        form={deletingForm}\n        open={Boolean(deletingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setDeletingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setDeletingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      {sectionDialog?.form &amp;&amp; (\n        &lt;SectionDialog\n          mode={sectionDialog.section ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={sectionDialog.form}\n          section={sectionDialog.section}\n          open={Boolean(sectionDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {sectionDelete?.form &amp;&amp; sectionDelete.section &amp;&amp; (\n        &lt;DeleteSectionDialog\n          form={sectionDelete.form}\n          section={sectionDelete.section}\n          open={Boolean(sectionDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDialog?.form &amp;&amp; (\n        &lt;FieldDialog\n          mode={fieldDialog.field ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={fieldDialog.form}\n          section={fieldDialog.section}\n          field={fieldDialog.field}\n          open={Boolean(fieldDialog)}\n          documentTypes={documentTypes}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDelete?.form &amp;&amp; fieldDelete.field &amp;&amp; (\n        &lt;DeleteFieldDialog\n          form={fieldDelete.form}\n          section={fieldDelete.section}\n          field={fieldDelete.field}\n          open={Boolean(fieldDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\ninterface FormConfigDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form?: FormDefinitionSummary | null;\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction FormConfigDialog({\n  mode,\n  form,\n  entities,\n  geographies,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FormConfigDialogProps) {\n  const [entityId, setEntityId] = useState(\&quot;\&quot;);\n  const [geographyId, setGeographyId] = useState(\&quot;\&quot;);\n  const [version, setVersion] = useState(\&quot;1\&quot;);\n  const [title, setTitle] = useState(\&quot;\&quot;);\n  const [description, setDescription] = useState(\&quot;\&quot;);\n  const [isActive, setIsActive] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setEntityId(form?.entity.id ?? entities[0]?.id ?? \&quot;\&quot;);\n      setGeographyId(form?.geography.id ?? geographies[0]?.id ?? \&quot;\&quot;);\n      setVersion(String(form?.version ?? 1));\n      setTitle(form?.title ?? \&quot;\&quot;);\n      setDescription(form?.description ?? \&quot;\&quot;);\n      setIsActive(form?.isActive ?? true);\n      setError(null);\n    }\n  }, [open, form, entities, geographies]);\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          entityId,\n          geographyId,\n          version: Number(version),\n          title: title.trim() || null,\n          description: description.trim() || null,\n          isActive,\n        };\n        if (!payload.entityId || !payload.geographyId) {\n          setError(\&quot;Entity and geography are required\&quot;);\n          return;\n        }\n        if (payload.version &lt; 1 || Number.isNaN(payload.version)) {\n          setError(\&quot;Version must be a positive number\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(\&quot;/api/configuration/forms\&quot;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (form) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const titleText =\n    mode === \&quot;create\&quot; ? \&quot;Create form configuration\&quot; : \&quot;Edit form configuration\&quot;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{titleText}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Entity\n              &lt;Select\n                value={entityId}\n                onValueChange={setEntityId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select entity\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {entities.map((entity) =&gt; (\n                    &lt;SelectItem key={entity.id} value={entity.id}&gt;\n                      {entity.name} ({entity.code})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Geography\n              &lt;Select\n                value={geographyId}\n                onValueChange={setGeographyId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select geography\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {geographies.map((geo) =&gt; (\n                    &lt;SelectItem key={geo.id} value={geo.id}&gt;\n                      {geo.name} ({geo.code.toUpperCase()})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Version\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                min={1}\n                value={version}\n                onChange={(event) =&gt; setVersion(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Title\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={title}\n                onChange={(event) =&gt; setTitle(event.target.value)}\n                placeholder=\&quot;Optional display title\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Description\n              &lt;textarea\n                className=\&quot;mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm\&quot;\n                rows={3}\n                value={description}\n                onChange={(event) =&gt; setDescription(event.target.value)}\n                placeholder=\&quot;Optional description\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input\n                type=\&quot;checkbox\&quot;\n                className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n                checked={isActive}\n                onChange={(event) =&gt; setIsActive(event.target.checked)}\n              /&gt;\n              Active\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending ? \&quot;Saving...\&quot; : mode === \&quot;create\&quot; ? \&quot;Create\&quot; : \&quot;Save\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFormDialogProps {\n  form: FormDefinitionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFormDialog({\n  form,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFormDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n          method: \&quot;DELETE\&quot;,\n        });\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete form configuration?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes the {form.entity.name} • {form.geography.code.toUpperCase()}\n          {\&quot; \&quot;}v{form.version} form. Applications referencing this config will no\n          longer load new drafts.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n            className=\&quot;gap-2\&quot;\n          &gt;\n            &lt;Trash2 className=\&quot;h-4 w-4\&quot; /&gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface SectionDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction SectionDialog({\n  mode,\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: SectionDialogProps) {\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setKeyValue(section?.key ?? \&quot;\&quot;);\n      setLabel(section?.label ?? \&quot;\&quot;);\n      setOrder(String(section?.order ?? 0));\n      setError(null);\n    }\n  }, [open, section]);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          key: keyValue.trim(),\n          label: label.trim(),\n          order: Number(order),\n        };\n        if (!payload.key || !payload.label) {\n          setError(\&quot;Key and label are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}/sections&#96;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (section) {\n          await jsonRequest(\n            &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n            {\n              method: \&quot;PATCH\&quot;,\n              body: JSON.stringify(payload),\n            }\n          );\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? \&quot;Add section\&quot;\n      : &#96;Edit section (${section?.label ?? \&quot;Section\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-lg\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                placeholder=\&quot;company_profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                placeholder=\&quot;Company profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create section\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteSectionDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteSectionDialog({\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteSectionDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n          {\n            method: \&quot;DELETE\&quot;,\n          }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete section?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Removing &lt;span className=\&quot;font-medium\&quot;&gt;{section.label}&lt;/span&gt; deletes\n          {section.fields.length &gt; 0 ? \&quot; its fields as well.\&quot; : \&quot; it immediately.\&quot;}\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface FieldDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n  open: boolean;\n  documentTypes: DocumentTypeSummary[];\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nconst FIELD_TYPES = [\n  { value: \&quot;text\&quot;, label: \&quot;Text\&quot; },\n  { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n  { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n  { value: \&quot;email\&quot;, label: \&quot;Email\&quot; },\n  { value: \&quot;tel\&quot;, label: \&quot;Phone\&quot; },\n  { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n  { value: \&quot;multi-select\&quot;, label: \&quot;Multi select\&quot; },\n  { value: \&quot;radio\&quot;, label: \&quot;Radio group\&quot; },\n  { value: \&quot;checkbox\&quot;, label: \&quot;Checkbox\&quot; },\n  { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n  { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n  { value: \&quot;document\&quot;, label: \&quot;Document upload\&quot; },\n];\n\nfunction getOptionValues(options: unknown): string[] {\n  if (\n    options &amp;&amp;\n    typeof options === \&quot;object\&quot; &amp;&amp;\n    Array.isArray((options as { values?: unknown[] }).values)\n  ) {\n    const { values } = options as { values?: unknown[] };\n    return (values ?? [])\n      .map((value) =&gt; &#96;${value}&#96;.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction FieldDialog({\n  mode,\n  form,\n  section,\n  field,\n  open,\n  documentTypes,\n  onOpenChange,\n  onSuccess,\n}: FieldDialogProps) {\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [type, setType] = useState(FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [required, setRequired] = useState(false);\n  const [placeholder, setPlaceholder] = useState(\&quot;\&quot;);\n  const [helpText, setHelpText] = useState(\&quot;\&quot;);\n  const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n  const [documentTypeKey, setDocumentTypeKey] = useState(\&quot;\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  const documentOptions = documentTypes.map((doc) =&gt; ({\n    key: doc.key,\n    label: &#96;${doc.label} (${doc.category})&#96;,\n  }));\n\n  const getDocumentTypeFromOptions = (options: unknown) =&gt; {\n    if (options &amp;&amp; typeof options === \&quot;object\&quot;) {\n      const maybeKey = (options as { documentTypeKey?: unknown }).documentTypeKey;\n      if (typeof maybeKey === \&quot;string\&quot;) {\n        return maybeKey;\n      }\n    }\n    return \&quot;\&quot;;\n  };\n\n  useEffect(() =&gt; {\n    if (open) {\n      setLabel(field?.label ?? \&quot;\&quot;);\n      setKeyValue(field?.key ?? \&quot;\&quot;);\n      setType(field?.type ?? FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n      setOrder(String(field?.order ?? 0));\n      setRequired(field?.required ?? false);\n      setPlaceholder(field?.placeholder ?? \&quot;\&quot;);\n      setHelpText(field?.helpText ?? \&quot;\&quot;);\n      const existingOptions = getOptionValues(field?.options ?? null);\n      setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n      setDocumentTypeKey(\n        getDocumentTypeFromOptions(field?.options ?? null) ||\n          documentOptions[0]?.key ||\n          \&quot;\&quot;\n      );\n      setError(null);\n    }\n  }, [open, field, documentOptions]);\n\n  useEffect(() =&gt; {\n    if (type === \&quot;document\&quot; &amp;&amp; !documentTypeKey) {\n      setDocumentTypeKey(documentOptions[0]?.key ?? \&quot;\&quot;);\n    }\n    if (type !== \&quot;select\&quot; &amp;&amp; type !== \&quot;multi-select\&quot; &amp;&amp; type !== \&quot;radio\&quot;) {\n      setOptionsInput(\&quot;\&quot;);\n    }\n  }, [type, documentOptions, documentTypeKey]);\n\n  if (!section || !form) return null;\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const options =\n          type === \&quot;select\&quot;\n            ? optionsInput\n                .split(\&quot;,\&quot;)\n                .map((value) =&gt; value.trim())\n                .filter(Boolean)\n            : null;\n        const payload = {\n          label: label.trim(),\n          key: keyValue.trim(),\n          type,\n          order: Number(order),\n          required,\n          placeholder: placeholder.trim() || null,\n          helpText: helpText.trim() || null,\n          options,\n        };\n        if (!payload.label || !payload.key) {\n          setError(\&quot;Label and key are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        const baseUrl = &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields&#96;;\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(baseUrl, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (field) {\n          await jsonRequest(&#96;${baseUrl}/${field.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? &#96;Add field to ${section.label}&#96;\n      : &#96;Edit field (${field?.label ?? \&quot;Field\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-2xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Field type\n              &lt;Select value={type} onValueChange={setType}&gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {FIELD_TYPES.map((option) =&gt; (\n                    &lt;SelectItem key={option.value} value={option.value}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Placeholder\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={placeholder}\n                onChange={(event) =&gt; setPlaceholder(event.target.value)}\n                placeholder=\&quot;Optional placeholder text\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Help text\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={helpText}\n                onChange={(event) =&gt; setHelpText(event.target.value)}\n                placeholder=\&quot;Guidance displayed under the input\&quot;\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {type === \&quot;select\&quot; &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Options (comma separated)\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={optionsInput}\n                onChange={(event) =&gt; setOptionsInput(event.target.value)}\n                placeholder=\&quot;Option A, Option B, Option C\&quot;\n              /&gt;\n            &lt;/label&gt;\n          )}\n          &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n            &lt;input\n              type=\&quot;checkbox\&quot;\n              className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n              checked={required}\n              onChange={(event) =&gt; setRequired(event.target.checked)}\n            /&gt;\n            Required field\n          &lt;/label&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create field\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFieldDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFieldDialog({\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFieldDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields/${field.id}&#96;,\n          { method: \&quot;DELETE\&quot; }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete field?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes &lt;span className=\&quot;font-medium\&quot;&gt;{field.label}&lt;/span&gt; from{\&quot; \&quot;}\n          {section.label}. Existing drafts may lose captured data in this key.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Adjusting options calculation and submit logic**</details></think>

---

The model made no changes to the file.

---

<think><details><summary>Thought Process</summary>
**Verifying code snippet**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating options block**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;a77598ff-feef-4a1e-95c0-0f517e266a94&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;        try {\n          setError(null);\n-         const options =\n-           type === \&quot;select\&quot;\n-             ? optionsInput\n-                 .split(\&quot;,\&quot;)\n-                 .map((value) =&gt; value.trim())\n-                 .filter(Boolean)\n-             : null;\n+         let options: Record&lt;string, unknown&gt; | null = null;\n+         if ([\&quot;select\&quot;, \&quot;multi-select\&quot;, \&quot;radio\&quot;].includes(type)) {\n+           const values = optionsInput\n+             .split(\&quot;,\&quot;)\n+             .map((value) =&gt; value.trim())\n+             .filter(Boolean);\n+           options = { values };\n+         } else if (type === \&quot;document\&quot;) {\n+           if (!documentTypeKey) {\n+             setError(\&quot;Select a document type\&quot;);\n+             return;\n+           }\n+           options = { documentTypeKey };\n+         }\n          const payload = {\n            label: label.trim(),&quot;,
        &quot;oldStart&quot;: 1092,
        &quot;newStart&quot;: 1092,
        &quot;oldLines&quot;: 11,
        &quot;newLines&quot;: 18,
        &quot;linesRemoved&quot;: 7,
        &quot;linesAdded&quot;: 14
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useEffect, useState, useTransition } from \&quot;react\&quot;;\nimport Link from \&quot;next/link\&quot;;\nimport { useRouter } from \&quot;next/navigation\&quot;;\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \&quot;@/components/ui/dialog\&quot;;\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \&quot;@/components/ui/dropdown-menu\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \&quot;@/components/ui/table\&quot;;\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \&quot;@/components/ui/select\&quot;;\nimport { Input } from \&quot;@/components/ui/input\&quot;;\nimport {\n  Layers,\n  ListTree,\n  MoreHorizontal,\n  Plus,\n  Trash2,\n} from \&quot;lucide-react\&quot;;\n\nimport { jsonRequest } from \&quot;@/lib/admin-api\&quot;;\n\ninterface EntitySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface GeographySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface FormFieldSummary {\n  id: string;\n  key: string;\n  label: string;\n  type: string;\n  required: boolean;\n  order: number;\n  placeholder: string | null;\n  helpText: string | null;\n  options: unknown;\n}\n\ninterface FormSectionSummary {\n  id: string;\n  key: string;\n  label: string;\n  order: number;\n  formConfigId: string;\n  fields: FormFieldSummary[];\n}\n\ninterface FormDefinitionSummary {\n  id: string;\n  entity: EntitySummary;\n  geography: GeographySummary;\n  version: number;\n  title: string | null;\n  description: string | null;\n  isActive: boolean;\n  createdAt: string | Date;\n  updatedAt: string | Date;\n  sections: FormSectionSummary[];\n}\n\ninterface DocumentTypeSummary {\n  id: string;\n  key: string;\n  label: string;\n  category: string;\n}\n\nconst UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n  dateStyle: \&quot;medium\&quot;,\n  timeStyle: \&quot;short\&quot;,\n  timeZone: \&quot;UTC\&quot;,\n});\n\ninterface FormDefinitionsPanelProps {\n  forms: FormDefinitionSummary[];\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  documentTypes: DocumentTypeSummary[];\n}\n\ninterface SectionDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n}\n\ninterface FieldDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n}\n\nexport function FormDefinitionsPanel({\n  forms,\n  entities,\n  geographies,\n  documentTypes,\n}: FormDefinitionsPanelProps) {\n  const router = useRouter();\n  const [createOpen, setCreateOpen] = useState(false);\n  const [editingForm, setEditingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [deletingForm, setDeletingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [sectionDialog, setSectionDialog] = useState&lt;SectionDialogState | null&gt;(\n    null\n  );\n  const [sectionDelete, setSectionDelete] =\n    useState&lt;SectionDialogState | null&gt;(null);\n  const [fieldDialog, setFieldDialog] = useState&lt;FieldDialogState | null&gt;(null);\n  const [fieldDelete, setFieldDelete] = useState&lt;FieldDialogState | null&gt;(null);\n\n  const refresh = () =&gt; router.refresh();\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-4\&quot;&gt;\n        &lt;div className=\&quot;flex items-center gap-2 text-slate-500\&quot;&gt;\n          &lt;Layers className=\&quot;h-4 w-4\&quot; /&gt;\n          &lt;span&gt;\n            {forms.length}{\&quot; \&quot;}\n            {forms.length === 1 ? \&quot;form definition\&quot; : \&quot;form definitions\&quot;}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;Dialog open={createOpen} onOpenChange={setCreateOpen}&gt;\n          &lt;DialogTrigger asChild&gt;\n            &lt;Button className=\&quot;gap-2\&quot;&gt;\n              &lt;Plus className=\&quot;h-4 w-4\&quot; /&gt;\n              New form config\n            &lt;/Button&gt;\n          &lt;/DialogTrigger&gt;\n          &lt;FormConfigDialog\n            mode=\&quot;create\&quot;\n            entities={entities}\n            geographies={geographies}\n            open={createOpen}\n            onOpenChange={setCreateOpen}\n            onSuccess={() =&gt; {\n              setCreateOpen(false);\n              refresh();\n            }}\n          /&gt;\n        &lt;/Dialog&gt;\n      &lt;/div&gt;\n\n      {forms.length === 0 &amp;&amp; (\n        &lt;div className=\&quot;rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center text-slate-500\&quot;&gt;\n          &lt;p&gt;No form definitions yet. Create one to start mapping schema versions.&lt;/p&gt;\n        &lt;/div&gt;\n      )}\n\n      &lt;div className=\&quot;space-y-4\&quot;&gt;\n        {forms.map((form) =&gt; (\n          &lt;div\n            key={form.id}\n            className=\&quot;rounded-2xl border border-slate-200 bg-white p-5 shadow-sm\&quot;\n          &gt;\n            &lt;div className=\&quot;flex flex-wrap items-start justify-between gap-4\&quot;&gt;\n              &lt;div&gt;\n                &lt;div className=\&quot;flex flex-wrap items-center gap-3\&quot;&gt;\n                  &lt;h3 className=\&quot;text-lg font-semibold text-slate-900\&quot;&gt;\n                    {form.entity.name} • {form.geography.code.toUpperCase()} • v\n                    {form.version}\n                  &lt;/h3&gt;\n                  &lt;Badge variant={form.isActive ? \&quot;default\&quot; : \&quot;secondary\&quot;}&gt;\n                    {form.isActive ? \&quot;Active\&quot; : \&quot;Inactive\&quot;}\n                  &lt;/Badge&gt;\n                &lt;/div&gt;\n                {form.title &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-600\&quot;&gt;{form.title}&lt;/p&gt;\n                )}\n                {form.description &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;{form.description}&lt;/p&gt;\n                )}\n                &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n                  Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))}\n                  {\&quot; \&quot;}\n                  UTC\n                &lt;/p&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n                  &lt;Link\n                    href={&#96;/forms/${form.id}&#96;}\n                    target=\&quot;_blank\&quot;\n                    rel=\&quot;noreferrer\&quot;\n                  &gt;\n                    View form\n                  &lt;/Link&gt;\n                &lt;/Button&gt;\n                &lt;DropdownMenu&gt;\n                  &lt;DropdownMenuTrigger asChild&gt;\n                    &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n                      &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n                    &lt;/Button&gt;\n                  &lt;/DropdownMenuTrigger&gt;\n                  &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                    &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n                      Edit config\n                    &lt;/DropdownMenuItem&gt;\n                    &lt;DropdownMenuItem\n                      className=\&quot;text-red-600\&quot;\n                      onClick={() =&gt; setDeletingForm(form)}\n                    &gt;\n                      Delete config\n                    &lt;/DropdownMenuItem&gt;\n                  &lt;/DropdownMenuContent&gt;\n                &lt;/DropdownMenu&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-6 space-y-4\&quot;&gt;\n              {form.sections.length === 0 &amp;&amp; (\n                &lt;div className=\&quot;rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500\&quot;&gt;\n                  No sections configured for this form.\n                &lt;/div&gt;\n              )}\n\n              {form.sections.map((section) =&gt; (\n                &lt;div\n                  key={section.id}\n                  className=\&quot;rounded-xl border border-slate-200 bg-slate-50 p-4\&quot;\n                &gt;\n                  &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-3\&quot;&gt;\n                    &lt;div&gt;\n                      &lt;div className=\&quot;flex items-center gap-2 text-slate-700\&quot;&gt;\n                        &lt;ListTree className=\&quot;h-4 w-4 text-slate-400\&quot; /&gt;\n                        &lt;h4 className=\&quot;text-base font-semibold\&quot;&gt;\n                          {section.label}\n                        &lt;/h4&gt;\n                      &lt;/div&gt;\n                      &lt;p className=\&quot;text-xs font-mono uppercase tracking-wide text-slate-400\&quot;&gt;\n                        {section.key} • order {section.order}\n                      &lt;/p&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex flex-wrap items-center gap-2\&quot;&gt;\n                      &lt;Button\n                        variant=\&quot;outline\&quot;\n                        size=\&quot;sm\&quot;\n                        onClick={() =&gt;\n                          setFieldDialog({\n                            form,\n                            section,\n                            field: null,\n                          })\n                        }\n                      &gt;\n                        &lt;Plus className=\&quot;mr-2 h-3.5 w-3.5\&quot; /&gt;\n                        Field\n                      &lt;/Button&gt;\n                      &lt;DropdownMenu&gt;\n                        &lt;DropdownMenuTrigger asChild&gt;\n                          &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                            &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                          &lt;/Button&gt;\n                        &lt;/DropdownMenuTrigger&gt;\n                        &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                          &lt;DropdownMenuItem\n                            onClick={() =&gt;\n                              setSectionDialog({ form, section })\n                            }\n                          &gt;\n                            Edit section\n                          &lt;/DropdownMenuItem&gt;\n                          &lt;DropdownMenuItem\n                            className=\&quot;text-red-600\&quot;\n                            onClick={() =&gt;\n                              setSectionDelete({ form, section })\n                            }\n                          &gt;\n                            Delete section\n                          &lt;/DropdownMenuItem&gt;\n                        &lt;/DropdownMenuContent&gt;\n                      &lt;/DropdownMenu&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n\n                  &lt;div className=\&quot;mt-3 overflow-hidden rounded-lg border border-slate-200 bg-white\&quot;&gt;\n                    &lt;Table&gt;\n                      &lt;TableHeader className=\&quot;bg-slate-100\&quot;&gt;\n                        &lt;TableRow&gt;\n                          &lt;TableHead&gt;Label&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Key&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Type&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Required\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Order\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-16 text-right\&quot;&gt;\n                            Actions\n                          &lt;/TableHead&gt;\n                        &lt;/TableRow&gt;\n                      &lt;/TableHeader&gt;\n                      &lt;TableBody&gt;\n                        {section.fields.length === 0 &amp;&amp; (\n                          &lt;TableRow&gt;\n                            &lt;TableCell\n                              colSpan={6}\n                              className=\&quot;text-center text-sm text-slate-500\&quot;\n                            &gt;\n                              No fields yet. Add the first field.\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        )}\n                        {section.fields.map((field) =&gt; (\n                          &lt;TableRow key={field.id}&gt;\n                            &lt;TableCell className=\&quot;font-medium text-slate-900\&quot;&gt;\n                              {field.label}\n                              {field.helpText &amp;&amp; (\n                                &lt;p className=\&quot;text-xs text-slate-500\&quot;&gt;\n                                  {field.helpText}\n                                &lt;/p&gt;\n                              )}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;font-mono text-xs uppercase text-slate-500\&quot;&gt;\n                              {field.key}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell&gt;\n                              &lt;Badge variant=\&quot;secondary\&quot;&gt;{field.type}&lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              &lt;Badge\n                                variant={field.required ? \&quot;default\&quot; : \&quot;outline\&quot;}\n                              &gt;\n                                {field.required ? \&quot;Yes\&quot; : \&quot;No\&quot;}\n                              &lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              {field.order}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-right\&quot;&gt;\n                              &lt;DropdownMenu&gt;\n                                &lt;DropdownMenuTrigger asChild&gt;\n                                  &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                                    &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                                  &lt;/Button&gt;\n                                &lt;/DropdownMenuTrigger&gt;\n                                &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                                  &lt;DropdownMenuItem\n                                    onClick={() =&gt;\n                                      setFieldDialog({ form, section, field })\n                                    }\n                                  &gt;\n                                    Edit\n                                  &lt;/DropdownMenuItem&gt;\n                                  &lt;DropdownMenuItem\n                                    className=\&quot;text-red-600\&quot;\n                                    onClick={() =&gt;\n                                      setFieldDelete({ form, section, field })\n                                    }\n                                  &gt;\n                                    Delete\n                                  &lt;/DropdownMenuItem&gt;\n                                &lt;/DropdownMenuContent&gt;\n                              &lt;/DropdownMenu&gt;\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        ))}\n                      &lt;/TableBody&gt;\n                    &lt;/Table&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-4\&quot;&gt;\n              &lt;Button\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={() =&gt; setSectionDialog({ form, section: null })}\n              &gt;\n                &lt;Plus className=\&quot;mr-2 h-4 w-4\&quot; /&gt;\n                Add section\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ))}\n      &lt;/div&gt;\n\n      &lt;FormConfigDialog\n        mode=\&quot;edit\&quot;\n        form={editingForm}\n        entities={entities}\n        geographies={geographies}\n        open={Boolean(editingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setEditingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setEditingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      &lt;DeleteFormDialog\n        form={deletingForm}\n        open={Boolean(deletingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setDeletingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setDeletingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      {sectionDialog?.form &amp;&amp; (\n        &lt;SectionDialog\n          mode={sectionDialog.section ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={sectionDialog.form}\n          section={sectionDialog.section}\n          open={Boolean(sectionDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {sectionDelete?.form &amp;&amp; sectionDelete.section &amp;&amp; (\n        &lt;DeleteSectionDialog\n          form={sectionDelete.form}\n          section={sectionDelete.section}\n          open={Boolean(sectionDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDialog?.form &amp;&amp; (\n        &lt;FieldDialog\n          mode={fieldDialog.field ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={fieldDialog.form}\n          section={fieldDialog.section}\n          field={fieldDialog.field}\n          open={Boolean(fieldDialog)}\n          documentTypes={documentTypes}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDelete?.form &amp;&amp; fieldDelete.field &amp;&amp; (\n        &lt;DeleteFieldDialog\n          form={fieldDelete.form}\n          section={fieldDelete.section}\n          field={fieldDelete.field}\n          open={Boolean(fieldDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\ninterface FormConfigDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form?: FormDefinitionSummary | null;\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction FormConfigDialog({\n  mode,\n  form,\n  entities,\n  geographies,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FormConfigDialogProps) {\n  const [entityId, setEntityId] = useState(\&quot;\&quot;);\n  const [geographyId, setGeographyId] = useState(\&quot;\&quot;);\n  const [version, setVersion] = useState(\&quot;1\&quot;);\n  const [title, setTitle] = useState(\&quot;\&quot;);\n  const [description, setDescription] = useState(\&quot;\&quot;);\n  const [isActive, setIsActive] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setEntityId(form?.entity.id ?? entities[0]?.id ?? \&quot;\&quot;);\n      setGeographyId(form?.geography.id ?? geographies[0]?.id ?? \&quot;\&quot;);\n      setVersion(String(form?.version ?? 1));\n      setTitle(form?.title ?? \&quot;\&quot;);\n      setDescription(form?.description ?? \&quot;\&quot;);\n      setIsActive(form?.isActive ?? true);\n      setError(null);\n    }\n  }, [open, form, entities, geographies]);\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          entityId,\n          geographyId,\n          version: Number(version),\n          title: title.trim() || null,\n          description: description.trim() || null,\n          isActive,\n        };\n        if (!payload.entityId || !payload.geographyId) {\n          setError(\&quot;Entity and geography are required\&quot;);\n          return;\n        }\n        if (payload.version &lt; 1 || Number.isNaN(payload.version)) {\n          setError(\&quot;Version must be a positive number\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(\&quot;/api/configuration/forms\&quot;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (form) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const titleText =\n    mode === \&quot;create\&quot; ? \&quot;Create form configuration\&quot; : \&quot;Edit form configuration\&quot;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{titleText}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Entity\n              &lt;Select\n                value={entityId}\n                onValueChange={setEntityId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select entity\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {entities.map((entity) =&gt; (\n                    &lt;SelectItem key={entity.id} value={entity.id}&gt;\n                      {entity.name} ({entity.code})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Geography\n              &lt;Select\n                value={geographyId}\n                onValueChange={setGeographyId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select geography\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {geographies.map((geo) =&gt; (\n                    &lt;SelectItem key={geo.id} value={geo.id}&gt;\n                      {geo.name} ({geo.code.toUpperCase()})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Version\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                min={1}\n                value={version}\n                onChange={(event) =&gt; setVersion(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Title\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={title}\n                onChange={(event) =&gt; setTitle(event.target.value)}\n                placeholder=\&quot;Optional display title\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Description\n              &lt;textarea\n                className=\&quot;mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm\&quot;\n                rows={3}\n                value={description}\n                onChange={(event) =&gt; setDescription(event.target.value)}\n                placeholder=\&quot;Optional description\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input\n                type=\&quot;checkbox\&quot;\n                className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n                checked={isActive}\n                onChange={(event) =&gt; setIsActive(event.target.checked)}\n              /&gt;\n              Active\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending ? \&quot;Saving...\&quot; : mode === \&quot;create\&quot; ? \&quot;Create\&quot; : \&quot;Save\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFormDialogProps {\n  form: FormDefinitionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFormDialog({\n  form,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFormDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n          method: \&quot;DELETE\&quot;,\n        });\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete form configuration?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes the {form.entity.name} • {form.geography.code.toUpperCase()}\n          {\&quot; \&quot;}v{form.version} form. Applications referencing this config will no\n          longer load new drafts.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n            className=\&quot;gap-2\&quot;\n          &gt;\n            &lt;Trash2 className=\&quot;h-4 w-4\&quot; /&gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface SectionDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction SectionDialog({\n  mode,\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: SectionDialogProps) {\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setKeyValue(section?.key ?? \&quot;\&quot;);\n      setLabel(section?.label ?? \&quot;\&quot;);\n      setOrder(String(section?.order ?? 0));\n      setError(null);\n    }\n  }, [open, section]);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          key: keyValue.trim(),\n          label: label.trim(),\n          order: Number(order),\n        };\n        if (!payload.key || !payload.label) {\n          setError(\&quot;Key and label are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}/sections&#96;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (section) {\n          await jsonRequest(\n            &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n            {\n              method: \&quot;PATCH\&quot;,\n              body: JSON.stringify(payload),\n            }\n          );\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? \&quot;Add section\&quot;\n      : &#96;Edit section (${section?.label ?? \&quot;Section\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-lg\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                placeholder=\&quot;company_profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                placeholder=\&quot;Company profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create section\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteSectionDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteSectionDialog({\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteSectionDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n          {\n            method: \&quot;DELETE\&quot;,\n          }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete section?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Removing &lt;span className=\&quot;font-medium\&quot;&gt;{section.label}&lt;/span&gt; deletes\n          {section.fields.length &gt; 0 ? \&quot; its fields as well.\&quot; : \&quot; it immediately.\&quot;}\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface FieldDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n  open: boolean;\n  documentTypes: DocumentTypeSummary[];\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nconst FIELD_TYPES = [\n  { value: \&quot;text\&quot;, label: \&quot;Text\&quot; },\n  { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n  { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n  { value: \&quot;email\&quot;, label: \&quot;Email\&quot; },\n  { value: \&quot;tel\&quot;, label: \&quot;Phone\&quot; },\n  { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n  { value: \&quot;multi-select\&quot;, label: \&quot;Multi select\&quot; },\n  { value: \&quot;radio\&quot;, label: \&quot;Radio group\&quot; },\n  { value: \&quot;checkbox\&quot;, label: \&quot;Checkbox\&quot; },\n  { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n  { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n  { value: \&quot;document\&quot;, label: \&quot;Document upload\&quot; },\n];\n\nfunction getOptionValues(options: unknown): string[] {\n  if (\n    options &amp;&amp;\n    typeof options === \&quot;object\&quot; &amp;&amp;\n    Array.isArray((options as { values?: unknown[] }).values)\n  ) {\n    const { values } = options as { values?: unknown[] };\n    return (values ?? [])\n      .map((value) =&gt; &#96;${value}&#96;.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction FieldDialog({\n  mode,\n  form,\n  section,\n  field,\n  open,\n  documentTypes,\n  onOpenChange,\n  onSuccess,\n}: FieldDialogProps) {\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [type, setType] = useState(FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [required, setRequired] = useState(false);\n  const [placeholder, setPlaceholder] = useState(\&quot;\&quot;);\n  const [helpText, setHelpText] = useState(\&quot;\&quot;);\n  const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n  const [documentTypeKey, setDocumentTypeKey] = useState(\&quot;\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  const documentOptions = documentTypes.map((doc) =&gt; ({\n    key: doc.key,\n    label: &#96;${doc.label} (${doc.category})&#96;,\n  }));\n\n  const getDocumentTypeFromOptions = (options: unknown) =&gt; {\n    if (options &amp;&amp; typeof options === \&quot;object\&quot;) {\n      const maybeKey = (options as { documentTypeKey?: unknown }).documentTypeKey;\n      if (typeof maybeKey === \&quot;string\&quot;) {\n        return maybeKey;\n      }\n    }\n    return \&quot;\&quot;;\n  };\n\n  useEffect(() =&gt; {\n    if (open) {\n      setLabel(field?.label ?? \&quot;\&quot;);\n      setKeyValue(field?.key ?? \&quot;\&quot;);\n      setType(field?.type ?? FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n      setOrder(String(field?.order ?? 0));\n      setRequired(field?.required ?? false);\n      setPlaceholder(field?.placeholder ?? \&quot;\&quot;);\n      setHelpText(field?.helpText ?? \&quot;\&quot;);\n      const existingOptions = getOptionValues(field?.options ?? null);\n      setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n      setDocumentTypeKey(\n        getDocumentTypeFromOptions(field?.options ?? null) ||\n          documentOptions[0]?.key ||\n          \&quot;\&quot;\n      );\n      setError(null);\n    }\n  }, [open, field, documentOptions]);\n\n  useEffect(() =&gt; {\n    if (type === \&quot;document\&quot; &amp;&amp; !documentTypeKey) {\n      setDocumentTypeKey(documentOptions[0]?.key ?? \&quot;\&quot;);\n    }\n    if (type !== \&quot;select\&quot; &amp;&amp; type !== \&quot;multi-select\&quot; &amp;&amp; type !== \&quot;radio\&quot;) {\n      setOptionsInput(\&quot;\&quot;);\n    }\n  }, [type, documentOptions, documentTypeKey]);\n\n  if (!section || !form) return null;\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        let options: Record&lt;string, unknown&gt; | null = null;\n        if ([\&quot;select\&quot;, \&quot;multi-select\&quot;, \&quot;radio\&quot;].includes(type)) {\n          const values = optionsInput\n            .split(\&quot;,\&quot;)\n            .map((value) =&gt; value.trim())\n            .filter(Boolean);\n          options = { values };\n        } else if (type === \&quot;document\&quot;) {\n          if (!documentTypeKey) {\n            setError(\&quot;Select a document type\&quot;);\n            return;\n          }\n          options = { documentTypeKey };\n        }\n        const payload = {\n          label: label.trim(),\n          key: keyValue.trim(),\n          type,\n          order: Number(order),\n          required,\n          placeholder: placeholder.trim() || null,\n          helpText: helpText.trim() || null,\n          options,\n        };\n        if (!payload.label || !payload.key) {\n          setError(\&quot;Label and key are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        const baseUrl = &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields&#96;;\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(baseUrl, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (field) {\n          await jsonRequest(&#96;${baseUrl}/${field.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? &#96;Add field to ${section.label}&#96;\n      : &#96;Edit field (${field?.label ?? \&quot;Field\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-2xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Field type\n              &lt;Select value={type} onValueChange={setType}&gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {FIELD_TYPES.map((option) =&gt; (\n                    &lt;SelectItem key={option.value} value={option.value}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Placeholder\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={placeholder}\n                onChange={(event) =&gt; setPlaceholder(event.target.value)}\n                placeholder=\&quot;Optional placeholder text\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Help text\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={helpText}\n                onChange={(event) =&gt; setHelpText(event.target.value)}\n                placeholder=\&quot;Guidance displayed under the input\&quot;\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {type === \&quot;select\&quot; &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Options (comma separated)\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={optionsInput}\n                onChange={(event) =&gt; setOptionsInput(event.target.value)}\n                placeholder=\&quot;Option A, Option B, Option C\&quot;\n              /&gt;\n            &lt;/label&gt;\n          )}\n          &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n            &lt;input\n              type=\&quot;checkbox\&quot;\n              className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n              checked={required}\n              onChange={(event) =&gt; setRequired(event.target.checked)}\n            /&gt;\n            Required field\n          &lt;/label&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create field\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFieldDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFieldDialog({\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFieldDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields/${field.id}&#96;,\n          { method: \&quot;DELETE\&quot; }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete field?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes &lt;span className=\&quot;font-medium\&quot;&gt;{field.label}&lt;/span&gt; from{\&quot; \&quot;}\n          {section.label}. Existing drafts may lose captured data in this key.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Adjusting document type handling**</details></think>

---

The model made no changes to the file.

---

<think><details><summary>Thought Process</summary>
**Checking indentation effects**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating type condition check**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;db8c68f8-8228-49b0-b1ff-891761b39e3d&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;              &lt;/label&gt;\n            &lt;/div&gt;\n-           {type === \&quot;select\&quot; &amp;&amp; (\n+           {[\&quot;select\&quot;, \&quot;multi-select\&quot;, \&quot;radio\&quot;].includes(type) &amp;&amp; (\n              &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n                Options (comma separated)&quot;,
        &quot;oldStart&quot;: 1219,
        &quot;newStart&quot;: 1219,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;              &lt;/label&gt;\n            )}\n+           {type === \&quot;document\&quot; &amp;&amp; (\n+             &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n+               Document type\n+               &lt;Select\n+                 value={documentTypeKey}\n+                 onValueChange={setDocumentTypeKey}\n+                 disabled={documentOptions.length === 0}\n+               &gt;\n+                 &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n+                   &lt;SelectValue placeholder=\&quot;Select document type\&quot; /&gt;\n+                 &lt;/SelectTrigger&gt;\n+                 &lt;SelectContent&gt;\n+                   {documentOptions.map((option) =&gt; (\n+                     &lt;SelectItem key={option.key} value={option.key}&gt;\n+                       {option.label}\n+                     &lt;/SelectItem&gt;\n+                   ))}\n+                 &lt;/SelectContent&gt;\n+               &lt;/Select&gt;\n+               {documentOptions.length === 0 &amp;&amp; (\n+                 &lt;p className=\&quot;mt-1 text-xs text-amber-600\&quot;&gt;\n+                   No document types available. Create one in Documents first.\n+                 &lt;/p&gt;\n+               )}\n+             &lt;/label&gt;\n+           )}\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input&quot;,
        &quot;oldStart&quot;: 1230,
        &quot;newStart&quot;: 1230,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 30,
        &quot;linesAdded&quot;: 26
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useEffect, useState, useTransition } from \&quot;react\&quot;;\nimport Link from \&quot;next/link\&quot;;\nimport { useRouter } from \&quot;next/navigation\&quot;;\nimport {\n  Dialog,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \&quot;@/components/ui/dialog\&quot;;\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \&quot;@/components/ui/dropdown-menu\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \&quot;@/components/ui/table\&quot;;\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \&quot;@/components/ui/select\&quot;;\nimport { Input } from \&quot;@/components/ui/input\&quot;;\nimport {\n  Layers,\n  ListTree,\n  MoreHorizontal,\n  Plus,\n  Trash2,\n} from \&quot;lucide-react\&quot;;\n\nimport { jsonRequest } from \&quot;@/lib/admin-api\&quot;;\n\ninterface EntitySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface GeographySummary {\n  id: string;\n  name: string;\n  code: string;\n}\n\ninterface FormFieldSummary {\n  id: string;\n  key: string;\n  label: string;\n  type: string;\n  required: boolean;\n  order: number;\n  placeholder: string | null;\n  helpText: string | null;\n  options: unknown;\n}\n\ninterface FormSectionSummary {\n  id: string;\n  key: string;\n  label: string;\n  order: number;\n  formConfigId: string;\n  fields: FormFieldSummary[];\n}\n\ninterface FormDefinitionSummary {\n  id: string;\n  entity: EntitySummary;\n  geography: GeographySummary;\n  version: number;\n  title: string | null;\n  description: string | null;\n  isActive: boolean;\n  createdAt: string | Date;\n  updatedAt: string | Date;\n  sections: FormSectionSummary[];\n}\n\ninterface DocumentTypeSummary {\n  id: string;\n  key: string;\n  label: string;\n  category: string;\n}\n\nconst UPDATED_AT_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n  dateStyle: \&quot;medium\&quot;,\n  timeStyle: \&quot;short\&quot;,\n  timeZone: \&quot;UTC\&quot;,\n});\n\ninterface FormDefinitionsPanelProps {\n  forms: FormDefinitionSummary[];\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  documentTypes: DocumentTypeSummary[];\n}\n\ninterface SectionDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n}\n\ninterface FieldDialogState {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n}\n\nexport function FormDefinitionsPanel({\n  forms,\n  entities,\n  geographies,\n  documentTypes,\n}: FormDefinitionsPanelProps) {\n  const router = useRouter();\n  const [createOpen, setCreateOpen] = useState(false);\n  const [editingForm, setEditingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [deletingForm, setDeletingForm] = useState&lt;FormDefinitionSummary | null&gt;(\n    null\n  );\n  const [sectionDialog, setSectionDialog] = useState&lt;SectionDialogState | null&gt;(\n    null\n  );\n  const [sectionDelete, setSectionDelete] =\n    useState&lt;SectionDialogState | null&gt;(null);\n  const [fieldDialog, setFieldDialog] = useState&lt;FieldDialogState | null&gt;(null);\n  const [fieldDelete, setFieldDelete] = useState&lt;FieldDialogState | null&gt;(null);\n\n  const refresh = () =&gt; router.refresh();\n\n  return (\n    &lt;div className=\&quot;space-y-6\&quot;&gt;\n      &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-4\&quot;&gt;\n        &lt;div className=\&quot;flex items-center gap-2 text-slate-500\&quot;&gt;\n          &lt;Layers className=\&quot;h-4 w-4\&quot; /&gt;\n          &lt;span&gt;\n            {forms.length}{\&quot; \&quot;}\n            {forms.length === 1 ? \&quot;form definition\&quot; : \&quot;form definitions\&quot;}\n          &lt;/span&gt;\n        &lt;/div&gt;\n        &lt;Dialog open={createOpen} onOpenChange={setCreateOpen}&gt;\n          &lt;DialogTrigger asChild&gt;\n            &lt;Button className=\&quot;gap-2\&quot;&gt;\n              &lt;Plus className=\&quot;h-4 w-4\&quot; /&gt;\n              New form config\n            &lt;/Button&gt;\n          &lt;/DialogTrigger&gt;\n          &lt;FormConfigDialog\n            mode=\&quot;create\&quot;\n            entities={entities}\n            geographies={geographies}\n            open={createOpen}\n            onOpenChange={setCreateOpen}\n            onSuccess={() =&gt; {\n              setCreateOpen(false);\n              refresh();\n            }}\n          /&gt;\n        &lt;/Dialog&gt;\n      &lt;/div&gt;\n\n      {forms.length === 0 &amp;&amp; (\n        &lt;div className=\&quot;rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-10 text-center text-slate-500\&quot;&gt;\n          &lt;p&gt;No form definitions yet. Create one to start mapping schema versions.&lt;/p&gt;\n        &lt;/div&gt;\n      )}\n\n      &lt;div className=\&quot;space-y-4\&quot;&gt;\n        {forms.map((form) =&gt; (\n          &lt;div\n            key={form.id}\n            className=\&quot;rounded-2xl border border-slate-200 bg-white p-5 shadow-sm\&quot;\n          &gt;\n            &lt;div className=\&quot;flex flex-wrap items-start justify-between gap-4\&quot;&gt;\n              &lt;div&gt;\n                &lt;div className=\&quot;flex flex-wrap items-center gap-3\&quot;&gt;\n                  &lt;h3 className=\&quot;text-lg font-semibold text-slate-900\&quot;&gt;\n                    {form.entity.name} • {form.geography.code.toUpperCase()} • v\n                    {form.version}\n                  &lt;/h3&gt;\n                  &lt;Badge variant={form.isActive ? \&quot;default\&quot; : \&quot;secondary\&quot;}&gt;\n                    {form.isActive ? \&quot;Active\&quot; : \&quot;Inactive\&quot;}\n                  &lt;/Badge&gt;\n                &lt;/div&gt;\n                {form.title &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-600\&quot;&gt;{form.title}&lt;/p&gt;\n                )}\n                {form.description &amp;&amp; (\n                  &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;{form.description}&lt;/p&gt;\n                )}\n                &lt;p className=\&quot;text-xs text-slate-400\&quot;&gt;\n                  Updated {UPDATED_AT_FORMATTER.format(new Date(form.updatedAt))}\n                  {\&quot; \&quot;}\n                  UTC\n                &lt;/p&gt;\n              &lt;/div&gt;\n              &lt;div className=\&quot;flex items-center gap-2\&quot;&gt;\n                &lt;Button variant=\&quot;outline\&quot; size=\&quot;sm\&quot; asChild&gt;\n                  &lt;Link\n                    href={&#96;/forms/${form.id}&#96;}\n                    target=\&quot;_blank\&quot;\n                    rel=\&quot;noreferrer\&quot;\n                  &gt;\n                    View form\n                  &lt;/Link&gt;\n                &lt;/Button&gt;\n                &lt;DropdownMenu&gt;\n                  &lt;DropdownMenuTrigger asChild&gt;\n                    &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot; aria-label=\&quot;Form actions\&quot;&gt;\n                      &lt;MoreHorizontal className=\&quot;h-5 w-5\&quot; /&gt;\n                    &lt;/Button&gt;\n                  &lt;/DropdownMenuTrigger&gt;\n                  &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                    &lt;DropdownMenuItem onClick={() =&gt; setEditingForm(form)}&gt;\n                      Edit config\n                    &lt;/DropdownMenuItem&gt;\n                    &lt;DropdownMenuItem\n                      className=\&quot;text-red-600\&quot;\n                      onClick={() =&gt; setDeletingForm(form)}\n                    &gt;\n                      Delete config\n                    &lt;/DropdownMenuItem&gt;\n                  &lt;/DropdownMenuContent&gt;\n                &lt;/DropdownMenu&gt;\n              &lt;/div&gt;\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-6 space-y-4\&quot;&gt;\n              {form.sections.length === 0 &amp;&amp; (\n                &lt;div className=\&quot;rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500\&quot;&gt;\n                  No sections configured for this form.\n                &lt;/div&gt;\n              )}\n\n              {form.sections.map((section) =&gt; (\n                &lt;div\n                  key={section.id}\n                  className=\&quot;rounded-xl border border-slate-200 bg-slate-50 p-4\&quot;\n                &gt;\n                  &lt;div className=\&quot;flex flex-wrap items-center justify-between gap-3\&quot;&gt;\n                    &lt;div&gt;\n                      &lt;div className=\&quot;flex items-center gap-2 text-slate-700\&quot;&gt;\n                        &lt;ListTree className=\&quot;h-4 w-4 text-slate-400\&quot; /&gt;\n                        &lt;h4 className=\&quot;text-base font-semibold\&quot;&gt;\n                          {section.label}\n                        &lt;/h4&gt;\n                      &lt;/div&gt;\n                      &lt;p className=\&quot;text-xs font-mono uppercase tracking-wide text-slate-400\&quot;&gt;\n                        {section.key} • order {section.order}\n                      &lt;/p&gt;\n                    &lt;/div&gt;\n                    &lt;div className=\&quot;flex flex-wrap items-center gap-2\&quot;&gt;\n                      &lt;Button\n                        variant=\&quot;outline\&quot;\n                        size=\&quot;sm\&quot;\n                        onClick={() =&gt;\n                          setFieldDialog({\n                            form,\n                            section,\n                            field: null,\n                          })\n                        }\n                      &gt;\n                        &lt;Plus className=\&quot;mr-2 h-3.5 w-3.5\&quot; /&gt;\n                        Field\n                      &lt;/Button&gt;\n                      &lt;DropdownMenu&gt;\n                        &lt;DropdownMenuTrigger asChild&gt;\n                          &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                            &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                          &lt;/Button&gt;\n                        &lt;/DropdownMenuTrigger&gt;\n                        &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                          &lt;DropdownMenuItem\n                            onClick={() =&gt;\n                              setSectionDialog({ form, section })\n                            }\n                          &gt;\n                            Edit section\n                          &lt;/DropdownMenuItem&gt;\n                          &lt;DropdownMenuItem\n                            className=\&quot;text-red-600\&quot;\n                            onClick={() =&gt;\n                              setSectionDelete({ form, section })\n                            }\n                          &gt;\n                            Delete section\n                          &lt;/DropdownMenuItem&gt;\n                        &lt;/DropdownMenuContent&gt;\n                      &lt;/DropdownMenu&gt;\n                    &lt;/div&gt;\n                  &lt;/div&gt;\n\n                  &lt;div className=\&quot;mt-3 overflow-hidden rounded-lg border border-slate-200 bg-white\&quot;&gt;\n                    &lt;Table&gt;\n                      &lt;TableHeader className=\&quot;bg-slate-100\&quot;&gt;\n                        &lt;TableRow&gt;\n                          &lt;TableHead&gt;Label&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Key&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-32\&quot;&gt;Type&lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Required\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-24 text-center\&quot;&gt;\n                            Order\n                          &lt;/TableHead&gt;\n                          &lt;TableHead className=\&quot;w-16 text-right\&quot;&gt;\n                            Actions\n                          &lt;/TableHead&gt;\n                        &lt;/TableRow&gt;\n                      &lt;/TableHeader&gt;\n                      &lt;TableBody&gt;\n                        {section.fields.length === 0 &amp;&amp; (\n                          &lt;TableRow&gt;\n                            &lt;TableCell\n                              colSpan={6}\n                              className=\&quot;text-center text-sm text-slate-500\&quot;\n                            &gt;\n                              No fields yet. Add the first field.\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        )}\n                        {section.fields.map((field) =&gt; (\n                          &lt;TableRow key={field.id}&gt;\n                            &lt;TableCell className=\&quot;font-medium text-slate-900\&quot;&gt;\n                              {field.label}\n                              {field.helpText &amp;&amp; (\n                                &lt;p className=\&quot;text-xs text-slate-500\&quot;&gt;\n                                  {field.helpText}\n                                &lt;/p&gt;\n                              )}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;font-mono text-xs uppercase text-slate-500\&quot;&gt;\n                              {field.key}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell&gt;\n                              &lt;Badge variant=\&quot;secondary\&quot;&gt;{field.type}&lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              &lt;Badge\n                                variant={field.required ? \&quot;default\&quot; : \&quot;outline\&quot;}\n                              &gt;\n                                {field.required ? \&quot;Yes\&quot; : \&quot;No\&quot;}\n                              &lt;/Badge&gt;\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-center\&quot;&gt;\n                              {field.order}\n                            &lt;/TableCell&gt;\n                            &lt;TableCell className=\&quot;text-right\&quot;&gt;\n                              &lt;DropdownMenu&gt;\n                                &lt;DropdownMenuTrigger asChild&gt;\n                                  &lt;Button variant=\&quot;ghost\&quot; size=\&quot;icon\&quot;&gt;\n                                    &lt;MoreHorizontal className=\&quot;h-4 w-4\&quot; /&gt;\n                                  &lt;/Button&gt;\n                                &lt;/DropdownMenuTrigger&gt;\n                                &lt;DropdownMenuContent align=\&quot;end\&quot;&gt;\n                                  &lt;DropdownMenuItem\n                                    onClick={() =&gt;\n                                      setFieldDialog({ form, section, field })\n                                    }\n                                  &gt;\n                                    Edit\n                                  &lt;/DropdownMenuItem&gt;\n                                  &lt;DropdownMenuItem\n                                    className=\&quot;text-red-600\&quot;\n                                    onClick={() =&gt;\n                                      setFieldDelete({ form, section, field })\n                                    }\n                                  &gt;\n                                    Delete\n                                  &lt;/DropdownMenuItem&gt;\n                                &lt;/DropdownMenuContent&gt;\n                              &lt;/DropdownMenu&gt;\n                            &lt;/TableCell&gt;\n                          &lt;/TableRow&gt;\n                        ))}\n                      &lt;/TableBody&gt;\n                    &lt;/Table&gt;\n                  &lt;/div&gt;\n                &lt;/div&gt;\n              ))}\n            &lt;/div&gt;\n\n            &lt;div className=\&quot;mt-4\&quot;&gt;\n              &lt;Button\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={() =&gt; setSectionDialog({ form, section: null })}\n              &gt;\n                &lt;Plus className=\&quot;mr-2 h-4 w-4\&quot; /&gt;\n                Add section\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ))}\n      &lt;/div&gt;\n\n      &lt;FormConfigDialog\n        mode=\&quot;edit\&quot;\n        form={editingForm}\n        entities={entities}\n        geographies={geographies}\n        open={Boolean(editingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setEditingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setEditingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      &lt;DeleteFormDialog\n        form={deletingForm}\n        open={Boolean(deletingForm)}\n        onOpenChange={(open) =&gt; {\n          if (!open) setDeletingForm(null);\n        }}\n        onSuccess={() =&gt; {\n          setDeletingForm(null);\n          refresh();\n        }}\n      /&gt;\n\n      {sectionDialog?.form &amp;&amp; (\n        &lt;SectionDialog\n          mode={sectionDialog.section ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={sectionDialog.form}\n          section={sectionDialog.section}\n          open={Boolean(sectionDialog)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {sectionDelete?.form &amp;&amp; sectionDelete.section &amp;&amp; (\n        &lt;DeleteSectionDialog\n          form={sectionDelete.form}\n          section={sectionDelete.section}\n          open={Boolean(sectionDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setSectionDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setSectionDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDialog?.form &amp;&amp; (\n        &lt;FieldDialog\n          mode={fieldDialog.field ? \&quot;edit\&quot; : \&quot;create\&quot;}\n          form={fieldDialog.form}\n          section={fieldDialog.section}\n          field={fieldDialog.field}\n          open={Boolean(fieldDialog)}\n          documentTypes={documentTypes}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDialog(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDialog(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n\n      {fieldDelete?.form &amp;&amp; fieldDelete.field &amp;&amp; (\n        &lt;DeleteFieldDialog\n          form={fieldDelete.form}\n          section={fieldDelete.section}\n          field={fieldDelete.field}\n          open={Boolean(fieldDelete)}\n          onOpenChange={(open) =&gt; {\n            if (!open) setFieldDelete(null);\n          }}\n          onSuccess={() =&gt; {\n            setFieldDelete(null);\n            refresh();\n          }}\n        /&gt;\n      )}\n    &lt;/div&gt;\n  );\n}\n\ninterface FormConfigDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form?: FormDefinitionSummary | null;\n  entities: EntitySummary[];\n  geographies: GeographySummary[];\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction FormConfigDialog({\n  mode,\n  form,\n  entities,\n  geographies,\n  open,\n  onOpenChange,\n  onSuccess,\n}: FormConfigDialogProps) {\n  const [entityId, setEntityId] = useState(\&quot;\&quot;);\n  const [geographyId, setGeographyId] = useState(\&quot;\&quot;);\n  const [version, setVersion] = useState(\&quot;1\&quot;);\n  const [title, setTitle] = useState(\&quot;\&quot;);\n  const [description, setDescription] = useState(\&quot;\&quot;);\n  const [isActive, setIsActive] = useState(true);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setEntityId(form?.entity.id ?? entities[0]?.id ?? \&quot;\&quot;);\n      setGeographyId(form?.geography.id ?? geographies[0]?.id ?? \&quot;\&quot;);\n      setVersion(String(form?.version ?? 1));\n      setTitle(form?.title ?? \&quot;\&quot;);\n      setDescription(form?.description ?? \&quot;\&quot;);\n      setIsActive(form?.isActive ?? true);\n      setError(null);\n    }\n  }, [open, form, entities, geographies]);\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          entityId,\n          geographyId,\n          version: Number(version),\n          title: title.trim() || null,\n          description: description.trim() || null,\n          isActive,\n        };\n        if (!payload.entityId || !payload.geographyId) {\n          setError(\&quot;Entity and geography are required\&quot;);\n          return;\n        }\n        if (payload.version &lt; 1 || Number.isNaN(payload.version)) {\n          setError(\&quot;Version must be a positive number\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(\&quot;/api/configuration/forms\&quot;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (form) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const titleText =\n    mode === \&quot;create\&quot; ? \&quot;Create form configuration\&quot; : \&quot;Edit form configuration\&quot;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{titleText}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Entity\n              &lt;Select\n                value={entityId}\n                onValueChange={setEntityId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select entity\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {entities.map((entity) =&gt; (\n                    &lt;SelectItem key={entity.id} value={entity.id}&gt;\n                      {entity.name} ({entity.code})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Geography\n              &lt;Select\n                value={geographyId}\n                onValueChange={setGeographyId}\n                disabled={mode === \&quot;edit\&quot;}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select geography\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {geographies.map((geo) =&gt; (\n                    &lt;SelectItem key={geo.id} value={geo.id}&gt;\n                      {geo.name} ({geo.code.toUpperCase()})\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Version\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                min={1}\n                value={version}\n                onChange={(event) =&gt; setVersion(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Title\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={title}\n                onChange={(event) =&gt; setTitle(event.target.value)}\n                placeholder=\&quot;Optional display title\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Description\n              &lt;textarea\n                className=\&quot;mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm\&quot;\n                rows={3}\n                value={description}\n                onChange={(event) =&gt; setDescription(event.target.value)}\n                placeholder=\&quot;Optional description\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n              &lt;input\n                type=\&quot;checkbox\&quot;\n                className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n                checked={isActive}\n                onChange={(event) =&gt; setIsActive(event.target.checked)}\n              /&gt;\n              Active\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending ? \&quot;Saving...\&quot; : mode === \&quot;create\&quot; ? \&quot;Create\&quot; : \&quot;Save\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFormDialogProps {\n  form: FormDefinitionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFormDialog({\n  form,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFormDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(&#96;/api/configuration/forms/${form.id}&#96;, {\n          method: \&quot;DELETE\&quot;,\n        });\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete form configuration?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes the {form.entity.name} • {form.geography.code.toUpperCase()}\n          {\&quot; \&quot;}v{form.version} form. Applications referencing this config will no\n          longer load new drafts.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n            className=\&quot;gap-2\&quot;\n          &gt;\n            &lt;Trash2 className=\&quot;h-4 w-4\&quot; /&gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface SectionDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction SectionDialog({\n  mode,\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: SectionDialogProps) {\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  useEffect(() =&gt; {\n    if (open) {\n      setKeyValue(section?.key ?? \&quot;\&quot;);\n      setLabel(section?.label ?? \&quot;\&quot;);\n      setOrder(String(section?.order ?? 0));\n      setError(null);\n    }\n  }, [open, section]);\n\n  if (!form) {\n    return null;\n  }\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        const payload = {\n          key: keyValue.trim(),\n          label: label.trim(),\n          order: Number(order),\n        };\n        if (!payload.key || !payload.label) {\n          setError(\&quot;Key and label are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(&#96;/api/configuration/forms/${form.id}/sections&#96;, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (section) {\n          await jsonRequest(\n            &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n            {\n              method: \&quot;PATCH\&quot;,\n              body: JSON.stringify(payload),\n            }\n          );\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? \&quot;Add section\&quot;\n      : &#96;Edit section (${section?.label ?? \&quot;Section\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-lg\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                placeholder=\&quot;company_profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                placeholder=\&quot;Company profile\&quot;\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create section\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteSectionDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteSectionDialog({\n  form,\n  section,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteSectionDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}&#96;,\n          {\n            method: \&quot;DELETE\&quot;,\n          }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete section?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          Removing &lt;span className=\&quot;font-medium\&quot;&gt;{section.label}&lt;/span&gt; deletes\n          {section.fields.length &gt; 0 ? \&quot; its fields as well.\&quot; : \&quot; it immediately.\&quot;}\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface FieldDialogProps {\n  mode: \&quot;create\&quot; | \&quot;edit\&quot;;\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary | null;\n  open: boolean;\n  documentTypes: DocumentTypeSummary[];\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nconst FIELD_TYPES = [\n  { value: \&quot;text\&quot;, label: \&quot;Text\&quot; },\n  { value: \&quot;textarea\&quot;, label: \&quot;Textarea\&quot; },\n  { value: \&quot;number\&quot;, label: \&quot;Number\&quot; },\n  { value: \&quot;email\&quot;, label: \&quot;Email\&quot; },\n  { value: \&quot;tel\&quot;, label: \&quot;Phone\&quot; },\n  { value: \&quot;select\&quot;, label: \&quot;Select\&quot; },\n  { value: \&quot;multi-select\&quot;, label: \&quot;Multi select\&quot; },\n  { value: \&quot;radio\&quot;, label: \&quot;Radio group\&quot; },\n  { value: \&quot;checkbox\&quot;, label: \&quot;Checkbox\&quot; },\n  { value: \&quot;boolean\&quot;, label: \&quot;Boolean\&quot; },\n  { value: \&quot;date\&quot;, label: \&quot;Date\&quot; },\n  { value: \&quot;document\&quot;, label: \&quot;Document upload\&quot; },\n];\n\nfunction getOptionValues(options: unknown): string[] {\n  if (\n    options &amp;&amp;\n    typeof options === \&quot;object\&quot; &amp;&amp;\n    Array.isArray((options as { values?: unknown[] }).values)\n  ) {\n    const { values } = options as { values?: unknown[] };\n    return (values ?? [])\n      .map((value) =&gt; &#96;${value}&#96;.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction FieldDialog({\n  mode,\n  form,\n  section,\n  field,\n  open,\n  documentTypes,\n  onOpenChange,\n  onSuccess,\n}: FieldDialogProps) {\n  const [label, setLabel] = useState(\&quot;\&quot;);\n  const [keyValue, setKeyValue] = useState(\&quot;\&quot;);\n  const [type, setType] = useState(FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n  const [order, setOrder] = useState(\&quot;0\&quot;);\n  const [required, setRequired] = useState(false);\n  const [placeholder, setPlaceholder] = useState(\&quot;\&quot;);\n  const [helpText, setHelpText] = useState(\&quot;\&quot;);\n  const [optionsInput, setOptionsInput] = useState(\&quot;\&quot;);\n  const [documentTypeKey, setDocumentTypeKey] = useState(\&quot;\&quot;);\n  const [error, setError] = useState&lt;string | null&gt;(null);\n  const [isPending, startTransition] = useTransition();\n\n  const documentOptions = documentTypes.map((doc) =&gt; ({\n    key: doc.key,\n    label: &#96;${doc.label} (${doc.category})&#96;,\n  }));\n\n  const getDocumentTypeFromOptions = (options: unknown) =&gt; {\n    if (options &amp;&amp; typeof options === \&quot;object\&quot;) {\n      const maybeKey = (options as { documentTypeKey?: unknown }).documentTypeKey;\n      if (typeof maybeKey === \&quot;string\&quot;) {\n        return maybeKey;\n      }\n    }\n    return \&quot;\&quot;;\n  };\n\n  useEffect(() =&gt; {\n    if (open) {\n      setLabel(field?.label ?? \&quot;\&quot;);\n      setKeyValue(field?.key ?? \&quot;\&quot;);\n      setType(field?.type ?? FIELD_TYPES[0]?.value ?? \&quot;text\&quot;);\n      setOrder(String(field?.order ?? 0));\n      setRequired(field?.required ?? false);\n      setPlaceholder(field?.placeholder ?? \&quot;\&quot;);\n      setHelpText(field?.helpText ?? \&quot;\&quot;);\n      const existingOptions = getOptionValues(field?.options ?? null);\n      setOptionsInput(existingOptions.join(\&quot;, \&quot;));\n      setDocumentTypeKey(\n        getDocumentTypeFromOptions(field?.options ?? null) ||\n          documentOptions[0]?.key ||\n          \&quot;\&quot;\n      );\n      setError(null);\n    }\n  }, [open, field, documentOptions]);\n\n  useEffect(() =&gt; {\n    if (type === \&quot;document\&quot; &amp;&amp; !documentTypeKey) {\n      setDocumentTypeKey(documentOptions[0]?.key ?? \&quot;\&quot;);\n    }\n    if (type !== \&quot;select\&quot; &amp;&amp; type !== \&quot;multi-select\&quot; &amp;&amp; type !== \&quot;radio\&quot;) {\n      setOptionsInput(\&quot;\&quot;);\n    }\n  }, [type, documentOptions, documentTypeKey]);\n\n  if (!section || !form) return null;\n\n  const handleSubmit = (event: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {\n    event.preventDefault();\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        let options: Record&lt;string, unknown&gt; | null = null;\n        if ([\&quot;select\&quot;, \&quot;multi-select\&quot;, \&quot;radio\&quot;].includes(type)) {\n          const values = optionsInput\n            .split(\&quot;,\&quot;)\n            .map((value) =&gt; value.trim())\n            .filter(Boolean);\n          options = { values };\n        } else if (type === \&quot;document\&quot;) {\n          if (!documentTypeKey) {\n            setError(\&quot;Select a document type\&quot;);\n            return;\n          }\n          options = { documentTypeKey };\n        }\n        const payload = {\n          label: label.trim(),\n          key: keyValue.trim(),\n          type,\n          order: Number(order),\n          required,\n          placeholder: placeholder.trim() || null,\n          helpText: helpText.trim() || null,\n          options,\n        };\n        if (!payload.label || !payload.key) {\n          setError(\&quot;Label and key are required\&quot;);\n          return;\n        }\n        if (Number.isNaN(payload.order)) {\n          setError(\&quot;Order must be numeric\&quot;);\n          return;\n        }\n        const baseUrl = &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields&#96;;\n        if (mode === \&quot;create\&quot;) {\n          await jsonRequest(baseUrl, {\n            method: \&quot;POST\&quot;,\n            body: JSON.stringify(payload),\n          });\n        } else if (field) {\n          await jsonRequest(&#96;${baseUrl}/${field.id}&#96;, {\n            method: \&quot;PATCH\&quot;,\n            body: JSON.stringify(payload),\n          });\n        }\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  const title =\n    mode === \&quot;create\&quot;\n      ? &#96;Add field to ${section.label}&#96;\n      : &#96;Edit field (${field?.label ?? \&quot;Field\&quot;})&#96;;\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-2xl\&quot;&gt;\n        &lt;form onSubmit={handleSubmit} className=\&quot;space-y-4\&quot;&gt;\n          &lt;DialogHeader&gt;\n            &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;\n          &lt;/DialogHeader&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Label\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={label}\n                onChange={(event) =&gt; setLabel(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Key\n              &lt;Input\n                className=\&quot;mt-1 font-mono text-xs uppercase\&quot;\n                value={keyValue}\n                onChange={(event) =&gt; setKeyValue(event.target.value)}\n                required\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Field type\n              &lt;Select value={type} onValueChange={setType}&gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {FIELD_TYPES.map((option) =&gt; (\n                    &lt;SelectItem key={option.value} value={option.value}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Order\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                type=\&quot;number\&quot;\n                value={order}\n                onChange={(event) =&gt; setOrder(event.target.value)}\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          &lt;div className=\&quot;grid gap-4 md:grid-cols-2\&quot;&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Placeholder\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={placeholder}\n                onChange={(event) =&gt; setPlaceholder(event.target.value)}\n                placeholder=\&quot;Optional placeholder text\&quot;\n              /&gt;\n            &lt;/label&gt;\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Help text\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={helpText}\n                onChange={(event) =&gt; setHelpText(event.target.value)}\n                placeholder=\&quot;Guidance displayed under the input\&quot;\n              /&gt;\n            &lt;/label&gt;\n          &lt;/div&gt;\n          {[\&quot;select\&quot;, \&quot;multi-select\&quot;, \&quot;radio\&quot;].includes(type) &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Options (comma separated)\n              &lt;Input\n                className=\&quot;mt-1\&quot;\n                value={optionsInput}\n                onChange={(event) =&gt; setOptionsInput(event.target.value)}\n                placeholder=\&quot;Option A, Option B, Option C\&quot;\n              /&gt;\n            &lt;/label&gt;\n          )}\n          {type === \&quot;document\&quot; &amp;&amp; (\n            &lt;label className=\&quot;text-sm font-medium text-slate-700\&quot;&gt;\n              Document type\n              &lt;Select\n                value={documentTypeKey}\n                onValueChange={setDocumentTypeKey}\n                disabled={documentOptions.length === 0}\n              &gt;\n                &lt;SelectTrigger className=\&quot;mt-1\&quot;&gt;\n                  &lt;SelectValue placeholder=\&quot;Select document type\&quot; /&gt;\n                &lt;/SelectTrigger&gt;\n                &lt;SelectContent&gt;\n                  {documentOptions.map((option) =&gt; (\n                    &lt;SelectItem key={option.key} value={option.key}&gt;\n                      {option.label}\n                    &lt;/SelectItem&gt;\n                  ))}\n                &lt;/SelectContent&gt;\n              &lt;/Select&gt;\n              {documentOptions.length === 0 &amp;&amp; (\n                &lt;p className=\&quot;mt-1 text-xs text-amber-600\&quot;&gt;\n                  No document types available. Create one in Documents first.\n                &lt;/p&gt;\n              )}\n            &lt;/label&gt;\n          )}\n          &lt;label className=\&quot;flex items-center gap-3 text-sm font-medium text-slate-700\&quot;&gt;\n            &lt;input\n              type=\&quot;checkbox\&quot;\n              className=\&quot;h-4 w-4 rounded border-slate-300\&quot;\n              checked={required}\n              onChange={(event) =&gt; setRequired(event.target.checked)}\n            /&gt;\n            Required field\n          &lt;/label&gt;\n          {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n          &lt;DialogFooter&gt;\n            &lt;Button\n              type=\&quot;button\&quot;\n              variant=\&quot;ghost\&quot;\n              onClick={() =&gt; onOpenChange(false)}\n              disabled={isPending}\n            &gt;\n              Cancel\n            &lt;/Button&gt;\n            &lt;Button type=\&quot;submit\&quot; disabled={isPending}&gt;\n              {isPending\n                ? \&quot;Saving...\&quot;\n                : mode === \&quot;create\&quot;\n                ? \&quot;Create field\&quot;\n                : \&quot;Save changes\&quot;}\n            &lt;/Button&gt;\n          &lt;/DialogFooter&gt;\n        &lt;/form&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\ninterface DeleteFieldDialogProps {\n  form: FormDefinitionSummary;\n  section: FormSectionSummary;\n  field: FormFieldSummary;\n  open: boolean;\n  onOpenChange: (open: boolean) =&gt; void;\n  onSuccess: () =&gt; void;\n}\n\nfunction DeleteFieldDialog({\n  form,\n  section,\n  field,\n  open,\n  onOpenChange,\n  onSuccess,\n}: DeleteFieldDialogProps) {\n  const [isPending, startTransition] = useTransition();\n  const [error, setError] = useState&lt;string | null&gt;(null);\n\n  const handleDelete = () =&gt; {\n    startTransition(async () =&gt; {\n      try {\n        setError(null);\n        await jsonRequest(\n          &#96;/api/configuration/forms/${form.id}/sections/${section.id}/fields/${field.id}&#96;,\n          { method: \&quot;DELETE\&quot; }\n        );\n        onSuccess();\n      } catch (err) {\n        setError(err instanceof Error ? err.message : \&quot;Request failed\&quot;);\n      }\n    });\n  };\n\n  return (\n    &lt;Dialog open={open} onOpenChange={onOpenChange}&gt;\n      &lt;DialogContent className=\&quot;sm:max-w-md\&quot;&gt;\n        &lt;DialogHeader&gt;\n          &lt;DialogTitle&gt;Delete field?&lt;/DialogTitle&gt;\n        &lt;/DialogHeader&gt;\n        &lt;p className=\&quot;text-sm text-slate-500\&quot;&gt;\n          This removes &lt;span className=\&quot;font-medium\&quot;&gt;{field.label}&lt;/span&gt; from{\&quot; \&quot;}\n          {section.label}. Existing drafts may lose captured data in this key.\n        &lt;/p&gt;\n        {error &amp;&amp; &lt;p className=\&quot;text-sm text-red-600\&quot;&gt;{error}&lt;/p&gt;}\n        &lt;DialogFooter&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;ghost\&quot;\n            onClick={() =&gt; onOpenChange(false)}\n            disabled={isPending}\n          &gt;\n            Cancel\n          &lt;/Button&gt;\n          &lt;Button\n            type=\&quot;button\&quot;\n            variant=\&quot;destructive\&quot;\n            onClick={handleDelete}\n            disabled={isPending}\n          &gt;\n            {isPending ? \&quot;Deleting...\&quot; : \&quot;Delete\&quot;}\n          &lt;/Button&gt;\n        &lt;/DialogFooter&gt;\n      &lt;/DialogContent&gt;\n    &lt;/Dialog&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Designing FieldDocumentUpload component**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/forms/field-document-upload.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;15971ca0-be36-4697-88b0-a02babb543f5&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;- \n+ \&quot;use client\&quot;;\n+ \n+ import { useMemo, useRef, useState } from \&quot;react\&quot;;\n+ import type { FormField } from \&quot;@prisma/client\&quot;;\n+ import { Button } from \&quot;@/components/ui/button\&quot;;\n+ import { Badge } from \&quot;@/components/ui/badge\&quot;;\n+ import { FieldWrapper } from \&quot;./field-wrapper\&quot;;\n+ \n+ export interface DocumentFieldValue {\n+   fileId: string;\n+   fileName: string;\n+   mimeType?: string;\n+   fileSize?: number;\n+   documentTypeKey?: string;\n+   uploadedAt?: string;\n+ }\n+ \n+ interface FieldDocumentUploadProps {\n+   field: FormField;\n+   value: unknown;\n+   onChange: (value: DocumentFieldValue | null) =&gt; void;\n+   applicationId: string | null;\n+   onBlur?: () =&gt; void;\n+   error?: string;\n+   disabled?: boolean;\n+   touched?: boolean;\n+ }\n+ \n+ const DATE_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n+   dateStyle: \&quot;medium\&quot;,\n+   timeStyle: \&quot;short\&quot;,\n+   timeZone: \&quot;UTC\&quot;,\n+ });\n+ \n+ function getDocumentTypeKey(options: unknown): string {\n+   if (options &amp;&amp; typeof options === \&quot;object\&quot;) {\n+     const maybeKey = (options as { documentTypeKey?: unknown }).documentTypeKey;\n+     if (typeof maybeKey === \&quot;string\&quot;) {\n+       return maybeKey;\n+     }\n+   }\n+   return \&quot;\&quot;;\n+ }\n+ \n+ function normalizeDocumentValue(value: unknown): DocumentFieldValue | null {\n+   if (!value) return null;\n+   if (Array.isArray(value)) {\n+     return normalizeDocumentValue(value[0]);\n+   }\n+   if (typeof value === \&quot;object\&quot;) {\n+     const candidate = value as Record&lt;string, unknown&gt;;\n+     if (typeof candidate.fileId === \&quot;string\&quot; &amp;&amp; typeof candidate.fileName === \&quot;string\&quot;) {\n+       return {\n+         fileId: candidate.fileId,\n+         fileName: candidate.fileName,\n+         mimeType: typeof candidate.mimeType === \&quot;string\&quot; ? candidate.mimeType : undefined,\n+         fileSize:\n+           typeof candidate.fileSize === \&quot;number\&quot;\n+             ? candidate.fileSize\n+             : typeof candidate.fileSize === \&quot;string\&quot;\n+             ? Number(candidate.fileSize)\n+             : undefined,\n+         documentTypeKey:\n+           typeof candidate.documentTypeKey === \&quot;string\&quot;\n+             ? candidate.documentTypeKey\n+             : undefined,\n+         uploadedAt:\n+           typeof candidate.uploadedAt === \&quot;string\&quot; ? candidate.uploadedAt : undefined,\n+       };\n+     }\n+   }\n+   return null;\n+ }\n+ \n+ const humanFileSize = (size?: number) =&gt; {\n+   if (!size || Number.isNaN(size)) {\n+     return null;\n+   }\n+   if (size &lt; 1024) return &#96;${size} B&#96;;\n+   if (size &lt; 1024 * 1024) return &#96;${(size / 1024).toFixed(1)} KB&#96;;\n+   if (size &lt; 1024 * 1024 * 1024) return &#96;${(size / (1024 * 1024)).toFixed(1)} MB&#96;;\n+   return &#96;${(size / (1024 * 1024 * 1024)).toFixed(1)} GB&#96;;\n+ };\n+ \n+ async function parseError(response: Response) {\n+   try {\n+     const body = await response.json();\n+     return body?.error ?? body?.message ?? response.statusText;\n+   } catch {\n+     return response.statusText;\n+   }\n+ }\n+ \n+ export function FieldDocumentUpload({\n+   field,\n+   value,\n+   onChange,\n+   applicationId,\n+   onBlur,\n+   error,\n+   disabled,\n+   touched = true,\n+ }: FieldDocumentUploadProps) {\n+   const [status, setStatus] = useState&lt;\&quot;idle\&quot; | \&quot;signing\&quot; | \&quot;uploading\&quot; | \&quot;saving\&quot; | \&quot;error\&quot;&gt;(\n+     \&quot;idle\&quot;\n+   );\n+   const [statusMessage, setStatusMessage] = useState(\&quot;\&quot;);\n+   const [uploadError, setUploadError] = useState&lt;string | null&gt;(null);\n+   const fileInputRef = useRef&lt;HTMLInputElement&gt;(null);\n+ \n+   const documentTypeKey = getDocumentTypeKey(field.options);\n+   const existingValue = useMemo(() =&gt; normalizeDocumentValue(value), [value]);\n+   const canUpload = Boolean(applicationId &amp;&amp; documentTypeKey &amp;&amp; !disabled);\n+   const isBusy = status === \&quot;signing\&quot; || status === \&quot;uploading\&quot; || status === \&quot;saving\&quot;;\n+ \n+   const resetInput = () =&gt; {\n+     if (fileInputRef.current) {\n+       fileInputRef.current.value = \&quot;\&quot;;\n+     }\n+   };\n+ \n+   const handleFileChange = async (event: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {\n+     const file = event.target.files?.[0];\n+     if (!file) return;\n+ \n+     if (!applicationId) {\n+       setUploadError(\&quot;Save your progress to create an application before uploading.\&quot;);\n+       resetInput();\n+       return;\n+     }\n+     if (!documentTypeKey) {\n+       setUploadError(\&quot;This field is missing a document type. Ask an admin to configure it.\&quot;);\n+       resetInput();\n+       return;\n+     }\n+ \n+     try {\n+       setUploadError(null);\n+       setStatus(\&quot;signing\&quot;);\n+       setStatusMessage(\&quot;Requesting upload URL…\&quot;);\n+       const signResponse = await fetch(\&quot;/api/documents/sign\&quot;, {\n+         method: \&quot;POST\&quot;,\n+         headers: { \&quot;Content-Type\&quot;: \&quot;application/json\&quot; },\n+         body: JSON.stringify({\n+           applicationId,\n+           fileName: file.name,\n+           mimeType: file.type,\n+           fileSize: file.size,\n+         }),\n+       });\n+       if (!signResponse.ok) {\n+         throw new Error(await parseError(signResponse));\n+       }\n+       const { uploadUrl, fileId } = await signResponse.json();\n+ \n+       if (!fileId) {\n+         throw new Error(\&quot;Upload session did not return a file identifier.\&quot;);\n+       }\n+ \n+       if (uploadUrl) {\n+         setStatus(\&quot;uploading\&quot;);\n+         setStatusMessage(\&quot;Uploading file…\&quot;);\n+         try {\n+           await fetch(uploadUrl, {\n+             method: \&quot;PUT\&quot;,\n+             body: file,\n+             headers: {\n+               \&quot;Content-Type\&quot;: file.type || \&quot;application/octet-stream\&quot;,\n+             },\n+           });\n+         } catch (storageError) {\n+           console.warn(\&quot;Upload to external storage failed in preview environment:\&quot;, storageError);\n+         }\n+       }\n+ \n+       setStatus(\&quot;saving\&quot;);\n+       setStatusMessage(\&quot;Saving document metadata…\&quot;);\n+       const saveResponse = await fetch(\&quot;/api/documents\&quot;, {\n+         method: \&quot;POST\&quot;,\n+         headers: { \&quot;Content-Type\&quot;: \&quot;application/json\&quot; },\n+         body: JSON.stringify({\n+           applicationId,\n+           documentTypeKey,\n+           fileId,\n+           fileName: file.name,\n+           mimeType: file.type,\n+           fileSize: file.size,\n+         }),\n+       });\n+       if (!saveResponse.ok) {\n+         throw new Error(await parseError(saveResponse));\n+       }\n+ \n+       const nextValue: DocumentFieldValue = {\n+         fileId,\n+         fileName: file.name,\n+         mimeType: file.type,\n+         fileSize: file.size,\n+         documentTypeKey,\n+         uploadedAt: new Date().toISOString(),\n+       };\n+       onChange(nextValue);\n+       onBlur?.();\n+       setStatus(\&quot;idle\&quot;);\n+       setStatusMessage(\&quot;Upload complete\&quot;);\n+     } catch (err) {\n+       setStatus(\&quot;error\&quot;);\n+       setUploadError(err instanceof Error ? err.message : \&quot;Upload failed\&quot;);\n+     } finally {\n+       resetInput();\n+     }\n+   };\n+ \n+   const handleRemove = () =&gt; {\n+     onChange(null);\n+     setUploadError(null);\n+     setStatus(\&quot;idle\&quot;);\n+     setStatusMessage(\&quot;\&quot;);\n+     resetInput();\n+     onBlur?.();\n+   };\n+ \n+   return (\n+     &lt;FieldWrapper field={field} error={error} touched={touched}&gt;\n+       &lt;div className=\&quot;space-y-3\&quot;&gt;\n+         &lt;div className=\&quot;flex flex-wrap items-center gap-2 text-xs text-muted-foreground\&quot;&gt;\n+           {documentTypeKey ? (\n+             &lt;&gt;\n+               &lt;Badge variant=\&quot;secondary\&quot;&gt;{documentTypeKey}&lt;/Badge&gt;\n+               &lt;span&gt;Uploads link directly to this document type.&lt;/span&gt;\n+             &lt;/&gt;\n+           ) : (\n+             &lt;span className=\&quot;text-amber-600\&quot;&gt;\n+               Document type not configured. Uploads are disabled for this field.\n+             &lt;/span&gt;\n+           )}\n+         &lt;/div&gt;\n+ \n+         &lt;input\n+           ref={fileInputRef}\n+           type=\&quot;file\&quot;\n+           id={&#96;field-${field.id}&#96;}\n+           aria-describedby={\n+             field.helpText ? &#96;field-${field.id}-help&#96; : undefined\n+           }\n+           aria-invalid={Boolean(error)}\n+           aria-required={field.required}\n+           disabled={!canUpload || isBusy}\n+           onChange={handleFileChange}\n+           onBlur={onBlur}\n+           className=\&quot;block w-full text-sm text-muted-foreground file:mr-3 file:rounded-md file:border-0 file:bg-secondary file:px-4 file:py-2 file:text-sm file:font-medium file:text-secondary-foreground file:transition-colors file:hover:bg-secondary/80 disabled:cursor-not-allowed\&quot;\n+         /&gt;\n+         {!applicationId &amp;&amp; (\n+           &lt;p className=\&quot;text-xs text-amber-600\&quot;&gt;\n+             Save the form once to generate an application before uploading documents.\n+           &lt;/p&gt;\n+         )}\n+         {uploadError &amp;&amp; (\n+           &lt;p className=\&quot;text-sm text-destructive\&quot; role=\&quot;alert\&quot;&gt;\n+             {uploadError}\n+           &lt;/p&gt;\n+         )}\n+         {statusMessage &amp;&amp; !uploadError &amp;&amp; (\n+           &lt;p className=\&quot;text-xs text-muted-foreground\&quot;&gt;{statusMessage}&lt;/p&gt;\n+         )}\n+ \n+         {existingValue ? (\n+           &lt;div className=\&quot;rounded-lg border border-border/60 bg-muted/30 p-3 text-sm\&quot;&gt;\n+             &lt;p className=\&quot;font-medium text-foreground\&quot;&gt;{existingValue.fileName}&lt;/p&gt;\n+             &lt;p className=\&quot;text-xs text-muted-foreground\&quot;&gt;\n+               {humanFileSize(existingValue.fileSize) ?? \&quot;Unknown size\&quot;}\n+               {\&quot; • \&quot;}\n+               Uploaded{\&quot; \&quot;}\n+               {existingValue.uploadedAt\n+                 ? &#96;${DATE_FORMATTER.format(new Date(existingValue.uploadedAt))} UTC&#96;\n+                 : \&quot;recently\&quot;}\n+             &lt;/p&gt;\n+             &lt;div className=\&quot;mt-2 flex flex-wrap gap-2\&quot;&gt;\n+               &lt;Button\n+                 type=\&quot;button\&quot;\n+                 variant=\&quot;secondary\&quot;\n+                 size=\&quot;sm\&quot;\n+                 onClick={handleRemove}\n+                 disabled={disabled || isBusy}\n+               &gt;\n+                 Remove file\n+               &lt;/Button&gt;\n+             &lt;/div&gt;\n+           &lt;/div&gt;\n+         ) : (\n+           &lt;p className=\&quot;text-xs text-muted-foreground\&quot;&gt;\n+             No document uploaded yet. Accepted formats depend on your storage rules.\n+           &lt;/p&gt;\n+         )}\n+       &lt;/div&gt;\n+     &lt;/FieldWrapper&gt;\n+   );\n+ }\n+ &quot;,
        &quot;oldStart&quot;: 1,
        &quot;newStart&quot;: 1,
        &quot;oldLines&quot;: 1,
        &quot;newLines&quot;: 299,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 299
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/forms/field-document-upload.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useMemo, useRef, useState } from \&quot;react\&quot;;\nimport type { FormField } from \&quot;@prisma/client\&quot;;\nimport { Button } from \&quot;@/components/ui/button\&quot;;\nimport { Badge } from \&quot;@/components/ui/badge\&quot;;\nimport { FieldWrapper } from \&quot;./field-wrapper\&quot;;\n\nexport interface DocumentFieldValue {\n  fileId: string;\n  fileName: string;\n  mimeType?: string;\n  fileSize?: number;\n  documentTypeKey?: string;\n  uploadedAt?: string;\n}\n\ninterface FieldDocumentUploadProps {\n  field: FormField;\n  value: unknown;\n  onChange: (value: DocumentFieldValue | null) =&gt; void;\n  applicationId: string | null;\n  onBlur?: () =&gt; void;\n  error?: string;\n  disabled?: boolean;\n  touched?: boolean;\n}\n\nconst DATE_FORMATTER = new Intl.DateTimeFormat(\&quot;en-US\&quot;, {\n  dateStyle: \&quot;medium\&quot;,\n  timeStyle: \&quot;short\&quot;,\n  timeZone: \&quot;UTC\&quot;,\n});\n\nfunction getDocumentTypeKey(options: unknown): string {\n  if (options &amp;&amp; typeof options === \&quot;object\&quot;) {\n    const maybeKey = (options as { documentTypeKey?: unknown }).documentTypeKey;\n    if (typeof maybeKey === \&quot;string\&quot;) {\n      return maybeKey;\n    }\n  }\n  return \&quot;\&quot;;\n}\n\nfunction normalizeDocumentValue(value: unknown): DocumentFieldValue | null {\n  if (!value) return null;\n  if (Array.isArray(value)) {\n    return normalizeDocumentValue(value[0]);\n  }\n  if (typeof value === \&quot;object\&quot;) {\n    const candidate = value as Record&lt;string, unknown&gt;;\n    if (typeof candidate.fileId === \&quot;string\&quot; &amp;&amp; typeof candidate.fileName === \&quot;string\&quot;) {\n      return {\n        fileId: candidate.fileId,\n        fileName: candidate.fileName,\n        mimeType: typeof candidate.mimeType === \&quot;string\&quot; ? candidate.mimeType : undefined,\n        fileSize:\n          typeof candidate.fileSize === \&quot;number\&quot;\n            ? candidate.fileSize\n            : typeof candidate.fileSize === \&quot;string\&quot;\n            ? Number(candidate.fileSize)\n            : undefined,\n        documentTypeKey:\n          typeof candidate.documentTypeKey === \&quot;string\&quot;\n            ? candidate.documentTypeKey\n            : undefined,\n        uploadedAt:\n          typeof candidate.uploadedAt === \&quot;string\&quot; ? candidate.uploadedAt : undefined,\n      };\n    }\n  }\n  return null;\n}\n\nconst humanFileSize = (size?: number) =&gt; {\n  if (!size || Number.isNaN(size)) {\n    return null;\n  }\n  if (size &lt; 1024) return &#96;${size} B&#96;;\n  if (size &lt; 1024 * 1024) return &#96;${(size / 1024).toFixed(1)} KB&#96;;\n  if (size &lt; 1024 * 1024 * 1024) return &#96;${(size / (1024 * 1024)).toFixed(1)} MB&#96;;\n  return &#96;${(size / (1024 * 1024 * 1024)).toFixed(1)} GB&#96;;\n};\n\nasync function parseError(response: Response) {\n  try {\n    const body = await response.json();\n    return body?.error ?? body?.message ?? response.statusText;\n  } catch {\n    return response.statusText;\n  }\n}\n\nexport function FieldDocumentUpload({\n  field,\n  value,\n  onChange,\n  applicationId,\n  onBlur,\n  error,\n  disabled,\n  touched = true,\n}: FieldDocumentUploadProps) {\n  const [status, setStatus] = useState&lt;\&quot;idle\&quot; | \&quot;signing\&quot; | \&quot;uploading\&quot; | \&quot;saving\&quot; | \&quot;error\&quot;&gt;(\n    \&quot;idle\&quot;\n  );\n  const [statusMessage, setStatusMessage] = useState(\&quot;\&quot;);\n  const [uploadError, setUploadError] = useState&lt;string | null&gt;(null);\n  const fileInputRef = useRef&lt;HTMLInputElement&gt;(null);\n\n  const documentTypeKey = getDocumentTypeKey(field.options);\n  const existingValue = useMemo(() =&gt; normalizeDocumentValue(value), [value]);\n  const canUpload = Boolean(applicationId &amp;&amp; documentTypeKey &amp;&amp; !disabled);\n  const isBusy = status === \&quot;signing\&quot; || status === \&quot;uploading\&quot; || status === \&quot;saving\&quot;;\n\n  const resetInput = () =&gt; {\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \&quot;\&quot;;\n    }\n  };\n\n  const handleFileChange = async (event: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    if (!applicationId) {\n      setUploadError(\&quot;Save your progress to create an application before uploading.\&quot;);\n      resetInput();\n      return;\n    }\n    if (!documentTypeKey) {\n      setUploadError(\&quot;This field is missing a document type. Ask an admin to configure it.\&quot;);\n      resetInput();\n      return;\n    }\n\n    try {\n      setUploadError(null);\n      setStatus(\&quot;signing\&quot;);\n      setStatusMessage(\&quot;Requesting upload URL…\&quot;);\n      const signResponse = await fetch(\&quot;/api/documents/sign\&quot;, {\n        method: \&quot;POST\&quot;,\n        headers: { \&quot;Content-Type\&quot;: \&quot;application/json\&quot; },\n        body: JSON.stringify({\n          applicationId,\n          fileName: file.name,\n          mimeType: file.type,\n          fileSize: file.size,\n        }),\n      });\n      if (!signResponse.ok) {\n        throw new Error(await parseError(signResponse));\n      }\n      const { uploadUrl, fileId } = await signResponse.json();\n\n      if (!fileId) {\n        throw new Error(\&quot;Upload session did not return a file identifier.\&quot;);\n      }\n\n      if (uploadUrl) {\n        setStatus(\&quot;uploading\&quot;);\n        setStatusMessage(\&quot;Uploading file…\&quot;);\n        try {\n          await fetch(uploadUrl, {\n            method: \&quot;PUT\&quot;,\n            body: file,\n            headers: {\n              \&quot;Content-Type\&quot;: file.type || \&quot;application/octet-stream\&quot;,\n            },\n          });\n        } catch (storageError) {\n          console.warn(\&quot;Upload to external storage failed in preview environment:\&quot;, storageError);\n        }\n      }\n\n      setStatus(\&quot;saving\&quot;);\n      setStatusMessage(\&quot;Saving document metadata…\&quot;);\n      const saveResponse = await fetch(\&quot;/api/documents\&quot;, {\n        method: \&quot;POST\&quot;,\n        headers: { \&quot;Content-Type\&quot;: \&quot;application/json\&quot; },\n        body: JSON.stringify({\n          applicationId,\n          documentTypeKey,\n          fileId,\n          fileName: file.name,\n          mimeType: file.type,\n          fileSize: file.size,\n        }),\n      });\n      if (!saveResponse.ok) {\n        throw new Error(await parseError(saveResponse));\n      }\n\n      const nextValue: DocumentFieldValue = {\n        fileId,\n        fileName: file.name,\n        mimeType: file.type,\n        fileSize: file.size,\n        documentTypeKey,\n        uploadedAt: new Date().toISOString(),\n      };\n      onChange(nextValue);\n      onBlur?.();\n      setStatus(\&quot;idle\&quot;);\n      setStatusMessage(\&quot;Upload complete\&quot;);\n    } catch (err) {\n      setStatus(\&quot;error\&quot;);\n      setUploadError(err instanceof Error ? err.message : \&quot;Upload failed\&quot;);\n    } finally {\n      resetInput();\n    }\n  };\n\n  const handleRemove = () =&gt; {\n    onChange(null);\n    setUploadError(null);\n    setStatus(\&quot;idle\&quot;);\n    setStatusMessage(\&quot;\&quot;);\n    resetInput();\n    onBlur?.();\n  };\n\n  return (\n    &lt;FieldWrapper field={field} error={error} touched={touched}&gt;\n      &lt;div className=\&quot;space-y-3\&quot;&gt;\n        &lt;div className=\&quot;flex flex-wrap items-center gap-2 text-xs text-muted-foreground\&quot;&gt;\n          {documentTypeKey ? (\n            &lt;&gt;\n              &lt;Badge variant=\&quot;secondary\&quot;&gt;{documentTypeKey}&lt;/Badge&gt;\n              &lt;span&gt;Uploads link directly to this document type.&lt;/span&gt;\n            &lt;/&gt;\n          ) : (\n            &lt;span className=\&quot;text-amber-600\&quot;&gt;\n              Document type not configured. Uploads are disabled for this field.\n            &lt;/span&gt;\n          )}\n        &lt;/div&gt;\n\n        &lt;input\n          ref={fileInputRef}\n          type=\&quot;file\&quot;\n          id={&#96;field-${field.id}&#96;}\n          aria-describedby={\n            field.helpText ? &#96;field-${field.id}-help&#96; : undefined\n          }\n          aria-invalid={Boolean(error)}\n          aria-required={field.required}\n          disabled={!canUpload || isBusy}\n          onChange={handleFileChange}\n          onBlur={onBlur}\n          className=\&quot;block w-full text-sm text-muted-foreground file:mr-3 file:rounded-md file:border-0 file:bg-secondary file:px-4 file:py-2 file:text-sm file:font-medium file:text-secondary-foreground file:transition-colors file:hover:bg-secondary/80 disabled:cursor-not-allowed\&quot;\n        /&gt;\n        {!applicationId &amp;&amp; (\n          &lt;p className=\&quot;text-xs text-amber-600\&quot;&gt;\n            Save the form once to generate an application before uploading documents.\n          &lt;/p&gt;\n        )}\n        {uploadError &amp;&amp; (\n          &lt;p className=\&quot;text-sm text-destructive\&quot; role=\&quot;alert\&quot;&gt;\n            {uploadError}\n          &lt;/p&gt;\n        )}\n        {statusMessage &amp;&amp; !uploadError &amp;&amp; (\n          &lt;p className=\&quot;text-xs text-muted-foreground\&quot;&gt;{statusMessage}&lt;/p&gt;\n        )}\n\n        {existingValue ? (\n          &lt;div className=\&quot;rounded-lg border border-border/60 bg-muted/30 p-3 text-sm\&quot;&gt;\n            &lt;p className=\&quot;font-medium text-foreground\&quot;&gt;{existingValue.fileName}&lt;/p&gt;\n            &lt;p className=\&quot;text-xs text-muted-foreground\&quot;&gt;\n              {humanFileSize(existingValue.fileSize) ?? \&quot;Unknown size\&quot;}\n              {\&quot; • \&quot;}\n              Uploaded{\&quot; \&quot;}\n              {existingValue.uploadedAt\n                ? &#96;${DATE_FORMATTER.format(new Date(existingValue.uploadedAt))} UTC&#96;\n                : \&quot;recently\&quot;}\n            &lt;/p&gt;\n            &lt;div className=\&quot;mt-2 flex flex-wrap gap-2\&quot;&gt;\n              &lt;Button\n                type=\&quot;button\&quot;\n                variant=\&quot;secondary\&quot;\n                size=\&quot;sm\&quot;\n                onClick={handleRemove}\n                disabled={disabled || isBusy}\n              &gt;\n                Remove file\n              &lt;/Button&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        ) : (\n          &lt;p className=\&quot;text-xs text-muted-foreground\&quot;&gt;\n            No document uploaded yet. Accepted formats depend on your storage rules.\n          &lt;/p&gt;\n        )}\n      &lt;/div&gt;\n    &lt;/FieldWrapper&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating FormFieldRenderer component**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-field-renderer.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating component imports and props**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/forms/form-field-renderer.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;7a414f14-825e-4f19-9d15-5da366298071&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;  import { FieldInputRadio } from \&quot;./field-input-radio\&quot;;\n  import { FieldInputDate } from \&quot;./field-input-date\&quot;;\n+ import { FieldDocumentUpload, type DocumentFieldValue } from \&quot;./field-document-upload\&quot;;\n  \n  interface FormFieldRendererProps {&quot;,
        &quot;oldStart&quot;: 13,
        &quot;newStart&quot;: 13,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;    touched?: boolean;\n    isVisible?: boolean;\n+   applicationId?: string | null;\n  }\n  &quot;,
        &quot;oldStart&quot;: 23,
        &quot;newStart&quot;: 24,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;    touched = true,\n    isVisible = true,\n+   applicationId = null,\n  }: FormFieldRendererProps) {\n    if (!isVisible) {&quot;,
        &quot;oldStart&quot;: 38,
        &quot;newStart&quot;: 40,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;        );\n  \n+     case \&quot;document\&quot;:\n+       return (\n+         &lt;FieldDocumentUpload\n+           field={field}\n+           value={value as DocumentFieldValue | null}\n+           onChange={(val) =&gt; onChange(val)}\n+           onBlur={onBlur}\n+           error={error}\n+           disabled={disabled}\n+           touched={touched}\n+           applicationId={applicationId}\n+         /&gt;\n+       );\n+ \n      default:\n        console.warn(&#96;Unknown field type: ${field.type}&#96;);&quot;,
        &quot;oldStart&quot;: 176,
        &quot;newStart&quot;: 179,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 18,
        &quot;linesAdded&quot;: 14
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-field-renderer.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport * as React from \&quot;react\&quot;;\nimport type { FormField } from \&quot;@prisma/client\&quot;;\nimport { FieldInputText } from \&quot;./field-input-text\&quot;;\nimport { FieldInputEmail } from \&quot;./field-input-email\&quot;;\nimport { FieldInputNumber } from \&quot;./field-input-number\&quot;;\nimport { FieldInputTel } from \&quot;./field-input-tel\&quot;;\nimport { FieldTextarea } from \&quot;./field-textarea\&quot;;\nimport { FieldInputSelect } from \&quot;./field-input-select\&quot;;\nimport { FieldInputMultiSelect } from \&quot;./field-input-multi-select\&quot;;\nimport { FieldInputCheckbox } from \&quot;./field-input-checkbox\&quot;;\nimport { FieldInputRadio } from \&quot;./field-input-radio\&quot;;\nimport { FieldInputDate } from \&quot;./field-input-date\&quot;;\nimport { FieldDocumentUpload, type DocumentFieldValue } from \&quot;./field-document-upload\&quot;;\n\ninterface FormFieldRendererProps {\n  field: FormField;\n  value: unknown;\n  onChange: (value: unknown) =&gt; void;\n  onBlur?: () =&gt; void;\n  error?: string;\n  disabled?: boolean;\n  touched?: boolean;\n  isVisible?: boolean;\n  applicationId?: string | null;\n}\n\n/**\n * Main field renderer component that switches on field type\n * to render the appropriate field component.\n */\nexport function FormFieldRenderer({\n  field,\n  value,\n  onChange,\n  onBlur,\n  error,\n  disabled,\n  touched = true,\n  isVisible = true,\n  applicationId = null,\n}: FormFieldRendererProps) {\n  if (!isVisible) {\n    return null;\n  }\n\n  // Handle different field types\n  switch (field.type) {\n    case \&quot;text\&quot;:\n      return (\n        &lt;FieldInputText\n          field={field}\n          value={value as string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;email\&quot;:\n      return (\n        &lt;FieldInputEmail\n          field={field}\n          value={value as string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;number\&quot;:\n      return (\n        &lt;FieldInputNumber\n          field={field}\n          value={value as number | string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;tel\&quot;:\n      return (\n        &lt;FieldInputTel\n          field={field}\n          value={value as string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;textarea\&quot;:\n      return (\n        &lt;FieldTextarea\n          field={field}\n          value={value as string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;select\&quot;:\n      return (\n        &lt;FieldInputSelect\n          field={field}\n          value={value as string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;multi-select\&quot;:\n      return (\n        &lt;FieldInputMultiSelect\n          field={field}\n          value={value as string[]}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;checkbox\&quot;:\n    case \&quot;boolean\&quot;:\n      return (\n        &lt;FieldInputCheckbox\n          field={field}\n          value={value as boolean}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;radio\&quot;:\n      return (\n        &lt;FieldInputRadio\n          field={field}\n          value={value as string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;date\&quot;:\n      return (\n        &lt;FieldInputDate\n          field={field}\n          value={value as string}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n        /&gt;\n      );\n\n    case \&quot;document\&quot;:\n      return (\n        &lt;FieldDocumentUpload\n          field={field}\n          value={value as DocumentFieldValue | null}\n          onChange={(val) =&gt; onChange(val)}\n          onBlur={onBlur}\n          error={error}\n          disabled={disabled}\n          touched={touched}\n          applicationId={applicationId}\n        /&gt;\n      );\n\n    default:\n      console.warn(&#96;Unknown field type: ${field.type}&#96;);\n      return (\n        &lt;div className=\&quot;rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive\&quot;&gt;\n          Unknown field type: {field.type}\n        &lt;/div&gt;\n      );\n  }\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating FormStep for new type**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/forms/form-step.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;11f89ba2-6a46-430d-9b4b-e92a4fd9995e&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    onFieldChange: (fieldKey: string, value: unknown) =&gt; void;\n    onFieldBlur: (fieldKey: string) =&gt; void;\n+   applicationId: string | null;\n  }\n  &quot;,
        &quot;oldStart&quot;: 13,
        &quot;newStart&quot;: 13,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;    onFieldChange,\n    onFieldBlur,\n+   applicationId,\n  }: FormStepProps) {\n    const sortedFields = [...section.fields].sort((a, b) =&gt; a.order - b.order);&quot;,
        &quot;oldStart&quot;: 23,
        &quot;newStart&quot;: 24,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;              const error = errors[field.key];\n              const isTouched = touched[field.key] ?? false;\n-             const shouldSpanFullWidth = [\&quot;textarea\&quot;, \&quot;multi-select\&quot;, \&quot;checkbox\&quot;, \&quot;radio\&quot;].includes(field.type);\n+             const shouldSpanFullWidth = [\&quot;textarea\&quot;, \&quot;multi-select\&quot;, \&quot;checkbox\&quot;, \&quot;radio\&quot;, \&quot;document\&quot;].includes(field.type);\n  \n              return (&quot;,
        &quot;oldStart&quot;: 54,
        &quot;newStart&quot;: 56,
        &quot;oldLines&quot;: 5,
        &quot;newLines&quot;: 5,
        &quot;linesRemoved&quot;: 1,
        &quot;linesAdded&quot;: 1
      },
      {
        &quot;diffString&quot;: &quot;                    touched={isTouched}\n                    isVisible={isVisible}\n+                   applicationId={applicationId}\n                  /&gt;\n                &lt;/div&gt;&quot;,
        &quot;oldStart&quot;: 72,
        &quot;newStart&quot;: 74,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-step.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport type { FormSection, FormField } from \&quot;@prisma/client\&quot;;\nimport { cn } from \&quot;@/lib/utils\&quot;;\nimport { FormFieldRenderer } from \&quot;./form-field-renderer\&quot;;\n\ninterface FormStepProps {\n  section: FormSection &amp; { fields: FormField[] };\n  formData: Record&lt;string, unknown&gt;;\n  errors: Record&lt;string, string&gt;;\n  touched: Record&lt;string, boolean&gt;;\n  visibilityMap?: Record&lt;string, boolean&gt;;\n  onFieldChange: (fieldKey: string, value: unknown) =&gt; void;\n  onFieldBlur: (fieldKey: string) =&gt; void;\n  applicationId: string | null;\n}\n\nexport function FormStep({\n  section,\n  formData,\n  errors,\n  touched,\n  visibilityMap,\n  onFieldChange,\n  onFieldBlur,\n  applicationId,\n}: FormStepProps) {\n  const sortedFields = [...section.fields].sort((a, b) =&gt; a.order - b.order);\n  const sectionLabelId = &#96;section-${section.id}-label&#96;;\n\n  return (\n    &lt;section className=\&quot;space-y-6\&quot; aria-labelledby={sectionLabelId}&gt;\n      &lt;div className=\&quot;space-y-2\&quot;&gt;\n        &lt;h2 id={sectionLabelId} className=\&quot;text-2xl font-semibold\&quot;&gt;\n          {section.label}\n        &lt;/h2&gt;\n        {section.fields.length === 0 &amp;&amp; (\n          &lt;p className=\&quot;text-sm text-muted-foreground\&quot;&gt;\n            No fields in this section.\n          &lt;/p&gt;\n        )}\n      &lt;/div&gt;\n      {sortedFields.length &gt; 0 &amp;&amp; (\n        &lt;div\n          className=\&quot;grid gap-6 sm:grid-cols-2\&quot;\n          role=\&quot;group\&quot;\n          aria-labelledby={sectionLabelId}\n        &gt;\n          {sortedFields.map((field) =&gt; {\n            const isVisible = visibilityMap?.[field.key] ?? true;\n            if (!isVisible) {\n              return null;\n            }\n\n            const value = formData[field.key];\n            const error = errors[field.key];\n            const isTouched = touched[field.key] ?? false;\n            const shouldSpanFullWidth = [\&quot;textarea\&quot;, \&quot;multi-select\&quot;, \&quot;checkbox\&quot;, \&quot;radio\&quot;, \&quot;document\&quot;].includes(field.type);\n\n            return (\n              &lt;div\n                key={field.id}\n                className={cn(\n                  \&quot;flex flex-col gap-2\&quot;,\n                  shouldSpanFullWidth ? \&quot;sm:col-span-2\&quot; : \&quot;sm:col-span-1\&quot;\n                )}\n              &gt;\n                &lt;FormFieldRenderer\n                  field={field}\n                  value={value}\n                  onChange={(newValue) =&gt; onFieldChange(field.key, newValue)}\n                  onBlur={() =&gt; onFieldBlur(field.key)}\n                  error={isTouched ? error : undefined}\n                  touched={isTouched}\n                  isVisible={isVisible}\n                  applicationId={applicationId}\n                /&gt;\n              &lt;/div&gt;\n            );\n          })}\n        &lt;/div&gt;\n      )}\n    &lt;/section&gt;\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating applicationId prop passing**</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/components/forms/dynamic-form-wizard.tsx&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;7650a0b7-3b26-4288-b110-77ec27b9831f&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;              onFieldChange={handleFieldChange}\n              onFieldBlur={handleFieldBlur}\n+             applicationId={applicationId}\n            /&gt;\n          )}&quot;,
        &quot;oldStart&quot;: 429,
        &quot;newStart&quot;: 429,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 5,
        &quot;linesAdded&quot;: 1
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/components/forms/dynamic-form-wizard.tsx&quot;,
  &quot;contentsAfterEdit&quot;: &quot;\&quot;use client\&quot;;\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from \&quot;react\&quot;;\nimport type { FormConfigWithFields } from \&quot;@/lib/forms/types\&quot;;\nimport { getStepFieldKeys } from \&quot;@/lib/forms/form-validator\&quot;;\nimport { buildFormSchema } from \&quot;@/lib/form-schema\&quot;;\nimport { saveFormDraft, type DraftSaveResult } from \&quot;@/app/forms/actions\&quot;;\nimport { StepIndicator } from \&quot;./step-indicator\&quot;;\nimport { FormStep } from \&quot;./form-step\&quot;;\nimport { FormNavigation } from \&quot;./form-navigation\&quot;;\nimport { FormErrorSummary } from \&quot;./form-error-summary\&quot;;\nimport { useFormState } from \&quot;@/hooks/use-form-state\&quot;;\nimport { useAutosave } from \&quot;@/hooks/use-autosave\&quot;;\nimport { useToast } from \&quot;@/components/ui/use-toast\&quot;;\nimport { usePrefersReducedMotion } from \&quot;@/hooks/use-prefers-reduced-motion\&quot;;\nimport { cn } from \&quot;@/lib/utils\&quot;;\nimport { useFieldVisibility } from \&quot;@/hooks/use-field-visibility\&quot;;\n\ninterface DynamicFormWizardProps {\n  formConfig: FormConfigWithFields;\n  initialData?: Record&lt;string, unknown&gt;;\n  initialStep?: number;\n  applicationId: string | null;\n  organizationId: string;\n  onApplicationIdChange?: (applicationId: string) =&gt; void;\n  onDraftSaved?: (result: DraftSaveResult) =&gt; void;\n  onStepChange?: (stepIndex: number) =&gt; void;\n  onComplete?: (formData: Record&lt;string, unknown&gt;) =&gt; Promise&lt;void&gt; | void;\n}\n\nconst clampStep = (step: number, totalSteps: number) =&gt; {\n  if (totalSteps &lt;= 0) {\n    return 0;\n  }\n  return Math.max(0, Math.min(step, totalSteps - 1));\n};\n\nexport function DynamicFormWizard({\n  formConfig,\n  initialData = {},\n  initialStep = 0,\n  applicationId,\n  organizationId,\n  onApplicationIdChange,\n  onDraftSaved,\n  onStepChange,\n  onComplete,\n}: DynamicFormWizardProps) {\n  const sortedSections = useMemo(\n    () =&gt; [...formConfig.sections].sort((a, b) =&gt; a.order - b.order),\n    [formConfig.sections]\n  );\n\n  const allFields = useMemo(\n    () =&gt; sortedSections.flatMap((section) =&gt; section.fields),\n    [sortedSections]\n  );\n\n  const totalSteps = sortedSections.length;\n  const safeInitialStep = clampStep(initialStep ?? 0, totalSteps);\n\n  const {\n    state,\n    touchedMap,\n    setFieldValue,\n    markFieldTouched,\n    markFieldsTouched,\n    setFieldError,\n    setStepErrors,\n    goToStep,\n    markStepComplete,\n    setIsSubmitting,\n    markClean,\n    resetForm,\n    validateAndCommitStep,\n  } = useFormState({\n    formConfig,\n    initialData,\n    initialStep: safeInitialStep,\n  });\n\n  const [liveMessage, setLiveMessage] = useState(\&quot;\&quot;);\n  const validationTimersRef = useRef&lt;Record&lt;string, NodeJS.Timeout&gt;&gt;({});\n  const formSchemaRef = useRef(buildFormSchema(formConfig));\n  const prefersReducedMotion = usePrefersReducedMotion();\n  const { toast } = useToast();\n  const initialSnapshotRef = useRef(\n    JSON.stringify({ data: initialData, step: safeInitialStep, applicationId })\n  );\n\n  const isFirstStep = state.currentStep === 0;\n  const isLastStep = state.currentStep === totalSteps - 1;\n  const currentSection = sortedSections[state.currentStep];\n  const visibilityMap = useFieldVisibility(allFields, state.formData);\n\n  useEffect(() =&gt; {\n    formSchemaRef.current = buildFormSchema(formConfig);\n  }, [formConfig]);\n\n  useEffect(() =&gt; {\n    const nextSnapshot = JSON.stringify({\n      data: initialData,\n      step: safeInitialStep,\n      applicationId,\n    });\n\n    if (nextSnapshot !== initialSnapshotRef.current) {\n      resetForm(initialData, safeInitialStep);\n      initialSnapshotRef.current = nextSnapshot;\n    }\n  }, [initialData, resetForm, safeInitialStep, applicationId]);\n\n  const focusFirstError = useCallback(\n    (fieldKey?: string) =&gt; {\n      if (!fieldKey || !currentSection) {\n        return;\n      }\n\n      const isVisible = visibilityMap[fieldKey] ?? true;\n      if (!isVisible) {\n        return;\n      }\n\n      const errorField = currentSection.fields.find((field) =&gt; field.key === fieldKey);\n      const fieldElement = errorField\n        ? document.getElementById(&#96;field-${errorField.id}&#96;)\n        : null;\n      fieldElement?.focus();\n      fieldElement?.scrollIntoView({ behavior: \&quot;smooth\&quot;, block: \&quot;center\&quot; });\n    },\n    [currentSection, visibilityMap]\n  );\n\n  const validateField = useCallback(\n    (fieldKey: string, value: unknown, immediate = false) =&gt; {\n      if (validationTimersRef.current[fieldKey]) {\n        clearTimeout(validationTimersRef.current[fieldKey]);\n      }\n\n      const performValidation = () =&gt; {\n        const fieldSchema = formSchemaRef.current.shape[fieldKey];\n        if (!fieldSchema) {\n          return;\n        }\n\n        try {\n          fieldSchema.parse(value);\n          setFieldError(fieldKey);\n        } catch (error) {\n          if (error &amp;&amp; typeof error === \&quot;object\&quot; &amp;&amp; \&quot;issues\&quot; in error) {\n            const zodError = error as { issues: Array&lt;{ message: string }&gt; };\n            const firstIssue = zodError.issues[0];\n            if (firstIssue) {\n              setFieldError(fieldKey, firstIssue.message);\n            }\n          } else if (error instanceof Error) {\n            setFieldError(fieldKey, error.message);\n          }\n        }\n      };\n\n      if (immediate) {\n        performValidation();\n      } else {\n        validationTimersRef.current[fieldKey] = setTimeout(performValidation, 300);\n      }\n    },\n    [setFieldError]\n  );\n\n  const handleFieldChange = useCallback(\n    (fieldKey: string, value: unknown) =&gt; {\n      setFieldValue(fieldKey, value);\n      if (state.touched.has(fieldKey)) {\n        validateField(fieldKey, value, false);\n      }\n    },\n    [setFieldValue, state.touched, validateField]\n  );\n\n  const handleFieldBlur = useCallback(\n    (fieldKey: string) =&gt; {\n      markFieldTouched(fieldKey);\n      validateField(fieldKey, state.formData[fieldKey], true);\n    },\n    [markFieldTouched, state.formData, validateField]\n  );\n\n  const autosaveFingerprint = useMemo(\n    () =&gt; JSON.stringify({ data: state.formData, step: state.currentStep }),\n    [state.formData, state.currentStep]\n  );\n\n  const runDraftSave = useCallback(() =&gt; {\n    return saveFormDraft({\n      formConfigId: formConfig.id,\n      organizationId,\n      entityId: formConfig.entityId,\n      geographyId: formConfig.geographyId,\n      applicationId,\n      formData: state.formData,\n      currentStep: state.currentStep,\n    });\n  }, [\n    applicationId,\n    formConfig.entityId,\n    formConfig.geographyId,\n    formConfig.id,\n    organizationId,\n    state.currentStep,\n    state.formData,\n  ]);\n\n  const {\n    status: draftStatus,\n    isSaving: isSavingDraft,\n    lastSavedAt,\n    error: draftError,\n    triggerSave,\n  } = useAutosave&lt;DraftSaveResult&gt;({\n    shouldAutosave: state.isDirty,\n    dataFingerprint: autosaveFingerprint,\n    save: runDraftSave,\n    onSuccess: (result) =&gt; {\n      markClean();\n      if (result.applicationId &amp;&amp; result.applicationId !== applicationId) {\n        onApplicationIdChange?.(result.applicationId);\n      }\n      onDraftSaved?.(result);\n    },\n    onError: (error) =&gt; {\n      toast({\n        variant: \&quot;destructive\&quot;,\n        title: \&quot;Draft save failed\&quot;,\n        description: error.message,\n      });\n    },\n  });\n\n  const handleNext = useCallback(async () =&gt; {\n    if (state.isSubmitting) {\n      return;\n    }\n\n    const validation = validateAndCommitStep(state.currentStep, {\n      visibilityMap,\n    });\n    if (!validation.isValid) {\n      toast({\n        variant: \&quot;destructive\&quot;,\n        title: \&quot;Please fix validation errors\&quot;,\n        description: \&quot;Resolve highlighted fields before continuing.\&quot;,\n      });\n      focusFirstError(validation.firstErrorField);\n      return;\n    }\n\n    markStepComplete(state.currentStep);\n\n    if (isLastStep &amp;&amp; onComplete) {\n      try {\n        setIsSubmitting(true);\n        await onComplete(state.formData);\n        toast({\n          title: \&quot;Form submitted\&quot;,\n          description: \&quot;Thank you! We received your information.\&quot;,\n        });\n      } catch (error) {\n        toast({\n          variant: \&quot;destructive\&quot;,\n          title: \&quot;Submission failed\&quot;,\n          description:\n            error instanceof Error\n              ? error.message\n              : \&quot;Something went wrong while submitting. Please try again.\&quot;,\n        });\n      } finally {\n        setIsSubmitting(false);\n      }\n      return;\n    }\n\n    const nextStep = clampStep(state.currentStep + 1, totalSteps);\n    goToStep(nextStep);\n    onStepChange?.(nextStep);\n    void triggerSave(\&quot;step-change\&quot;);\n  }, [\n    focusFirstError,\n    goToStep,\n    isLastStep,\n    markStepComplete,\n    onComplete,\n    onStepChange,\n    setIsSubmitting,\n    state.currentStep,\n    state.formData,\n    state.isSubmitting,\n    toast,\n    totalSteps,\n    triggerSave,\n    validateAndCommitStep,\n    visibilityMap,\n  ]);\n\n  const handlePrevious = useCallback(() =&gt; {\n    if (isFirstStep) {\n      return;\n    }\n    const prevStep = clampStep(state.currentStep - 1, totalSteps);\n    goToStep(prevStep);\n    onStepChange?.(prevStep);\n  }, [goToStep, isFirstStep, onStepChange, state.currentStep, totalSteps]);\n\n  const handleStepClick = useCallback(\n    (stepIndex: number) =&gt; {\n      if (stepIndex === state.currentStep) {\n        return;\n      }\n\n      const validation = validateAndCommitStep(state.currentStep, {\n        visibilityMap,\n      });\n      if (!validation.isValid) {\n        toast({\n          variant: \&quot;destructive\&quot;,\n          title: \&quot;Cannot leave step yet\&quot;,\n          description: \&quot;Fix validation errors before moving on.\&quot;,\n        });\n        focusFirstError(validation.firstErrorField);\n        return;\n      }\n\n      if (\n        state.completedSteps.has(stepIndex) ||\n        stepIndex === clampStep(state.currentStep + 1, totalSteps)\n      ) {\n        const nextStep = clampStep(stepIndex, totalSteps);\n        goToStep(nextStep);\n        onStepChange?.(nextStep);\n        void triggerSave(\&quot;step-change\&quot;);\n      }\n    },\n    [\n      focusFirstError,\n      goToStep,\n      onStepChange,\n      state.completedSteps,\n      state.currentStep,\n      toast,\n      totalSteps,\n      triggerSave,\n      validateAndCommitStep,\n      visibilityMap,\n    ]\n  );\n\n  const handleManualSave = useCallback(() =&gt; {\n    void triggerSave(\&quot;manual\&quot;);\n  }, [triggerSave]);\n\n  useEffect(() =&gt; {\n    const timers = validationTimersRef.current;\n    return () =&gt; {\n      Object.values(timers).forEach((timer) =&gt; {\n        clearTimeout(timer);\n      });\n    };\n  }, []);\n\n  useEffect(() =&gt; {\n    const sectionLabel = currentSection?.label ?? &#96;Step ${state.currentStep + 1}&#96;;\n    setLiveMessage(\n      &#96;Now viewing ${sectionLabel} (${state.currentStep + 1} of ${totalSteps})&#96;\n    );\n  }, [currentSection, state.currentStep, totalSteps]);\n\n  const progress =\n    totalSteps &gt; 0 ? ((state.currentStep + 1) / totalSteps) * 100 : 0;\n\n  return (\n    &lt;div className=\&quot;flex flex-col gap-6 pb-32 sm:pb-12\&quot;&gt;\n      &lt;StepIndicator\n        steps={sortedSections.map((section) =&gt; ({\n          id: section.id,\n          label: section.label,\n          order: section.order,\n        }))}\n        currentStep={state.currentStep}\n        completedSteps={state.completedSteps}\n        onStepClick={handleStepClick}\n      /&gt;\n\n      &lt;div\n        className={cn(\n          \&quot;min-h-[400px] space-y-6 rounded-3xl border border-border/60 bg-background/70 p-4 shadow-lg sm:p-8\&quot;,\n          !prefersReducedMotion &amp;&amp; \&quot;transition-shadow duration-300\&quot;\n        )}\n      &gt;\n        {(() =&gt; {\n          const stepFieldKeys = getStepFieldKeys(\n            state.currentStep,\n            formConfig\n          ).filter((fieldKey) =&gt; visibilityMap[fieldKey] ?? true);\n          const stepErrors: Record&lt;string, string&gt; = {};\n          stepFieldKeys.forEach((key) =&gt; {\n            if (state.errors[key] &amp;&amp; touchedMap[key]) {\n              stepErrors[key] = state.errors[key];\n            }\n          });\n\n          if (Object.keys(stepErrors).length &gt; 0) {\n            return (\n              &lt;FormErrorSummary\n                errors={stepErrors}\n                onErrorClick={(fieldKey) =&gt; focusFirstError(fieldKey)}\n              /&gt;\n            );\n          }\n          return null;\n        })()}\n\n        {currentSection &amp;&amp; (\n          &lt;FormStep\n            section={currentSection}\n            formData={state.formData}\n            errors={state.errors}\n            touched={touchedMap}\n            visibilityMap={visibilityMap}\n            onFieldChange={handleFieldChange}\n            onFieldBlur={handleFieldBlur}\n            applicationId={applicationId}\n          /&gt;\n        )}\n      &lt;/div&gt;\n\n      &lt;FormNavigation\n        isFirstStep={isFirstStep}\n        isLastStep={isLastStep}\n        onNext={handleNext}\n        onPrevious={handlePrevious}\n        onSaveDraft={handleManualSave}\n        progress={progress}\n        isSubmitting={state.isSubmitting}\n        isSavingDraft={isSavingDraft}\n        draftStatus={draftStatus}\n        draftError={draftError}\n        lastSavedAt={lastSavedAt}\n      /&gt;\n      &lt;p role=\&quot;status\&quot; aria-live=\&quot;polite\&quot; className=\&quot;sr-only\&quot;&gt;\n        {liveMessage}\n      &lt;/p&gt;\n    &lt;/div&gt;\n  );\n}\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Extending form schema for new field types**

I'm expanding the form schema builder to handle additional field types like multi-select, checkbox, document, tel, and radio. For radio buttons, I'll reuse the select schema logic to keep things simpler, and for document fields, I'll create a reusable object schema with optional file metadata. This approach keeps schema handling consistent while supporting the new input types.</details></think>

---

<tool-use data-tool-type="unknown" data-tool-name="apply_patch">
<details>
<summary>Tool use: **apply_patch**</summary>


Parameters:

```json
{
  &quot;relativeWorkspacePath&quot;: &quot;/Users/sahilmehta/supplier-onboarding-simple/lib/form-schema.ts&quot;
}
```
Additional data:

```json
{
  &quot;codeblockId&quot;: &quot;cfa7eb18-4394-4c7a-a6bf-b2717faa2c92&quot;
}
```
Result:

```json
{
  &quot;diff&quot;: {
    &quot;chunks&quot;: [
      {
        &quot;diffString&quot;: &quot;    return validatedSchema;\n  }\n+ \n+ const DOCUMENT_VALUE_SCHEMA = z.object({\n+   fileId: z.string(),\n+   fileName: z.string(),\n+   mimeType: z.string().optional(),\n+   fileSize: z.number().optional(),\n+   documentTypeKey: z.string().optional(),\n+   uploadedAt: z\n+     .string()\n+     .refine((value) =&gt; !value || !Number.isNaN(Date.parse(value)), {\n+       message: \&quot;Invalid upload timestamp\&quot;,\n+     })\n+     .optional(),\n+ });\n  \n  function fieldToSchema(field: FormField) {&quot;,
        &quot;oldStart&quot;: 101,
        &quot;newStart&quot;: 101,
        &quot;oldLines&quot;: 4,
        &quot;newLines&quot;: 18,
        &quot;linesAdded&quot;: 14
      },
      {
        &quot;diffString&quot;: &quot;        break;\n      case \&quot;select\&quot;:\n+     case \&quot;radio\&quot;:\n        const values = selectValues(field.options ?? undefined);\n        schema = values.length &gt; 0 ? z.enum(values as [string, ...string[]]) : z.string();\n        break;\n      case \&quot;boolean\&quot;:\n+     case \&quot;checkbox\&quot;:\n        schema = z.boolean();\n        break;\n+     case \&quot;multi-select\&quot;:\n+       schema = z.array(z.string());\n+       if (field.required) {\n+         schema = schema.min(1, &#96;${field.label} must include at least one selection&#96;);\n+       }\n+       break;\n      case \&quot;date\&quot;:\n        schema = z.string().refine((value) =&gt; !isNaN(Date.parse(value)), {\n          message: \&quot;Invalid date\&quot;,\n        });\n        break;\n+     case \&quot;document\&quot;:\n+       schema = DOCUMENT_VALUE_SCHEMA;\n+       break;\n      case \&quot;email\&quot;:\n        schema = z.string().email(&#96;${field.label} must be a valid email address&#96;);\n        break;\n+     case \&quot;tel\&quot;:\n+       schema = z\n+         .string()\n+         .regex(/^[\\d\\-\\s()+.]+$/, &#96;${field.label} must be a valid phone number&#96;);\n+       break;\n      default:\n        schema = z.string();&quot;,
        &quot;oldStart&quot;: 110,
        &quot;newStart&quot;: 124,
        &quot;oldLines&quot;: 18,
        &quot;newLines&quot;: 34,
        &quot;linesAdded&quot;: 16
      }
    ],
    &quot;editor&quot;: &quot;EDITOR_AI&quot;
  },
  &quot;shouldAutoFixLints&quot;: true,
  &quot;resultForModel&quot;: &quot;Success. Updated the following files:\nM /Users/sahilmehta/supplier-onboarding-simple/lib/form-schema.ts&quot;,
  &quot;contentsAfterEdit&quot;: &quot;import { z } from \&quot;zod\&quot;;\nimport type { FormField } from \&quot;@prisma/client\&quot;;\nimport type { FormConfigWithFields } from \&quot;@/lib/forms/types\&quot;;\nexport type { FormConfigWithFields } from \&quot;@/lib/forms/types\&quot;;\n\n/**\n * Validation rules structure from FormField.validation JSON\n */\ninterface ValidationRules {\n  min?: number;\n  max?: number;\n  pattern?: string;\n  minLength?: number;\n  maxLength?: number;\n  customMessage?: string;\n}\n\nconst selectValues = (options?: unknown) =&gt; {\n  if (!options || typeof options !== \&quot;object\&quot;) return [];\n  if (\&quot;values\&quot; in (options as Record&lt;string, unknown&gt;)) {\n    const values = (options as Record&lt;string, unknown&gt;).values;\n    if (Array.isArray(values)) {\n      return values.filter(\n        (value): value is string =&gt; typeof value === \&quot;string\&quot;\n      );\n    }\n  }\n  return [];\n};\n\n/**\n * Parse validation rules from FormField.validation JSON\n */\nfunction parseValidationRules(field: FormField): ValidationRules | null {\n  if (!field.validation || typeof field.validation !== \&quot;object\&quot;) {\n    return null;\n  }\n  const validation = field.validation as Record&lt;string, unknown&gt;;\n  return {\n    min: typeof validation.min === \&quot;number\&quot; ? validation.min : undefined,\n    max: typeof validation.max === \&quot;number\&quot; ? validation.max : undefined,\n    pattern: typeof validation.pattern === \&quot;string\&quot; ? validation.pattern : undefined,\n    minLength: typeof validation.minLength === \&quot;number\&quot; ? validation.minLength : undefined,\n    maxLength: typeof validation.maxLength === \&quot;number\&quot; ? validation.maxLength : undefined,\n    customMessage: typeof validation.customMessage === \&quot;string\&quot; ? validation.customMessage : undefined,\n  };\n}\n\n/**\n * Apply validation rules to a Zod schema based on field type\n */\nfunction applyValidationRules(\n  schema: z.ZodTypeAny,\n  field: FormField,\n  rules: ValidationRules\n): z.ZodTypeAny {\n  let validatedSchema = schema;\n\n  // Apply type-specific validations\n  if (field.type === \&quot;number\&quot;) {\n    if (rules.min !== undefined) {\n      validatedSchema = (validatedSchema as z.ZodNumber).min(\n        rules.min,\n        rules.customMessage || &#96;${field.label} must be at least ${rules.min}&#96;\n      );\n    }\n    if (rules.max !== undefined) {\n      validatedSchema = (validatedSchema as z.ZodNumber).max(\n        rules.max,\n        rules.customMessage || &#96;${field.label} must be at most ${rules.max}&#96;\n      );\n    }\n  } else if (field.type === \&quot;text\&quot; || field.type === \&quot;email\&quot; || field.type === \&quot;tel\&quot; || field.type === \&quot;textarea\&quot;) {\n    // String validations\n    if (rules.minLength !== undefined) {\n      validatedSchema = (validatedSchema as z.ZodString).min(\n        rules.minLength,\n        rules.customMessage || &#96;${field.label} must be at least ${rules.minLength} characters&#96;\n      );\n    }\n    if (rules.maxLength !== undefined) {\n      validatedSchema = (validatedSchema as z.ZodString).max(\n        rules.maxLength,\n        rules.customMessage || &#96;${field.label} must be at most ${rules.maxLength} characters&#96;\n      );\n    }\n    if (rules.pattern) {\n      try {\n        const regex = new RegExp(rules.pattern);\n        validatedSchema = (validatedSchema as z.ZodString).regex(\n          regex,\n          rules.customMessage || &#96;${field.label} format is invalid&#96;\n        );\n      } catch (error) {\n        // Invalid regex pattern, skip pattern validation\n        console.warn(&#96;Invalid regex pattern for field ${field.key}: ${rules.pattern}&#96;);\n      }\n    }\n  }\n\n  return validatedSchema;\n}\n\nconst DOCUMENT_VALUE_SCHEMA = z.object({\n  fileId: z.string(),\n  fileName: z.string(),\n  mimeType: z.string().optional(),\n  fileSize: z.number().optional(),\n  documentTypeKey: z.string().optional(),\n  uploadedAt: z\n    .string()\n    .refine((value) =&gt; !value || !Number.isNaN(Date.parse(value)), {\n      message: \&quot;Invalid upload timestamp\&quot;,\n    })\n    .optional(),\n});\n\nfunction fieldToSchema(field: FormField) {\n  let schema: z.ZodTypeAny;\n\n  switch (field.type) {\n    case \&quot;number\&quot;:\n      schema = z.number();\n      break;\n    case \&quot;select\&quot;:\n    case \&quot;radio\&quot;:\n      const values = selectValues(field.options ?? undefined);\n      schema = values.length &gt; 0 ? z.enum(values as [string, ...string[]]) : z.string();\n      break;\n    case \&quot;boolean\&quot;:\n    case \&quot;checkbox\&quot;:\n      schema = z.boolean();\n      break;\n    case \&quot;multi-select\&quot;:\n      schema = z.array(z.string());\n      if (field.required) {\n        schema = schema.min(1, &#96;${field.label} must include at least one selection&#96;);\n      }\n      break;\n    case \&quot;date\&quot;:\n      schema = z.string().refine((value) =&gt; !isNaN(Date.parse(value)), {\n        message: \&quot;Invalid date\&quot;,\n      });\n      break;\n    case \&quot;document\&quot;:\n      schema = DOCUMENT_VALUE_SCHEMA;\n      break;\n    case \&quot;email\&quot;:\n      schema = z.string().email(&#96;${field.label} must be a valid email address&#96;);\n      break;\n    case \&quot;tel\&quot;:\n      schema = z\n        .string()\n        .regex(/^[\\d\\-\\s()+.]+$/, &#96;${field.label} must be a valid phone number&#96;);\n      break;\n    default:\n      schema = z.string();\n  }\n\n  // Apply custom validation rules\n  const validationRules = parseValidationRules(field);\n  if (validationRules) {\n    schema = applyValidationRules(schema, field, validationRules);\n  }\n\n  // Handle required/optional\n  if (field.required) {\n    return schema;\n  }\n  return schema.optional();\n}\n\nexport function buildFormSchema(config: FormConfigWithFields) {\n  const fields: Record&lt;string, z.ZodTypeAny&gt; = {};\n\n  config.sections.forEach((section) =&gt; {\n    section.fields.forEach((field) =&gt; {\n      fields[field.key] = fieldToSchema(field).describe(field.label);\n    });\n  });\n\n  return z.object(fields);\n}\n\nexport function describeFormSchema(config: FormConfigWithFields) {\n  return config.sections.flatMap((section) =&gt;\n    section.fields.map((field) =&gt; ({\n      section: section.label,\n      key: field.key,\n      label: field.label,\n      type: field.type,\n      required: field.required,\n    }))\n  );\n}\n\n&quot;
}
```
User decision: **accepted**

Status: **completed**


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Reviewing and finalizing form document integration**

I'm making sure the new 'document' field type is fully integrated—checking schema optionality, validation rules, component props, passing document types through dialogs and panels, and updating exports. I’m confirming imports like useMemo and Badge in upload components and ensuring error states and multi-select options work well. Next, I'll verify typings stay correct and plan to run linting across changed files to catch any TypeScript issues before testing.</details></think>

---

<tool-use data-tool-type="bash" data-tool-name="run_terminal_cmd">
<details><summary>Tool use: **command** • Run command: cd /Users/sahilmehta/supplier-onboarding-simple && npm run lint</summary>

```bash
cd /Users/sahilmehta/supplier-onboarding-simple && npm run lint
```

```
&gt; supplier-onboarding-simple@0.1.0 lint
&gt; eslint
```
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Updating TODO list statuses**</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] Review form field rendering and existing field components
- [x] Extend backend form definitions to support all renderer field types
- [x] Add document upload field: component, renderer, admin UI
- [x] Validate changes with lint/tests if applicable

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Summarizing code changes with file references**

I’m putting together a detailed summary of the modifications, including code snippets with exact line references from key files like `components/forms/field-document-upload.tsx` and `components/admin/form-definitions-panel.tsx`. I’ll highlight new admin form builder features, the document upload component, schema updates, and mention lint tests, carefully citing lines as the user requested.</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/admin/form-definitions-panel.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing snippet for FieldDocumentUpload**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/field-document-upload.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Locating schema snippet**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/lib/form-schema.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing example for FormFieldRenderer documentation**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-field-renderer.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Searching for FormStep applicationId snippet**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/components/forms/form-step.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing code snippets for DynamicFormWizard and forms page**</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: /Users/sahilmehta/supplier-onboarding-simple/app/dashboard/admin/forms/page.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Preparing final response summary**

I'll put together a clear summary highlighting the new admin form builder’s support for all field types including document type selection, updates to form rendering and schema with document and phone fields, and the new FieldDocumentUpload component. I’ll include concise code snippets from relevant files with precise line references, mention the lint test, and suggest next steps for verifying upload behavior. This structured overview should nicely wrap up the modifications!</details></think>

---

### Summary
- Admins can now configure every field type we render (email, phone, radio, multi-select, checkbox, document upload, etc.) and, when choosing a document field, must map it to a specific `DocumentType`, ensuring the builder captures the backend metadata we need for uploads.

```981:1107:components/admin/form-definitions-panel.tsx
interface FieldDialogProps {
  ...
  documentTypes: DocumentTypeSummary[];
}
const FIELD_TYPES = [
  { value: "text", label: "Text" },
  ...
  { value: "document", label: "Document upload" },
];
...
        let options: Record<string, unknown> | null = null;
        if (["select", "multi-select", "radio"].includes(type)) {
          options = { values };
        } else if (type === "document") {
          if (!documentTypeKey) {
            setError("Select a document type");
            return;
          }
          options = { documentTypeKey };
        }
```

- The dynamic form runtime now understands document fields end-to-end: `FormStep` propagates the current `applicationId`, `FormFieldRenderer` loads the new `FieldDocumentUpload`, and the shared Zod schema validates document payloads, multi-select arrays, radios, and phone inputs consistently.

```1:205:components/forms/form-field-renderer.tsx
import { FieldDocumentUpload, type DocumentFieldValue } from "./field-document-upload";
...
export function FormFieldRenderer({ ..., applicationId = null }: FormFieldRendererProps) {
  switch (field.type) {
    ...
    case "document":
      return (
        <FieldDocumentUpload
          field={field}
          value={value as DocumentFieldValue | null}
          onChange={(val) => onChange(val)}
          applicationId={applicationId}
          ...
        />
      );
```

```1:85:components/forms/form-step.tsx
interface FormStepProps {
  ...
  applicationId: string | null;
}
...
const shouldSpanFullWidth = ["textarea","multi-select","checkbox","radio","document"].includes(field.type);
...
<FormFieldRenderer
  ...
  applicationId={applicationId}
/>
```

```104:170:lib/form-schema.ts
const DOCUMENT_VALUE_SCHEMA = z.object({
  fileId: z.string(),
  fileName: z.string(),
  ...
});
function fieldToSchema(field: FormField) {
  switch (field.type) {
    case "select":
    case "radio":
      ...
    case "checkbox":
    case "boolean":
      schema = z.boolean();
      break;
    case "multi-select":
      schema = z.array(z.string());
      if (field.required) {
        schema = schema.min(1, `${field.label} must include at least one selection`);
      }
      break;
    case "document":
      schema = DOCUMENT_VALUE_SCHEMA;
      break;
    case "tel":
      schema = z.string().regex(/^[\d\-\s()+.]+$/, `${field.label} must be a valid phone number`);
      break;
```

- `FieldDocumentUpload` wires the form to the supplier document APIs: it requests a signed upload, calls `PUT` on the storage URL (best effort), records metadata via `/api/documents`, and stores a normalized value back into form data with helpful UI states.

```1:298:components/forms/field-document-upload.tsx
export function FieldDocumentUpload({...}) {
  const documentTypeKey = getDocumentTypeKey(field.options);
  ...
  const handleFileChange = async (...) => {
    if (!applicationId) { ... }
    const signResponse = await fetch("/api/documents/sign", { ... });
    ...
    await fetch("/api/documents", {
      method: "POST",
      body: JSON.stringify({
        applicationId,
        documentTypeKey,
        fileId,
        fileName: file.name,
        mimeType: file.type,
        fileSize: file.size,
      }),
    });
    const nextValue: DocumentFieldValue = {
      fileId,
      fileName: file.name,
      documentTypeKey,
      uploadedAt: new Date().toISOString(),
    };
    onChange(nextValue);
  };
```

### Testing
- `npm run lint`

Let me know if you’d like a quick manual pass through the form builder UI or a guidance note for suppliers on how to use the new document fields.

---

